<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»å¤´å®ç°Rustå¼‚æ­¥æ‰§è¡Œå™¨ | Steven's Blog</title>
    <meta name="description" content="steven's Blog">
    <link rel="stylesheet" href="/assets/style.01a6133c.css">
    <link rel="modulepreload" href="/assets/chunks/viewer.ac8119fd.js">
    <link rel="modulepreload" href="/assets/chunks/echarts.aab7373d.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart.d087ce05.js">
    <link rel="modulepreload" href="/assets/chunks/mermaid.f445d939.js">
    <link rel="modulepreload" href="/assets/chunks/runner.27cb2152.js">
    <link rel="modulepreload" href="/assets/app.3dd4ae37.js">
    <link rel="modulepreload" href="/assets/rust_build_your_own_executor.md.36a59a43.lean.js">
    
    <link rel="icon" href="/logo.png">
  <meta name="twitter:title" content="ä»å¤´å®ç°Rustå¼‚æ­¥æ‰§è¡Œå™¨ | Steven&#39;s Blog">
  <meta property="og:title" content="ä»å¤´å®ç°Rustå¼‚æ­¥æ‰§è¡Œå™¨ | Steven&#39;s Blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Steven&#39;s Blog, back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="/logo.png" alt="Logo" data-v-cc01ef16> Steven&#39;s Blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/web-security/" data-v-b8818f8c>webå®‰å…¨ç›¸å…³ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blockchain/" data-v-b8818f8c>block chain <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>é™æ€åˆ†æ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/app_security/" data-v-b8818f8c>æ³›appå®‰å…¨ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust-leetcode/" data-v-b8818f8c>leetcode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/rust/" data-v-b8818f8c>rust <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>other <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/blog-vitepress" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/web-security/" data-v-b8818f8c>webå®‰å…¨ç›¸å…³ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blockchain/" data-v-b8818f8c>block chain <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>é™æ€åˆ†æ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/app_security/" data-v-b8818f8c>æ³›appå®‰å…¨ <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust-leetcode/" data-v-b8818f8c>leetcode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/rust/" data-v-b8818f8c>rust <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>other <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/blog-vitepress" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rust_global_function_pointer.html">rustä¸­å‡½æ•°æŒ‡é’ˆä½œä¸ºå…¨å±€å˜é‡ä½¿ç”¨</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rust_atomic.html">æˆ‘å¯¹rust atomicçš„ç†è§£</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rust_async_lock.html">Rustå¼‚æ­¥ç¼–ç¨‹ä¸­æˆ‘ä»¬åº”è¯¥ç”¨é‚£ç§é”?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/convert_an_integer_to_an_enum.html">Rustä¸­enumå’Œæ•´æ•°çš„äº’ç›¸è½¬æ¢</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/Futures_Explained_in_200_lines_of_Rust2.html">200è¡Œä»£ç è®²é€Rust Futuresçš„é—®é¢˜</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/rust/build_your_own_executor.html">ä»å¤´å®ç°Rustå¼‚æ­¥æ‰§è¡Œå™¨</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#æ¥å£">æ¥å£</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å°†è¾“å‡ºä¼ é€’ç»™joinhandle">å°†è¾“å‡ºä¼ é€’ç»™JoinHandle</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ä»»åŠ¡çš„å‰–æ">ä»»åŠ¡çš„å‰–æ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ‰§è¡Œå™¨çº¿ç¨‹">æ‰§è¡Œå™¨çº¿ç¨‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ä»»åŠ¡æ‰§è¡Œ">ä»»åŠ¡æ‰§è¡Œ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ä¸€ç‚¹é­”æ³•">ä¸€ç‚¹é­”æ³•</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ”¹è¿›çš„joinhandle">æ”¹è¿›çš„JoinHandle</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å¤„ç†ææ…Œ-panic">å¤„ç†ææ…Œ(panic)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ‰§è¡Œå™¨çš„æ•ˆç‡">æ‰§è¡Œå™¨çš„æ•ˆç‡</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ­£ç¡®æ€§">æ­£ç¡®æ€§</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨">é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#è½¬è½½è¯´æ˜">è½¬è½½è¯´æ˜</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/build_your_own_block_on.html">ä»å¤´å®ç°Rustå¼‚æ­¥block_on</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/Futures_Explained_in_200_lines_of_Rust.html">200è¡Œä»£ç è®²é€Rust Futures</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/Futures_Explained_in_200_lines_of_Rust_with_error_version.html">200è¡Œä»£ç è®²é€Rust Futures-æœ‰bugç‰ˆæœ¬</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/lock-freedom-without-garbage-collection.html">Rustæ— é”ç¼–ç¨‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rustå¼€å‘å·¥å…·.html">rustå¼€å‘å·¥å…· clion</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/tokio_async_await åˆæ¢.html">tokio async&amp;await åˆæ¢</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/äº¤å‰ç¼–è¯‘rust.html">åœ¨ubuntu 18.04ä¸Šäº¤å‰ç¼–è¯‘rust ç¨‹åº</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/tokioç¬”è®°.html">tokioç¬”è®°.md</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/ownership101.html">Ownership 101</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/my_note.html">rustå­¦ä¹ ç¬”è®°</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/6.client.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-client</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/4.server.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/3.sublist.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-sublist</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/1.start.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/2.parser.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-parser</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/5.server.client.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.client</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/ppt/">rnats ppt</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/ppt/ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-client.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-client</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/ppt/ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.client.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.client</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/rust/rnats/ppt/ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.html">ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--[--><!----><!--]--><!--[--><div style="alignment:right;font-size:large;"> æœ€è¿‘æ›´æ–°: 2020-04-13</div><!--]--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p><a href="https://stjepang.github.io/2020/01/31/build-your-own-executor.html" target="_blank" rel="noopener noreferrer">åŸæ–‡ Build your own executor</a></p><ul><li><a href="#%E6%8E%A5%E5%8F%A3">æ¥å£</a></li><li><a href="#%E5%B0%86%E8%BE%93%E5%87%BA%E4%BC%A0%E9%80%92%E7%BB%99joinhandle">å°†è¾“å‡ºä¼ é€’ç»™JoinHandle</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%89%96%E6%9E%90">ä»»åŠ¡çš„å‰–æ</a></li><li><a href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E7%BA%BF%E7%A8%8B">æ‰§è¡Œå™¨çº¿ç¨‹</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C">ä»»åŠ¡æ‰§è¡Œ</a></li><li><a href="#%E4%B8%80%E7%82%B9%E9%AD%94%E6%B3%95">ä¸€ç‚¹é­”æ³•</a></li><li><a href="#%E6%94%B9%E8%BF%9B%E7%9A%84joinhandle">æ”¹è¿›çš„JoinHandle</a></li><li><a href="#%E5%A4%84%E7%90%86%E6%81%90%E6%85%8Cpanic">å¤„ç†ææ…Œ(panic)</a></li><li><a href="#%E6%89%A7%E8%A1%8C%E5%99%A8%E7%9A%84%E6%95%88%E7%8E%87">æ‰§è¡Œå™¨çš„æ•ˆç‡</a></li><li><a href="#%E6%AD%A3%E7%A1%AE%E6%80%A7">æ­£ç¡®æ€§</a></li><li><a href="#%E9%80%82%E7%94%A8%E4%BA%8E%E6%89%80%E6%9C%89%E4%BA%BA%E7%9A%84%E6%89%A7%E8%A1%8C%E5%99%A8">é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨</a></li><li><a href="#%E8%BD%AC%E8%BD%BD%E8%AF%B4%E6%98%8E">è½¬è½½è¯´æ˜</a></li></ul><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ„å»ºäº†<a href="https://stevenbai.top/rust/build_your_own_block_on/" target="_blank" rel="noopener noreferrer">block_on</a>å‡½æ•°ï¼Œæ˜¯æ—¶å€™è¿›ä¸€æ­¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ‰§è¡Œå™¨äº†ã€‚ æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„é—æ‰§è¡Œå™¨ä¸åªæ˜¯ä¸€æ¬¡è¿è¡Œä¸€ä¸ªfutureï¼Œè€Œæ˜¯åŒæ—¶è¿è¡Œå¤šä¸ªfutureï¼</p><p>è¿™ç¯‡åšæ–‡çš„çµæ„Ÿæ¥è‡ªäº <a href="https://github.com/withoutboats/juliex" target="_blank" rel="noopener noreferrer">juliex</a>ï¼Œä¸€ä¸ªæœ€å°çš„æ‰§è¡Œå™¨ï¼Œä½œè€…ä¹Ÿæ˜¯Rustä¸­çš„async/awaitåŠŸèƒ½çš„å¼€æ‹“è€…ä¹‹ä¸€ã€‚ ä»Šå¤©æˆ‘ä»¬è¦ä»å¤´å¼€å§‹å†™ä¸€ä¸ªæ›´ç°ä»£ã€æ›´æ¸…æ™°çš„<code>juliex</code>ç‰ˆæœ¬ã€‚</p><p>æˆ‘ä»¬çš„æ‰§è¡Œå™¨çš„ç›®æ ‡æ˜¯åªä½¿ç”¨ç®€å•å’Œå®Œå…¨å®‰å…¨çš„ä»£ç ï¼Œä½†æ˜¯æ€§èƒ½å¯ä»¥ä¸ç°æœ‰çš„æœ€ä½³æ‰§è¡Œå™¨åŒ¹æ•Œã€‚</p><p>æˆ‘ä»¬å°†ç”¨ä½œä¾èµ–çš„crateåŒ…æ‹¬ <a href="https://docs.rs/crossbeam" target="_blank" rel="noopener noreferrer">crossbeam</a>ã€ <a href="https://docs.rs/async-task" target="_blank" rel="noopener noreferrer">async-task</a>ã€ <a href="https://docs.rs/once_cell" target="_blank" rel="noopener noreferrer">once_cell</a>ã€ <a href="https://docs.rs/futures" target="_blank" rel="noopener noreferrer">futures</a> å’Œ <a href="https://docs.rs/num_cpus" target="_blank" rel="noopener noreferrer">num_cpus</a>ã€‚</p><h2 id="æ¥å£" tabindex="-1">æ¥å£ <a class="header-anchor" href="#æ¥å£" aria-hidden="true">#</a></h2><p>æ‰§è¡Œå™¨åªæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯è¿è¡Œä¸€ä¸ªfuture:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">fn</span> <span class="token function-definition function">spawn</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
    <span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¿”å›çš„<code>JoinHandle&lt;R&gt;</code>æ˜¯ä¸€ç§å®ç°äº†<code>Future&lt;Output=R&gt;</code>çš„ç±»å‹ï¼Œåœ¨ä»»åŠ¡å®Œæˆåå¯ä»¥å–å¾—å…¶è¾“å‡ºã€‚</p><p>æ³¨æ„è¿™ä¸ªspawn()å‡½æ•°å’Œ <a href="https://doc.rust-lang.org/nightly/std/thread/fn.spawn.html" target="_blank" rel="noopener noreferrer">std:ğŸ§µ:spawn()</a>ä¹‹é—´çš„ç›¸ä¼¼ä¹‹å¤„â€”â€”å®ƒä»¬å‡ ä¹æ˜¯ç­‰ä»·çš„ï¼Œé™¤äº†ä¸€ä¸ªäº§ç”Ÿå¼‚æ­¥ä»»åŠ¡ï¼Œå¦ä¸€ä¸ªäº§ç”Ÿçº¿ç¨‹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç”Ÿæˆä¸€ä¸ªä»»åŠ¡å¹¶ç­‰å¾…å®ƒçš„è¾“å‡º:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">futures<span class="token punctuation">::</span>executor<span class="token punctuation">::</span></span><span class="token function">block_on</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>handle<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="å°†è¾“å‡ºä¼ é€’ç»™joinhandle" tabindex="-1">å°†è¾“å‡ºä¼ é€’ç»™JoinHandle <a class="header-anchor" href="#å°†è¾“å‡ºä¼ é€’ç»™joinhandle" aria-hidden="true">#</a></h2><p>æ—¢ç„¶ JoinHandleæ˜¯ä¸€ä¸ªå®ç° Future çš„ç±»å‹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æš‚å…ˆç®€å•åœ°å°†å®ƒå®šä¹‰ä¸ºä¸€ä¸ªå›ºå®šåˆ°å †ä¸Šçš„futureçš„åˆ«å:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">type</span> <span class="token type-definition class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿™ä¸ªæ–¹æ³•ç›®å‰å¯è¡Œï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œç¨åæˆ‘ä»¬ä¼šå°†å®ƒä½œä¸ºä¸€ä¸ªæ–°çš„ç»“æ„æ¸…æ™°åœ°é‡å†™ï¼Œå¹¶æ‰‹åŠ¨å®ç° Futureã€‚</p><p>äº§ç”Ÿçš„ future çš„è¾“å‡ºå¿…é¡»ä»¥æŸç§æ–¹å¼å‘é€åˆ° JoinHandleã€‚ ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª oneshot é€šé“ï¼Œå¹¶åœ¨futureå®Œæˆæ—¶é€šè¿‡è¯¥é€šé“å‘é€è¾“å‡ºã€‚ é‚£ä¹ˆ JoinHandle å°±æ˜¯ä¸€ä¸ªç­‰å¾…æ¥è‡ªé€šé“çš„æ¶ˆæ¯çš„future:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>channel<span class="token punctuation">::</span></span>oneshot<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">spawn</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
    <span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">oneshot<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> future <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _ <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span> r<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¸‹ä¸€æ­¥æ˜¯åœ¨å †ä¸Šåˆ†é…futureåŒ…è£…å™¨ï¼Œå¹¶å°†å…¶æ¨å…¥æŸç§å…¨å±€ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»¥ä¾¿ç”±æ‰§è¡Œç¨‹åºå¤„ç†ã€‚ æˆ‘ä»¬ç§°è¿™ç§åˆ†é…çš„futureä¸ºä¸€é¡¹ä»»åŠ¡ã€‚</p><h2 id="ä»»åŠ¡çš„å‰–æ" tabindex="-1">ä»»åŠ¡çš„å‰–æ <a class="header-anchor" href="#ä»»åŠ¡çš„å‰–æ" aria-hidden="true">#</a></h2><p>ä»»åŠ¡(task)åŒ…æ‹¬futureå’Œå®ƒçš„çŠ¶æ€ã€‚ æˆ‘ä»¬éœ€è¦è·Ÿè¸ªçŠ¶æ€ï¼Œä»¥äº†è§£ä»»åŠ¡æ˜¯å¦è®¡åˆ’è¿è¡Œã€æ˜¯å¦å½“å‰æ­£åœ¨è¿è¡Œã€æ˜¯å¦å·²ç»å®Œæˆç­‰ç­‰ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘ä»¬çš„Taskç±»å‹çš„å®šä¹‰:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Task</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> <span class="token class-name">AtomicUsize</span><span class="token punctuation">,</span>
    future<span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æˆ‘ä»¬è¿˜æ²¡æœ‰ç¡®å®šçŠ¶æ€åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä½†å®ƒå°†æ˜¯æŸç§å¯ä»¥ä»ä»»ä½•çº¿ç¨‹æ›´æ–°çš„ AtomicUsizeã€‚ æˆ‘ä»¬ä»¥åå†è¯´å§ã€‚</p><p>Future çš„è¾“å‡ºç±»å‹æ˜¯()ãƒ¼ãƒ¼è¿™æ˜¯å› ä¸º spawn ()å‡½æ•°å°†åŸå§‹çš„ future åŒ…è£…æˆä¸€ä¸ªå°†è¾“å‡ºå‘é€åˆ° oneshot é€šé“ï¼Œç„¶åç®€å•åœ°è¿”å›()ã€‚</p><p>futureè¢«å›ºå®šåœ¨å †ä¸Šã€‚ è¿™æ˜¯å› ä¸ºåªæœ‰pinçš„futureæ‰èƒ½è¢«è½®è¯¢ï¼ˆpollï¼‰ã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆå®ƒè¿˜è¢«åŒ…è£…åœ¨Mutexä¸­å‘¢ï¼Ÿ</p><p>æ¯ä¸ªä¸ä»»åŠ¡ç›¸å…³è”çš„ Waker éƒ½ä¼šä¿å­˜ä¸€ä¸ª Task å¼•ç”¨ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥é€šè¿‡å°†ä»»åŠ¡æ¨å…¥å…¨å±€ä»»åŠ¡é˜Ÿåˆ—æ¥å”¤é†’ä»»åŠ¡ã€‚ é—®é¢˜å°±åœ¨è¿™é‡Œ: ä»»åŠ¡å®ä¾‹åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œä½†æ˜¯è½®è¯¢futureéœ€è¦å¯¹å®ƒçš„å¯å˜è®¿é—®ã€‚ è§£å†³æ–¹æ¡ˆ: æˆ‘ä»¬å°†futureå°è£…åˆ°äº’æ–¥å¯¹è±¡ä¸­ï¼Œä»¥è·å¾—å¯¹å®ƒçš„å¯å˜è®¿é—®æƒã€‚</p><p>å¦‚æœè¿™ä¸€åˆ‡å¬èµ·æ¥è®©äººå›°æƒ‘ï¼Œä¸è¦æ‹…å¿ƒï¼Œä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ•´ä¸ªæ‰§è¡Œå™¨ï¼Œç†è§£èµ·æ¥å°±ä¼šå®¹æ˜“å¾—å¤šï¼</p><p>è®©æˆ‘ä»¬æ¥åˆ†é…ä¸€ä¸ªä¿å­˜futureå’Œä»–çš„çŠ¶æ€çš„Taskæ¥å®Œæˆspawnå‡½æ•°:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">fn</span> <span class="token function-definition function">spawn</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
    <span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">oneshot<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> future <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _ <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Task</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">:</span> <span class="token class-name">AtomicUsize</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        future<span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">QUEUE</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span> r<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ä¸€æ—¦ä»»åŠ¡è¢«åˆ†é…ï¼Œæˆ‘ä»¬å°†å…¶æ¨å…¥ QUEUEï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«å¯è¿è¡Œä»»åŠ¡çš„å…¨å±€é˜Ÿåˆ—ã€‚ Spawn ()å‡½æ•°ç°åœ¨å·²ç»å®Œæˆï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰ QUEUE..ã€‚</p><h2 id="æ‰§è¡Œå™¨çº¿ç¨‹" tabindex="-1">æ‰§è¡Œå™¨çº¿ç¨‹ <a class="header-anchor" href="#æ‰§è¡Œå™¨çº¿ç¨‹" aria-hidden="true">#</a></h2><p>å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªæ‰§è¡Œå™¨ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ä¸€ä¸ªåå°çº¿ç¨‹æ± ï¼Œå®ƒä»é˜Ÿåˆ—ä¸­è·å–å¯è¿è¡Œçš„ä»»åŠ¡å¹¶è¿è¡Œå®ƒä»¬ï¼Œå³è½®è¯¢å®ƒä»¬çš„futureã€‚</p><p>è®©æˆ‘ä»¬å®šä¹‰å…¨å±€ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”åœ¨å®ƒç¬¬ä¸€æ¬¡è¢«åˆå§‹åŒ–æ—¶äº§ç”Ÿæ‰§è¡Œçº¿ç¨‹æ± :</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">use</span> <span class="token namespace">crossbeam<span class="token punctuation">::</span></span>channel<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">once_cell<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Lazy</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token constant">QUEUE</span><span class="token punctuation">:</span> <span class="token class-name">Lazy</span><span class="token operator">&lt;</span><span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token operator">&lt;</span><span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Lazy</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token function">unbounded</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> receiver <span class="token operator">=</span> receiver<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> receiver<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>task<span class="token closure-punctuation punctuation">|</span></span> task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    sender
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>éå¸¸ç®€å•â€”â€”æ‰§è¡Œå™¨çº¿ç¨‹å®é™…ä¸Šæ˜¯ä¸€è¡Œä»£ç ï¼ ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ— ç•Œé€šé“ï¼Œè€Œæ‰§è¡Œå™¨çº¿ç¨‹åˆ™ä»è¿™ä¸ªé€šé“æ¥æ”¶ä»»åŠ¡å¹¶è¿è¡Œæ¯ä¸ªä»»åŠ¡.</p><p>æ‰§è¡Œå™¨çº¿ç¨‹çš„æ•°é‡ç­‰äºç³»ç»Ÿä¸Šçš„æ ¸å¿ƒæ•°é‡ï¼Œè¯¥æ ¸å¿ƒæ•°é‡ç”±<code>nums_cpus</code>æä¾›ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹æ± ï¼Œæœ€åä¸€ä¸ªéœ€è¦å®ç°çš„éƒ¨åˆ†æ˜¯run()æ–¹æ³•ã€‚</p><h2 id="ä»»åŠ¡æ‰§è¡Œ" tabindex="-1">ä»»åŠ¡æ‰§è¡Œ <a class="header-anchor" href="#ä»»åŠ¡æ‰§è¡Œ" aria-hidden="true">#</a></h2><p>è¿è¡Œä¸€ä¸ªä»»åŠ¡ä»…ä»…æ„å‘³ç€è½®è¯¢å®ƒçš„futureã€‚ æˆ‘ä»¬å·²ç»ä»æˆ‘ä»¬å®ç° <code>block_on()</code>çš„<a href="https://stevenbai.top/rust/build_your_own_block_on/" target="_blank" rel="noopener noreferrer">å‰ä¸€ç¯‡åšå®¢æ–‡ç« </a>ä¸­çŸ¥é“å¦‚ä½•è½®è¯¢futureã€‚</p><p>Run()æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">impl</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> waker <span class="token operator">=</span> <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> cx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token punctuation">::</span><span class="token function">from_waker</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>waker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>future<span class="token punctuation">.</span><span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>cx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦é”å®šfutureï¼Œä»¥è·å¾—å¯å˜è®¿é—®æƒå¹¶å¯¹å…¶è¿›è¡Œè½®è¯¢ã€‚ æ ¹æ®è®¾è®¡ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šåŒæ—¶æŒæœ‰é”ï¼Œå› æ­¤try_lock()å¿…é¡»æ€»æ˜¯æˆåŠŸã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åˆ›é€ ä¸€ä¸ªå”¤é†’è€…å‘¢ï¼Ÿ æˆ‘ä»¬å°†åƒä¸Šæ¬¡ä¸€æ ·ä½¿ç”¨<code>async_task::waker_fn()</code>ï¼Œä½†å”¤é†’å‡½æ•°åº”è¯¥åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸èƒ½å°±è¿™æ ·æŠŠä¸€ä¸ª<code>Arc&lt;Task&gt;</code>æ”¾åˆ°QUEUEä¸­ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬åº”è¯¥è€ƒè™‘çš„æ½œåœ¨ç«äº‰å†²çª:</p><ul><li>å¦‚æœä¸€ä¸ªä»»åŠ¡å·²ç»å®Œæˆäº†ï¼Œç„¶åè¢«å”¤é†’äº†æ€ä¹ˆåŠ? Wakerç”Ÿå‘½å‘¨æœŸä¼šè¶…è¿‡ä»–å…³è”çš„Future,å¹¶ä¸”æˆ‘ä»¬ä¹Ÿä¸æƒ³åœ¨é˜Ÿåˆ—ä¸­åŒ…å«å·²ç»å®Œæˆçš„ä»»åŠ¡.</li><li>å¦‚æœä¸€ä¸ªä»»åŠ¡åœ¨è¿è¡Œä¹‹å‰,è¿ç»­è¢«å”¤é†’ä¸¤æ¬¡ä¼šæ€ä¹ˆæ ·? æˆ‘ä»¬ä¸å¸Œæœ›åœ¨é˜Ÿåˆ—ä¸­åŒä¸€ä¸ªä»»åŠ¡å‡ºç°ä¸¤æ¬¡.</li><li>å¦‚æœä¸€ä¸ªä»»åŠ¡æ­£åœ¨è¿è¡Œçš„æ—¶å€™è¢«å”¤é†’äº†æ€ä¹ˆåŠ? å¦‚æœè¿™æ—¶å€™å°†å…¶åŠ å…¥é˜Ÿåˆ—ä¸­,å¦ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹å¯èƒ½è¯•å›¾è¿è¡Œå®ƒ,è¿™å°†å¯¼è‡´ä¸€ä¸ªä»»åŠ¡åŒæ—¶åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ.</li></ul><p>å¦‚æœæˆ‘ä»¬ä»”ç»†æƒ³æƒ³ï¼Œæˆ‘ä»¬ä¼šæƒ³å‡ºä¸¤ä¸ªç®€å•çš„è§„åˆ™ï¼Œä¼˜é›…åœ°è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜:</p><ol><li>å¦‚æœè¿˜æ²¡æœ‰è¢«å”¤é†’å¹¶ä¸”å½“å‰æ²¡æœ‰æ­£åœ¨è¿è¡Œï¼Œå”¤é†’å‡½æ•°ä¼šå®‰æ’æ­¤ä»»åŠ¡</li><li>å¦‚æœä¸€ä¸ªä»»åŠ¡æ­£åœ¨è¿è¡Œæ—¶è¢«å”¤é†’,ç”±å½“å‰æ‰§è¡Œå™¨çº¿ç¨‹(å½“å‰æ­£åœ¨è¿è¡Œè¿™ä¸ªfutureçš„é‚£ä¸ªçº¿ç¨‹)é‡æ–°è°ƒåº¦å®ƒ.</li></ol><p>è®©æˆ‘ä»¬å‹¾å‹’å‡ºè¿™äº›è§„åˆ™:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">impl</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> waker <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token function">waker_fn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token string">&quot;schedule if the task is not woken already and is not running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> cx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token punctuation">::</span><span class="token function">from_waker</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>waker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>future<span class="token punctuation">.</span><span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>cx<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token string">&quot;schedule if the task was woken while running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ Task ä¸­å®šä¹‰çš„ AtomicUsize ç±»å‹çš„çŠ¶æ€å­—æ®µå—ï¼Ÿ ç°åœ¨æ˜¯æ—¶å€™åœ¨å…¶ä¸­å­˜å‚¨ä¸€äº›æœ‰ç”¨çš„æ•°æ®äº†ã€‚ å…³äºä»»åŠ¡ï¼Œæœ‰ä¸¤æ¡ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å”¤é†’:</p><ol><li>ä»»åŠ¡æ˜¯å¦å·²ç»è¢«å”¤é†’</li><li>ä»»åŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ</li></ol><p>è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯ true / false å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ state å­—æ®µä¸­ç”¨ä¸¤ä¸ªä½è¡¨ç¤ºå®ƒä»¬:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">const</span> <span class="token constant">WOKEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">0b01</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RUNNING</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">0b10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å”¤é†’å‡½æ•°è®¾ç½®â€œWOKENâ€ä½ã€‚ å¦‚æœä¸¤ä¸ªä½å…ˆå‰éƒ½æ˜¯0(å³ä»»åŠ¡æ—¢æ²¡æœ‰è¢«å”¤é†’ä¹Ÿæ²¡æœ‰è¿è¡Œ) ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡å°†å¼•ç”¨æ¨å…¥é˜Ÿåˆ—æ¥è°ƒåº¦ä»»åŠ¡:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> waker <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token function">waker_fn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> task<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">fetch_or</span><span class="token punctuation">(</span><span class="token constant">WOKEN</span><span class="token punctuation">,</span> <span class="token class-name">Ordering</span><span class="token punctuation">::</span><span class="token class-name">SeqCst</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token constant">QUEUE</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨è½®è¯¢futureä¹‹å‰ï¼Œæˆ‘ä»¬å–æ¶ˆäº†WOKENä½çš„è®¾ç½®ï¼Œå¹¶è®¾ç½®äº†RUNNINGä½:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">self</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token constant">RUNNING</span><span class="token punctuation">,</span> <span class="token class-name">Ordering</span><span class="token punctuation">::</span><span class="token class-name">SeqCst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token punctuation">::</span><span class="token function">from_waker</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>waker<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> poll <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>future<span class="token punctuation">.</span><span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>cx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨è½®è¯¢futureä¹‹åï¼Œæˆ‘ä»¬å–æ¶ˆRUNNINGä½çš„è®¾ç½®ï¼Œå¹¶æ£€æŸ¥å…ˆå‰çš„çŠ¶æ€æ˜¯å¦å·²ç»è®¾ç½®äº†WOKEN å’Œ RUNNING ä½(å³ä»»åŠ¡åœ¨è¿è¡Œæ—¶è¢«å”¤é†’)ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬é‡æ–°å®‰æ’ä»»åŠ¡:</p><p>æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœä»»åŠ¡å®Œæˆäº†(å³å®ƒçš„futureä¸å†æ˜¯pending) ï¼Œæˆ‘ä»¬å°±ä¼šè®©å®ƒæ°¸è¿œå¤„äº<code>RUNNING</code>çŠ¶æ€ã€‚ è¿™æ ·futureä»¥åè¢«å”¤é†’åå°±ä¸å¯èƒ½å†æ¬¡è¿›å…¥é˜Ÿåˆ—ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªçœŸæ­£çš„æ‰§è¡Œå™¨ãƒ¼ãƒ¼åœ¨<a href="https://github.com/stjepang/byo-executor/blob/master/examples/v1.rs" target="_blank" rel="noopener noreferrer">v1.rs</a>ä¸­çœ‹åˆ°å®Œæ•´çš„å®ç°ã€‚</p><h2 id="ä¸€ç‚¹é­”æ³•" tabindex="-1">ä¸€ç‚¹é­”æ³• <a class="header-anchor" href="#ä¸€ç‚¹é­”æ³•" aria-hidden="true">#</a></h2><p>å¦‚æœæ‚¨å‘ç°å¤„ç†<code>Task</code>ç»“æ„ä½“åŠå…¶çŠ¶æ€è½¬æ¢å¾ˆæœ‰æŒ‘æˆ˜ï¼Œæˆ‘æ„ŸåŒèº«å—ã€‚ ä½†ä¹Ÿæœ‰å¥½æ¶ˆæ¯,è¿™äº›å·¥ä½œéƒ½ä¸éœ€è¦ä½ äº²è‡ªåš,ä½¿ç”¨<code>asyc-task</code>å³å¯ï¼</p><p>æˆ‘ä»¬åªéœ€è¦ç”¨<code>async_task::Task()</code>æ›¿æ¢<code>Arc&lt;Task&gt;</code>ï¼Œå¹¶ç”¨<code>async-task::JoinHandle&lt;()&gt;</code>æ›¿æ¢<code>oneshot</code>é€šé“ã€‚</p><p>è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ç®€åŒ–ç”Ÿæˆ:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">type</span> <span class="token type-definition class-name">Task</span> <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token class-name">Task</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">spawn</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
    <span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>task<span class="token punctuation">,</span> handle<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span>future<span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>t<span class="token closure-punctuation punctuation">|</span></span> <span class="token constant">QUEUE</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span> handle<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>async_task::spawn()</code>æ¥å—ä¸‰ä¸ªå‚æ•°:</p><ol><li>å¾…è¿è¡Œçš„future</li><li>ä¸€ä¸ªå°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—çš„è°ƒåº¦å‡½æ•°. è¯¥å‡½æ•°å¯èƒ½è¢«å”¤é†’å™¨æ‰§è¡Œ,ä¹Ÿå¯èƒ½è¢«<code>run()</code>åœ¨è½®è¯¢futureåæ‰§è¡Œ.</li><li>ä¸€ä¸ªåŒ…å«ä»»æ„ä¿¡æ¯çš„tag,è¿™ä¸ªtagä¿¡æ¯ä¼šä¿å­˜åœ¨taskä¸­. è¿™ç¯‡åšå®¢ä¸­æˆ‘ä»¬ä¸è€ƒè™‘åªæ˜¯ç®€å•çš„ä¿å­˜<code>()</code>,ä¹Ÿå°±æ˜¯å¿½ç•¥å®ƒ.</li></ol><p>ç„¶åæ„é€ å‡½æ•°è¿”å›ä¸¤ä¸ªå€¼:</p><ol><li><code>async_task::Task&lt;()&gt;</code>,å…¶ä¸­<code>()</code>å°±æ˜¯åˆšåˆšä¼ å…¥çš„tag.</li><li><code>async_task::JoinHandle&lt;R, ()&gt;</code>,è¿™é‡Œçš„<code>()</code>è¿˜æ˜¯åˆšåˆšçš„tag. è¿™ä¸ªJoinHandleæ˜¯ä¸€ä¸ªfuture,å®ƒå®Œæˆçš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ª<code>Option&lt;R&gt;</code>. å½“è¿”å›Noneçš„æ—¶å€™è¡¨ç¤ºä»»åŠ¡å‘ç”Ÿäº†panicæˆ–è€…è¢«å–æ¶ˆäº†.</li></ol><p>å¦‚æœæ‚¨æƒ³çŸ¥é“<code>schedule()</code>æ–¹æ³•ï¼Œå®ƒåªéœ€è°ƒç”¨ä»»åŠ¡ä¸Šçš„ schedule å‡½æ•°å°†å…¶æ¨å…¥é˜Ÿåˆ—ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å°†ä»»åŠ¡æ¨å…¥QUEUEâ€”â€”æœ€ç»ˆç»“æœæ˜¯ç›¸åŒçš„ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†è¿™ä¸ªéå¸¸ç®€å•çš„æ‰§è¡Œå™¨:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">static</span> <span class="token constant">QUEUE</span><span class="token punctuation">:</span> <span class="token class-name">Lazy</span><span class="token operator">&lt;</span><span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token class-name">Lazy</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token function">unbounded</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> receiver <span class="token operator">=</span> receiver<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> receiver<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>task<span class="token closure-punctuation punctuation">|</span></span> task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    sender
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token type-definition class-name">Task</span> <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token class-name">Task</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token type-definition class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">spawn</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
    <span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>task<span class="token punctuation">,</span> handle<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span>future<span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>t<span class="token closure-punctuation punctuation">|</span></span> <span class="token constant">QUEUE</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span> handle<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨ <a href="https://github.com/stjepang/byo-executor/blob/master/examples/v2.rs" target="_blank" rel="noopener noreferrer">v2.rs</a> ä¸­æ‰¾åˆ°ã€‚</p><p>è¿™é‡Œä½¿ç”¨<code>async_task::spawn()</code>çš„å¥½å¤„ä¸ä»…ä»…æ˜¯ç®€å•ã€‚å®ƒä¹Ÿæ¯”æˆ‘ä»¬è‡ªå·±å†™çš„Taskæ›´æœ‰æ•ˆç‡ï¼Œä¹Ÿæ›´å¥å£®ã€‚ ä¸¾ä¸€ä¸ªå¥å£®æ€§çš„ä¾‹å­ï¼Œ<code>async_task::Task</code>åœ¨å®Œæˆåç«‹å³åˆ é™¤æœªæ¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä»»åŠ¡çš„æ‰€æœ‰å¼•ç”¨éƒ½å¤±æ•ˆåæ‰åˆ é™¤ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>async-task</code> è¿˜æä¾›äº†ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚<a href="https://docs.rs/async-task/1.3.0/async_task/struct.Task.html#method.tag" target="_blank" rel="noopener noreferrer">tags</a>å’Œ<a href="https://docs.rs/async-task/1.3.0/async_task/struct.Task.html#method.cancel" target="_blank" rel="noopener noreferrer">cancellation</a>ï¼Œä½†æ˜¯æˆ‘ä»¬ä»Šå¤©ä¸è®¨è®ºè¿™äº›ã€‚ è¿˜å€¼å¾—ä¸€æçš„æ˜¯ï¼Œasync-task æ˜¯ä¸€ä¸ª<code>#[no_std]</code>crateï¼Œç”šè‡³å¯ä»¥åœ¨æ²¡æœ‰æ ‡å‡†åº“çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><h2 id="æ”¹è¿›çš„joinhandle" tabindex="-1">æ”¹è¿›çš„JoinHandle <a class="header-anchor" href="#æ”¹è¿›çš„joinhandle" aria-hidden="true">#</a></h2><p>å¦‚æœä½ ä»”ç»†è§‚å¯Ÿæˆ‘ä»¬æœ€æ–°çš„æ‰§è¡Œå™¨ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•ˆç‡ä½ä¸‹çš„å®ä¾‹â€”â€”JoinHandleçš„å†—ä½™<code>Box::pin()</code>åˆ†é…ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç±»å‹åˆ«åå°±æ›´å¥½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ï¼Œå› ä¸º <code>async_task::JoinHandle&lt;R&gt;</code> è¾“å‡º<code>Option&lt;R&gt;</code>ï¼Œè€Œ<code>JoinHandle&lt;R&gt;</code> è¾“å‡ºR:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">type</span> <span class="token type-definition class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æˆ‘ä»¬åªèƒ½å°†<code>async_task::JoinHandle</code>å°è£…åˆ°ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ä¸­ï¼Œå¦‚æœä»»åŠ¡å‘ç”Ÿpanicæˆ–è€…è¢«å–æ¶ˆï¼Œå®ƒä¹Ÿä¼španic:</p><blockquote><p>è¿™å¥è¯æ„Ÿè§‰è¯´ä¸é€šå‘¢,éœ€è¦çœ‹çœ‹async_taskæºç æ‰è¡Œ</p></blockquote><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">struct</span> <span class="token type-definition class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token namespace">async_task<span class="token punctuation">::</span></span><span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token class-name">Future</span> <span class="token keyword">for</span> <span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">poll</span><span class="token punctuation">(</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Poll</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token class-name">Pin</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>cx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Pending</span> <span class="token operator">=&gt;</span> <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Pending</span><span class="token punctuation">,</span>
            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;task failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å®Œæ•´çš„æ‰§è¡Œå™¨å®ç°å¯ä»¥åœ¨<a href="https://github.com/stjepang/byo-executor/blob/master/examples/v3.rs" target="_blank" rel="noopener noreferrer">v3.rs</a>ä¸­æ‰¾åˆ°ã€‚</p><h2 id="å¤„ç†ææ…Œ-panic" tabindex="-1">å¤„ç†ææ…Œ(panic) <a class="header-anchor" href="#å¤„ç†ææ…Œ-panic" aria-hidden="true">#</a></h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰çœŸæ­£è€ƒè™‘è¿‡å½“ä»»åŠ¡æ„Ÿåˆ°ææ…Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå³è°ƒç”¨ <a href="https://doc.rust-lang.org/nightly/std/future/trait.Future.html#tymethod.poll" target="_blank" rel="noopener noreferrer">poll()</a>æ—¶ä¼šå‘ç”Ÿææ…Œã€‚ ç°åœ¨<code>run ()</code>æ–¹æ³•åªæ˜¯å°†ææ…Œä¼ æ’­åˆ°æ‰§è¡Œå™¨ä¸­ã€‚ æˆ‘ä»¬åº”è¯¥æ€è€ƒè¿™æ˜¯å¦æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ã€‚</p><p>æ˜æ™ºçš„åšæ³•æ˜¯ä»¥æŸç§æ–¹å¼å¤„ç†è¿™äº›ææ…Œã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å¿½ç•¥ææ…Œï¼Œç»§ç»­è¿è¡Œã€‚ è¿™æ ·å®ƒä»¬åªæ˜¯å±å¹•ä¸Šæ‰“å°ä¿¡æ¯ï¼Œä½†ä¸ä¼šå´©æºƒæ•´ä¸ªè¿›ç¨‹ãƒ¼ãƒ¼ææ…Œçš„çº¿ç¨‹çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒã€‚</p><p>ä¸ºäº†å¿½ç•¥ææ…Œï¼Œæˆ‘ä»¬å°†run()åŒ…è£…æˆ<a href="https://doc.rust-lang.org/nightly/std/panic/fn.catch_unwind.html" target="_blank" rel="noopener noreferrer">catch_unwind()</a> :</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>panic<span class="token punctuation">::</span></span>catch_unwind<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token constant">QUEUE</span><span class="token punctuation">:</span> <span class="token class-name">Lazy</span><span class="token operator">&lt;</span><span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token class-name">Lazy</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">channel<span class="token punctuation">::</span></span><span class="token function">unbounded</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Task</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> receiver <span class="token operator">=</span> receiver<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            receiver<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>task<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token function">catch_unwind</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    sender
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>åœ¨<a href="https://github.com/stjepang/byo-executor/blob/master/examples/v4.rs" target="_blank" rel="noopener noreferrer">v4.rs</a> ä¸­å¯ä»¥æ‰¾åˆ°å¿½ç•¥ææ…Œçš„å®Œæ•´æ‰§è¡Œå™¨ä»£ç ã€‚</p><p>æœ‰è®¸å¤šæ˜æ™ºçš„åº”å¯¹ææ…Œçš„ç­–ç•¥ã€‚ä¸‹é¢æ˜¯ä¸€äº›åœ¨<code>async-task</code>åº“ä¸­æä¾›çš„ä¾‹å­:</p><ul><li><p><a href="https://github.com/async-rs/async-task/blob/7f91c126df790902636d61362a093871e0d68f77/examples/spawn.rs#L29" target="_blank" rel="noopener noreferrer">å¿½ç•¥ææ…Œ</a> -- ææ…Œç›´æ¥è¢«å¿½ç•¥,å½“<code>JoinHandle&lt;R&gt;</code>åœ¨awaitæ—¶ä¹Ÿä¼šå‘ç”Ÿææ…Œ</p></li><li><p><a href="https://github.com/async-rs/async-task/blob/master/examples/panic-propagation.rs#L64" target="_blank" rel="noopener noreferrer">ä¼ æ’­ææ…Œ</a> panicè¢«é‡æ–°æ”¾å…¥åœ¨ç­‰å¾…<code>JoinHandle&lt;R&gt;</code>ç»“æœçš„é‚£ä¸ªä»»åŠ¡ä¸­.</p></li><li><p><a href="https://github.com/async-rs/async-task/blob/master/examples/panic-result.rs#L39" target="_blank" rel="noopener noreferrer">è¾“å‡ºææ…Œ</a> <code>JoinHandle&lt;R&gt;</code>è¾“å‡º<code>std::thread::Result&lt;R&gt;</code>.</p></li></ul><p>å®ç°ä»»ä½•ä½ æƒ³è¦çš„ææ…Œå¤„ç†ç­–ç•¥éƒ½æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ è¿™å®Œå…¨ç”±ä½ æ¥å†³å®šå“ªä¸€ä¸ªæ˜¯æœ€å¥½çš„ï¼</p><h2 id="æ‰§è¡Œå™¨çš„æ•ˆç‡" tabindex="-1">æ‰§è¡Œå™¨çš„æ•ˆç‡ <a class="header-anchor" href="#æ‰§è¡Œå™¨çš„æ•ˆç‡" aria-hidden="true">#</a></h2><p>å½“å‰çš„ä»£ç ç®€çŸ­ã€ç®€å•ã€å®‰å…¨ï¼Œä½†å®ƒæœ‰å¤šå¿«å‘¢ï¼Ÿ</p><p>async_task::spawn ()åˆ†é…çš„ä»»åŠ¡åªæ˜¯ä¸€ä¸ªåˆ†é…ï¼Œå­˜å‚¨ä»»åŠ¡çŠ¶æ€ã€futureä»¥åŠfutureå®Œæˆåçš„è¾“å‡ºã€‚ æ²¡æœ‰å…¶ä»–éšè—æˆæœ¬äº†ãƒ¼ãƒ¼spawnçš„é€Ÿåº¦å®é™…ä¸Šå·²ç»åˆ°äº†æé™ï¼</p><p>å…¶ä»–æ‰§è¡Œå™¨ï¼Œå¦‚ async-std å’Œ tokioï¼Œåˆ†é…ä»»åŠ¡çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚ æˆ‘ä»¬çš„æ‰§è¡Œå™¨çš„åŸºç¡€æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœ€ä¼˜çš„å®ç°ï¼Œç°åœ¨æˆ‘ä»¬ç¦»ä¸æµè¡Œçš„æ‰§è¡Œå™¨ç«äº‰åªæœ‰ä¸€æ­¥ä¹‹é¥: ä»»åŠ¡çªƒå–ã€‚</p><p>ç°åœ¨ï¼Œæ‰€æœ‰çš„æ‰§è¡Œå™¨çº¿ç¨‹å…±äº«ç›¸åŒçš„ä»»åŠ¡é˜Ÿåˆ—ã€‚ å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨åŒæ—¶è®¿é—®é˜Ÿåˆ—ï¼Œåˆ™ç”±äºäº‰ç”¨ï¼Œæ€§èƒ½å°†å—åˆ°å½±å“ã€‚ ä»»åŠ¡çªƒå–èƒŒåçš„æƒ³æ³•æ˜¯ä¸ºæ¯ä¸ªæ‰§è¡Œå™¨çº¿ç¨‹åˆ†é…ä¸€ä¸ªä¸åŒçš„é˜Ÿåˆ—ã€‚ è¿™æ ·æ‰§è¡Œå™¨çº¿ç¨‹åªéœ€è¦åœ¨è‡ªå·±çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶ä»å…¶ä»–é˜Ÿåˆ—ä¸­çªƒå–ä»»åŠ¡ï¼Œè¿™æ„å‘³ç€äº‰ç”¨åªä¼šå¾ˆå°‘å‘ç”Ÿï¼Œè€Œä¸æ˜¯ä¸€ç›´å‘ç”Ÿã€‚</p><p>æˆ‘å°†åœ¨å¦ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­æ›´å¤šåœ°è°ˆè®ºä»»åŠ¡çªƒå–ã€‚</p><h2 id="æ­£ç¡®æ€§" tabindex="-1">æ­£ç¡®æ€§ <a class="header-anchor" href="#æ­£ç¡®æ€§" aria-hidden="true">#</a></h2><p>æ¯ä¸ªäººéƒ½å‘Šè¯‰æˆ‘ä»¬ï¼Œå¹¶å‘æ˜¯å›°éš¾çš„ã€‚ Goè¯­è¨€æä¾›äº†ä¸€ä¸ªå†…ç½®çš„ç«äº‰æ£€æµ‹å™¨ï¼Œtokio<a href="https://tokio.rs/blog/2019-10-scheduler/#fearless-unsafe-concurrency-with-loom" target="_blank" rel="noopener noreferrer">åˆ›å»ºäº†è‡ªå·±</a>çš„å¹¶å‘æ£€æŸ¥å™¨ loom æ¥å¯»æ‰¾å¹¶å‘é”™è¯¯ï¼Œè€Œcrossbeamåœ¨æŸäº›æƒ…å†µä¸‹ç”šè‡³é‡‡ç”¨äº†å½¢å¼è¯æ˜ã€‚ å¬èµ·æ¥å¾ˆå¯æ€•ï¼</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åä¸‹æ¥ï¼Œæ”¾æ¾ï¼Œä¸ç”¨æ‹…å¿ƒã€‚ ç«äº‰æ£€æµ‹å™¨ï¼Œæ¶ˆæ¯’å™¨ï¼Œç”šè‡³<a href="https://github.com/rust-lang/miri" target="_blank" rel="noopener noreferrer">miri</a>(è¯‘è€… Miriæ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ Rust MIRè§£é‡Šå™¨ã€‚å®ƒå¯ä»¥è¿è¡ŒRustäºŒè¿›åˆ¶æ–‡ä»¶,å¯¹å…¶è¿›è¡Œæµ‹è¯•,å¯ä»¥æ£€æŸ¥å‡ºæŸäº›æœªå®šä¹‰çš„è¡Œä¸º)æˆ–loomï¼Œéƒ½ä¸èƒ½åœ¨æˆ‘ä»¬çš„é—å˜±æ‰§è¡Œå™¨ä¸Šæ•æ‰åˆ°bugã€‚ åŸå› æ˜¯æˆ‘ä»¬åªç¼–å†™äº†å®‰å…¨ä»£ç ï¼Œè€Œå®‰å…¨ä»£ç æ˜¯å†…å­˜å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½åŒ…å«æ•°æ®ç«äº‰ã€‚ Rustçš„ç±»å‹ç³»ç»Ÿå·²ç»è¯æ˜æˆ‘ä»¬çš„æ‰§è¡Œå™¨æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç¡®ä¿å†…å­˜å®‰å…¨çš„è´Ÿæ‹…å®Œå…¨ç”±ä¾èµ–çš„crateæ‰¿æ‹…ï¼Œæ›´ç¡®åˆ‡åœ°è¯´æ˜¯aysnc-taskå’Œcrossbeamã€‚ è¯·æ”¾å¿ƒï¼Œä¸¤è€…éƒ½éå¸¸é‡è§†æ­£ç¡®æ€§ã€‚ <code>async-task</code> æœ‰ä¸€ä¸ªè¦†ç›–æ‰€æœ‰è¾¹ç¼˜æƒ…å†µçš„å¹¿æ³›<a href="https://github.com/async-rs/async-task/tree/master/tests" target="_blank" rel="noopener noreferrer">æµ‹è¯•å¥—ä»¶</a>ï¼Œcrossbeamçš„é€šé“æœ‰<a href="https://github.com/crossbeam-rs/crossbeam/tree/ebecb82c740a1b3d9d10f235387848f7e3fa9c68/crossbeam-channel/tests" target="_blank" rel="noopener noreferrer">è®¸å¤šæµ‹è¯•</a>ï¼Œç”šè‡³é€šè¿‡<a href="https://github.com/crossbeam-rs/crossbeam/blob/ebecb82c740a1b3d9d10f235387848f7e3fa9c68/crossbeam-channel/tests/golang.rs" target="_blank" rel="noopener noreferrer">Go</a>å’Œ<a href="https://github.com/crossbeam-rs/crossbeam/blob/ebecb82c740a1b3d9d10f235387848f7e3fa9c68/crossbeam-channel/tests/mpsc.rs" target="_blank" rel="noopener noreferrer">std::sync::mpsc</a>æµ‹è¯•å¥—ä»¶ï¼Œå·¥ä½œçªƒå–åŒå‘é˜Ÿåˆ—åŸºäºä¸€ä¸ªç»è¿‡<a href="https://fzn.fr/readings/ppopp13.pdf" target="_blank" rel="noopener noreferrer">å½¢å¼è¯æ˜</a>çš„å®ç°ï¼Œè€ŒåŸºäºepochçš„åƒåœ¾æ”¶é›†å™¨ä¹Ÿæœ‰<a href="https://github.com/crossbeam-rs/rfcs/blob/master/text/2017-07-23-relaxed-memory.md" target="_blank" rel="noopener noreferrer">æ­£ç¡®æ€§è¯æ˜</a>ã€‚</p><h2 id="é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨" tabindex="-1">é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨ <a class="header-anchor" href="#é€‚ç”¨äºæ‰€æœ‰äººçš„æ‰§è¡Œå™¨" aria-hidden="true">#</a></h2><p>è‡ªä»Alexå’ŒAaronåœ¨2016å¹´é¦–æ¬¡<a href="https://aturon.github.io/blog/2016/08/11/futures/" target="_blank" rel="noopener noreferrer">designed zero-cost futures</a>ä»¥æ¥ï¼Œä»–ä»¬çš„è®¡åˆ’å°±æ˜¯æ¯ä¸ªspawnçš„futureåªè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…:</p><blockquote><p>æ¯ä¸ªâ€œä»»åŠ¡â€éœ€è¦ä¸€ä¸ªåˆ†é…ï¼Œç»“æœé€šå¸¸æ˜¯æ¯ä¸ªè¿æ¥éœ€è¦ä¸€ä¸ªåˆ†é…ã€‚</p></blockquote><p>ç„¶è€Œï¼Œå•æ¬¡åˆ†é…ä»»åŠ¡æ˜¯ä¸€ä¸ªå–„æ„çš„è°è¨€ãƒ¼ãƒ¼æˆ‘ä»¬èŠ±äº†å¥½å‡ å¹´æ‰çœŸæ­£å¾—åˆ°å®ƒä»¬ã€‚ æ¯”å¦‚tokio 0.1ç‰ˆæœ¬ä¸­spawnæ—¶éœ€è¦åˆ†é…ä¸€ä¸ªfutureï¼Œç„¶ååˆ†é…ä»»åŠ¡çŠ¶æ€ï¼Œæœ€ååˆ†é…ä¸€ä¸ªoneshoté€šé“ã€‚ ä¹Ÿå°±æ˜¯æ¯ä¸ªspawnä¸‰ä¸ªåˆ†é…ç‚¹ï¼</p><p>ç„¶åï¼Œåœ¨<a href="https://github.com/async-rs/async-task/releases/tag/v1.0.0" target="_blank" rel="noopener noreferrer">2019å¹´8æœˆ</a>,async-task<a href="https://async.rs/blog/announcing-async-std/" target="_blank" rel="noopener noreferrer">è¯ç”Ÿ</a>äº†ã€‚ æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†futureã€ä»»åŠ¡çŠ¶æ€å’Œé€šé“çš„åˆ†é…å‹ç¼©ä¸ºå•æ¬¡åˆ†é…ã€‚ ä¹‹æ‰€ä»¥èŠ±è´¹è¿™ä¹ˆé•¿æ—¶é—´ï¼Œæ˜¯å› ä¸ºä»»åŠ¡å†…éƒ¨çš„æ‰‹åŠ¨åˆ†é…å’ŒçŠ¶æ€è½¬æ¢ç®¡ç†<a href="https://github.com/async-rs/async-task/tree/master/src" target="_blank" rel="noopener noreferrer">éå¸¸å¤æ‚</a>ã€‚ ä½†æ˜¯ç°åœ¨å·²ç»å®Œæˆäº†ï¼Œä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒä»»ä½•äº‹æƒ…äº†ã€‚</p><p>æ­¤åä¸ä¹…ï¼Œåœ¨<a href="https://github.com/tokio-rs/tokio/pull/1657" target="_blank" rel="noopener noreferrer">2019å¹´10æœˆ</a>ï¼Œtokioä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼äº async-task çš„å®ç°æ–¹æ³•ã€‚</p><p>ç°åœ¨ï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡å•æ¬¡åˆ†é…ä»»åŠ¡æ¥<a href="https://github.com/async-rs/async-task/blob/master/examples/spawn.rs" target="_blank" rel="noopener noreferrer">æ„å»º</a>ä¸€ä¸ªé«˜æ•ˆçš„æ‰§è¡Œå™¨ã€‚ æ›¾ç»çš„ç«ç®­ç§‘å­¦ç°åœ¨å·²ç»ä¸å¤å­˜åœ¨äº†ã€‚</p><h2 id="è½¬è½½è¯´æ˜" tabindex="-1">è½¬è½½è¯´æ˜ <a class="header-anchor" href="#è½¬è½½è¯´æ˜" aria-hidden="true">#</a></h2><p>æœ¬æ–‡å…è®¸è½¬è½½,ä½†æ˜¯è¯·æ³¨æ˜å‡ºå¤„.ä½œè€…:stevenbai æœ¬äººåšå®¢:<a href="https://stevenbai.top/" target="_blank" rel="noopener noreferrer">https://stevenbai.top/</a></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/rust/Futures_Explained_in_200_lines_of_Rust2" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>200è¡Œä»£ç è®²é€Rust Futuresçš„é—®é¢˜</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/rust/build_your_own_block_on" data-v-38ede35f><span class="text" data-v-38ede35f>ä»å¤´å®ç°Rustå¼‚æ­¥block_on</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--[--><div class="vue-utterances" data-v-af521772></div><!--]--><!--[--><!----><!--]--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"app_security_identity_confusion_in_webview-based_mobile_app-in-app_ecosystems.md\":\"a3040a7d\",\"app_security_android_13_dp1_changes_security.md\":\"329fd8c9\",\"app_security_android_access_protected_components.md\":\"c14908d2\",\"app_security_android_howto_protected_unexported_components.md\":\"b204f410\",\"app_security_android_lce_third_party.md\":\"a3403426\",\"app_security_bilibili_arbitrary_code_execution.md\":\"70e0babe\",\"app_security_hook_rest_for_work.md\":\"a3e73877\",\"app_security_index.md\":\"54f397ec\",\"app_security_tiktok_arbitrary_code_execution.md\":\"dd3c7a58\",\"app_security_tiktok_arbitrary_code_execution_download_service.md\":\"b39b4554\",\"app_security_tiktok_theft_of_arbitrary.md\":\"29bc82f8\",\"app_security_use_cryptography_in_mobile_appls_the_right_way.md\":\"aa5821a3\",\"app_security_white_box_cryptography.md\":\"dfc2f809\",\"blockchain_block_chain_core_ecc_signature_random.md\":\"e724d94b\",\"blockchain_block_chain_core_index.md\":\"21fd9a71\",\"blockchain_block_chain_core_vrf.md\":\"57004d33\",\"blockchain_btcd_bitcoin script.md\":\"02ef6acb\",\"blockchain_btcd_bloom.md\":\"e2709f31\",\"blockchain_btcd_btcjson.md\":\"e31f64db\",\"blockchain_btcd_database.md\":\"ccb6657f\",\"blockchain_btcd_index.md\":\"2881b464\",\"blockchain_btcd_indexeræ¨¡å—.md\":\"574f0241\",\"blockchain_btcd_mempool.md\":\"e7359a57\",\"blockchain_btcd_mining.md\":\"9722e1d8\",\"blockchain_btcd_mrumap.md\":\"354f29ae\",\"blockchain_btcd_peer.md\":\"a07da08e\",\"blockchain_btcd_rpcclient.md\":\"37e63006\",\"blockchain_btcd_wire_common.md\":\"f27a541e\",\"blockchain_btcd_ä¸€ä¸ªæ¯”ç‰¹å¸è„šæœ¬ç¤ºä¾‹.md\":\"25d0d655\",\"blockchain_btcd_æ¯”ç‰¹å¸æŒ‡ä»¤é›†è¯´æ˜.md\":\"1910c347\",\"blockchain_btcd_æ¯”ç‰¹å¸çš„åœ°å€ç±»å‹.md\":\"b00102e9\",\"blockchain_btcd_æ¯”ç‰¹å¸è§£é”è„šæœ¬ä¸­çš„scriptsignatureéƒ½åŒ…å«äº†ä»€ä¹ˆä¸œè¥¿.md\":\"75eb39e0\",\"blockchain_btcd_éš”ç¦»è§è¯.md\":\"cf92434e\",\"blockchain_btcwallet_btcwalletç³»åˆ—ä¹‹ä¸€-grpcæ¨¡å—.md\":\"1d57c6d0\",\"blockchain_btcwallet_chainæ¨¡å—.md\":\"d0c52ff0\",\"blockchain_btcwallet_hdwallet-bip0032.md\":\"a9455adf\",\"blockchain_btcwallet_index.md\":\"735eba89\",\"blockchain_btcwallet_readme.md\":\"df7c13f2\",\"blockchain_btcwallet_snacl.md\":\"a4049c45\",\"blockchain_btcwallet_waddrmgræ¨¡å—.md\":\"08a31e27\",\"blockchain_btcwallet_walletdb.md\":\"93fbf929\",\"blockchain_btcwallet_walletä¸­çš„æ•°æ®åº“è®¾è®¡.md\":\"4b506dab\",\"blockchain_btcwallet_walletæ¨¡å—.md\":\"405bc833\",\"blockchain_btcwallet_wtxmgræ¨¡å—.md\":\"ebf5887b\",\"blockchain_btcwallet_æ‹“æ‰‘æ’åºåœ¨æ¯”ç‰¹å¸txç®¡ç†ä¸­çš„ä½¿ç”¨.md\":\"2c0955a4\",\"blockchain_ethereum_crosschainatomicexchange.md\":\"35c945f9\",\"blockchain_ethereum_btcè·¨é“¾è®¾è®¡.md\":\"09d0a4ea\",\"blockchain_ethereum_ethereum_erc20_wrapper.md\":\"728c8a8c\",\"blockchain_ethereum_golang subprocess tests.md\":\"37609981\",\"blockchain_ethereum_golang_plugin.md\":\"b904d3bf\",\"blockchain_ethereum_how_to_create_channel.md\":\"71f27e7f\",\"blockchain_ethereum_how_to_use_channel.md\":\"14a111b7\",\"blockchain_ethereum_index.md\":\"9f338c1d\",\"blockchain_ethereum_meshboxé…ç½® openwrt.md\":\"3fe19ac4\",\"blockchain_ethereum_raiden_graph.md\":\"bd731a74\",\"blockchain_ethereum_solidity_mapping_implementation.md\":\"cf2b4a89\",\"blockchain_ethereum_synapseä»£ç é˜…è¯».md\":\"54b0a482\",\"blockchain_ethereum_thedao.md\":\"a8e512ce\",\"blockchain_ethereum_ä»ä¸€æ¬¡ç›—å¸äº‹ä»¶å†è°ˆåˆçº¦å®‰å…¨é—®é¢˜.md\":\"58fb6e83\",\"blockchain_ethereum_ä»¥å¤ªåŠevmç¬”è®°.md\":\"4ade6180\",\"blockchain_ethereum_åŒºå—é“¾è®¡æ—¶å™¨.md\":\"f5f5632d\",\"blockchain_ethereum_åŒºå—é“¾é—®é¢˜ç¬”è®°.md\":\"a92c091a\",\"blockchain_ethereum_åˆçº¦æ³¨æ„äº‹é¡¹.md\":\"2cab85bb\",\"blockchain_ethereum_å›å£«å¦ä¸å ¡åˆ†å‰å¼•èµ·çš„å®‰å…¨é—®é¢˜.md\":\"588cfb0b\",\"blockchain_ethereum_å¤šé“¾å·¥ä½œé—®é¢˜.md\":\"0175030d\",\"blockchain_ethereum_å¦‚ä½•ä¸º smartraiden è´¡çŒ®ä»£ç .md\":\"8c7e5161\",\"blockchain_ethereum_å¦‚ä½•ä½¿ç”¨ dlv è°ƒè¯• smartraiden.md\":\"c7369014\",\"blockchain_ethereum_å¦‚ä½•ä½¿ç”¨ smartraiden ä»¥åŠ lnd è¿›è¡Œè·¨é“¾åŸå­èµ„äº§äº¤æ¢.md\":\"b239c308\",\"blockchain_ethereum_å®‰å…¨æ€»ç»“.md\":\"3f152dfe\",\"blockchain_ethereum_å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«.md\":\"5992922a\",\"blockchain_ethereum_å¼‚å¸¸é€€å‡ºå„ç§æƒ…å†µ.md\":\"a62f5b77\",\"blockchain_ethereum_æˆ‘å¯¹ smartplasma çš„ç†è§£.md\":\"d9b0d2bb\",\"blockchain_ethereum_æ¯”ç‰¹å¸çš„txhashä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ”¹å˜.md\":\"4a3308ad\",\"blockchain_ethereum_è®©photonæ”¯æŒgo module.md\":\"b52438c1\",\"blockchain_ethereum_é—ªç”µç½‘ç»œ.md\":\"bba00993\",\"blockchain_ethereum_é—ªç”µç½‘ç»œäº¤æ˜“å¯†é’¥.md\":\"d23d3ec0\",\"blockchain_index.md\":\"7ef66e10\",\"blockchain_libra_1.start_in_one_minute.md\":\"6ba68426\",\"blockchain_libra_2.protobuf_in_libria.md\":\"3eca9d06\",\"blockchain_libra_3.libra_schema.md\":\"36f88501\",\"blockchain_libra_4.client_command_and_libriadb.md\":\"175f32f9\",\"blockchain_libra_5.libra_ac.md\":\"2c30d2ee\",\"blockchain_libra_6.libria_mempool_1.md\":\"f4463813\",\"blockchain_libra_7.libra_mempool_2.md\":\"36b38403\",\"blockchain_libra_8.libria_mempool_3.md\":\"5cc1105a\",\"blockchain_libra_9.libria_vrf.md\":\"deff6e4a\",\"blockchain_libra_index.md\":\"d02de00f\",\"blockchain_solidity_memory_layout.md\":\"c6c4c4ba\",\"blockchain_solidity_solidity_yul.md\":\"0aa903fd\",\"index.md\":\"045b0f7f\",\"other_aptå®‰è£…æŒ‡å®šç‰ˆæœ¬è½¯ä»¶.md\":\"be5b0639\",\"other_asynq_introduction.md\":\"36f0151b\",\"other_brewå®‰è£…æŒ‡å®šç‰ˆæœ¬boost.md\":\"a3e8311b\",\"other_capture_with_wireshark_for_android.md\":\"23d34c43\",\"other_clean_mac.md\":\"c2d92eae\",\"other_crossover source insight 4.0ä½¿ç”¨.md\":\"77b41c87\",\"other_dynamic_tracing.md\":\"004ba42b\",\"other_gitä»¥åŠgithubå›é€€.md\":\"f41abf7a\",\"other_go_memory_model.md\":\"f6ffc4bb\",\"other_grpcox.md\":\"7512d143\",\"other_how_to_mine_smt_2022.md\":\"1621b7dd\",\"other_hugoåšå®¢å†™ä½œ.md\":\"b236c0c9\",\"other_index.md\":\"f205da98\",\"other_learn_go.md\":\"cf6152b1\",\"other_learningpythonv4.md\":\"d79b08cf\",\"other_opc ç»Ÿä¸€æ¶æ„å­¦ä¹ ç¬”è®°.md\":\"1e3966bd\",\"other_opcua-rust.md\":\"8a606986\",\"other_opcua_cross_compile_for_raspeberry.md\":\"3d9e93aa\",\"other_rcore_os_program.md\":\"890dde42\",\"other_read_kerenel_use_clion.md\":\"27be7e01\",\"other_typescript_advanced_syntax.md\":\"ceb63c90\",\"other_vscode_cnblog_plugin.md\":\"dc3a94ea\",\"other_webassembly_two_days_exercise.md\":\"143da99e\",\"other_windows_hook_thiscall.md\":\"eae89ad6\",\"other_ä¸ç”¨å¤–éƒ¨æ’ä»¶å¯ç”¨uç›˜ntfså†™åŠŸèƒ½.md\":\"335587f2\",\"other_äº”ä¸ªgolandè¿›è¡Œgoå¼€å‘çš„å°æŠ€å·§.md\":\"5b2adc78\",\"other_ä½¿ç”¨clionè°ƒè¯•å¼€å‘æ¯”ç‰¹å¸æºç .md\":\"a76679dc\",\"other_ä½¿ç”¨ubuntuæ­å»ºæ—¶é—´æœºå™¨å¤‡ä»½æœåŠ¡.md\":\"334cda44\",\"other_å·¥ä½œä¸­å¸¸ç”¨å·¥å…·å…¥é—¨.md\":\"3c955795\",\"other_ç”¨ go å†™ webassemblyå…¥é—¨.md\":\"1ec7b83e\",\"other_é˜ˆå€¼ç­¾å.md\":\"4a73db37\",\"other_é«˜æ€§èƒ½goå¼€å‘.md\":\"91f75e39\",\"rust-leetcode_2019-06-01.md\":\"447d838c\",\"rust-leetcode_2019-06-02.md\":\"9616bccd\",\"rust-leetcode_2019-06-03.md\":\"ecbe83b9\",\"rust-leetcode_2019-06-04.md\":\"78c728d6\",\"rust-leetcode_2019-06-05.md\":\"4b2b43fd\",\"rust-leetcode_2019-06-06.md\":\"61b37481\",\"rust-leetcode_2019-06-07.md\":\"14698b33\",\"rust-leetcode_2019-06-08.md\":\"6c3f680e\",\"rust-leetcode_2019-06-10.md\":\"18360dac\",\"rust-leetcode_2019-06-11.md\":\"a182da44\",\"rust-leetcode_2019-06-14.md\":\"bbfac250\",\"rust-leetcode_2019-06-15.md\":\"f44a2a4b\",\"rust-leetcode_2019-06-17.md\":\"175f09db\",\"rust-leetcode_2019-06-18.md\":\"e617c16b\",\"rust-leetcode_2019-08-04.md\":\"4c0913b5\",\"rust-leetcode_2019-08-10.md\":\"d2c7e470\",\"rust-leetcode_2019-08-11.md\":\"0629b7d5\",\"rust-leetcode_2019-08-12.md\":\"38a15ac7\",\"rust-leetcode_2019-08-13.md\":\"b33965d1\",\"rust-leetcode_2019-08-14.md\":\"694f7106\",\"rust-leetcode_2019-08-15.md\":\"6d619c41\",\"rust-leetcode_2019-08-16.md\":\"4a99fa80\",\"rust-leetcode_2019-08-17.md\":\"362718d8\",\"rust-leetcode_2019-08-18.md\":\"43d6ce64\",\"rust-leetcode_2019-08-19.md\":\"47cb5a4d\",\"rust-leetcode_2019-08-20.md\":\"6ddbe820\",\"rust-leetcode_2019-08-21.md\":\"57dd5513\",\"rust-leetcode_2019-08-22.md\":\"fae3bec3\",\"rust-leetcode_2019-08-23.md\":\"a9021a82\",\"rust-leetcode_2019-08-26.md\":\"8b740a7b\",\"rust-leetcode_2019-08-27.md\":\"480727bd\",\"rust-leetcode_2019-08-28.md\":\"4cbdb62e\",\"rust-leetcode_2019-08-29.md\":\"2ab8e509\",\"rust-leetcode_2019-08-30.md\":\"46a02d2b\",\"rust-leetcode_2019-09-02.md\":\"1a4f339c\",\"rust-leetcode_2019-09-03.md\":\"46dff71a\",\"rust-leetcode_2019-09-04.md\":\"dc2f2b77\",\"rust-leetcode_2019-09-05.md\":\"64143eda\",\"rust-leetcode_2019-09-06.md\":\"f8971678\",\"rust-leetcode_2019-09-09.md\":\"b41ce521\",\"rust-leetcode_2019-09-10.md\":\"4fe4635d\",\"rust-leetcode_2019-09-11.md\":\"0862cff5\",\"rust-leetcode_2019-09-12.md\":\"5b4d93d8\",\"rust-leetcode_2019-09-13.md\":\"f647cdd2\",\"rust-leetcode_2019-09-16.md\":\"c3df8e5b\",\"rust-leetcode_2019-09-17.md\":\"93ab5921\",\"rust-leetcode_2019-09-18.md\":\"9b0ef946\",\"rust-leetcode_2019-09-19.md\":\"1a31e824\",\"rust-leetcode_2019-09-20.md\":\"3c142b93\",\"rust-leetcode_2019-09-23.md\":\"926b91ff\",\"rust-leetcode_2019-09-24.md\":\"499fedd8\",\"rust-leetcode_2019-09-25.md\":\"99326d8e\",\"rust-leetcode_2019-09-26.md\":\"e61bd98e\",\"rust-leetcode_2019-09-27.md\":\"ea15b568\",\"rust-leetcode_2019-09-28.md\":\"28fb0ba2\",\"rust-leetcode_2019-10-08.md\":\"a6183796\",\"rust-leetcode_2019-10-09.md\":\"8a8d9b07\",\"rust-leetcode_2019-10-10.md\":\"79122f19\",\"rust-leetcode_2019-10-11.md\":\"fdeb2e14\",\"rust-leetcode_2019-10-14.md\":\"54b14683\",\"rust-leetcode_2019-10-15.md\":\"063cf8b0\",\"rust-leetcode_2019-10-16.md\":\"0626c582\",\"rust-leetcode_2019-10-17.md\":\"4c044d69\",\"rust-leetcode_2019-10-18.md\":\"b2b24b39\",\"rust-leetcode_2019-10-19.md\":\"7e122380\",\"rust-leetcode_2019-10-21.md\":\"77139dbc\",\"rust-leetcode_2019-10-22.md\":\"f7733c63\",\"rust-leetcode_2019-10-23.md\":\"d0dadac6\",\"rust-leetcode_2019-10-24.md\":\"53ad2272\",\"rust-leetcode_2019-10-25.md\":\"76766876\",\"rust-leetcode_2019-10-28.md\":\"f5929483\",\"rust-leetcode_2019-10-29.md\":\"54f6cd03\",\"rust-leetcode_2019-10-30.md\":\"bbe15154\",\"rust-leetcode_2019-10-31.md\":\"82573d42\",\"rust-leetcode_2019-11-01.md\":\"ab56eb8b\",\"rust-leetcode_2019-11-04.md\":\"cb19bb99\",\"rust-leetcode_2019-11-05.md\":\"49aa7923\",\"rust-leetcode_2019-11-06.md\":\"675ef9a6\",\"rust-leetcode_2019-11-07.md\":\"a90de154\",\"rust-leetcode_2019-11-08.md\":\"2ae45484\",\"rust-leetcode_2019-11-11.md\":\"77e89d04\",\"rust-leetcode_2019-11-12.md\":\"88a15021\",\"rust-leetcode_2019-11-13.md\":\"a90c51bc\",\"rust-leetcode_2019-11-14.md\":\"84c9f147\",\"rust-leetcode_2019-11-15.md\":\"cd7e93b7\",\"rust-leetcode_2019-11-18.md\":\"2de7d958\",\"rust-leetcode_2019-11-19.md\":\"c3d69799\",\"rust-leetcode_2019-11-20.md\":\"c3109eb1\",\"rust-leetcode_2019-11-21.md\":\"4f56c2c6\",\"rust-leetcode_2019-11-22.md\":\"1336e6ac\",\"rust-leetcode_2019-11-25.md\":\"09b80c26\",\"rust-leetcode_2019-11-26.md\":\"e61ca23d\",\"rust-leetcode_2019-11-27.md\":\"42a0e6e1\",\"rust-leetcode_2019-11-28.md\":\"683db8da\",\"rust-leetcode_2019-11-29.md\":\"352a0dcd\",\"rust-leetcode_2019-12-02.md\":\"eb39be49\",\"rust-leetcode_2019-12-03.md\":\"dc6e59d2\",\"rust-leetcode_2019-12-04.md\":\"889fa974\",\"rust-leetcode_2019-12-05.md\":\"44383364\",\"rust-leetcode_2019-12-06.md\":\"14dd2bd2\",\"rust-leetcode_2019-12-09.md\":\"28b00e50\",\"rust-leetcode_2019-12-10.md\":\"4d921600\",\"rust-leetcode_2019-12-11.md\":\"89caa59c\",\"rust-leetcode_2019-12-12.md\":\"b668f75d\",\"rust-leetcode_2019-12-13.md\":\"ba2b8764\",\"rust-leetcode_2019-12-16.md\":\"8366869c\",\"rust-leetcode_2019-12-17.md\":\"6f27c72a\",\"rust-leetcode_2019-12-18.md\":\"01786c54\",\"rust-leetcode_2019-12-19.md\":\"bea94629\",\"rust-leetcode_2019-12-20.md\":\"6278d101\",\"rust-leetcode_2019-12-23.md\":\"3762d554\",\"rust-leetcode_2019-12-24.md\":\"15afa310\",\"rust-leetcode_2019-12-25.md\":\"58b734d4\",\"rust-leetcode_2019-12-26.md\":\"44548f04\",\"rust-leetcode_2019-12-27.md\":\"abf74e2e\",\"rust-leetcode_2019-12-30.md\":\"f84c7554\",\"rust-leetcode_2019-12-31.md\":\"209d427f\",\"rust-leetcode_2020-01-01.md\":\"bc134ad0\",\"rust-leetcode_2020-01-02.md\":\"f5794be4\",\"rust-leetcode_2020-01-03.md\":\"978279e1\",\"rust-leetcode_2020-01-06.md\":\"5f86863b\",\"rust-leetcode_2020-01-07.md\":\"490f637a\",\"rust-leetcode_2020-01-08.md\":\"17d5d9b7\",\"rust-leetcode_2020-01-09.md\":\"2a1e64e6\",\"rust-leetcode_2020-01-10.md\":\"d7b4e733\",\"rust-leetcode_2020-01-13.md\":\"17790f87\",\"rust-leetcode_2020-01-14.md\":\"a34023f3\",\"rust-leetcode_2020-01-15.md\":\"14ebdc8e\",\"rust-leetcode_2020-01-16.md\":\"ebd68d08\",\"rust-leetcode_2020-01-17.md\":\"bd8cff5f\",\"rust-leetcode_2020-01-20.md\":\"e17d62e3\",\"rust-leetcode_2020-01-21.md\":\"6e9c3d50\",\"rust-leetcode_2020-01-22.md\":\"e574bd99\",\"rust-leetcode_2020-01-23.md\":\"0a50ed21\",\"rust-leetcode_2020-01-24.md\":\"7e061098\",\"rust-leetcode_2020-02-03.md\":\"b3ebaedd\",\"rust-leetcode_2020-02-04.md\":\"04c3b9e3\",\"rust-leetcode_2020-02-05.md\":\"438fac2a\",\"rust-leetcode_2020-02-06.md\":\"a7895437\",\"rust-leetcode_2020-02-07.md\":\"7f25ad4a\",\"rust-leetcode_2020-02-10.md\":\"3e70b27b\",\"rust-leetcode_2020-02-11.md\":\"654fc38b\",\"rust-leetcode_2020-02-12.md\":\"be4e0615\",\"rust-leetcode_2020-02-13.md\":\"b8ac6d78\",\"rust-leetcode_2020-02-14.md\":\"3641a56c\",\"rust-leetcode_2020-02-17.md\":\"994a6549\",\"rust-leetcode_2020-02-18.md\":\"3de039ee\",\"rust-leetcode_2020-02-19.md\":\"498ee1a0\",\"rust-leetcode_2020-02-20.md\":\"1c441d11\",\"rust-leetcode_2020-02-21.md\":\"f81e9777\",\"rust-leetcode_2020-02-24.md\":\"c62a60d5\",\"rust-leetcode_2020-02-25.md\":\"a001074b\",\"rust-leetcode_2020-02-26.md\":\"51734dd7\",\"rust-leetcode_2020-02-27.md\":\"c13d2091\",\"rust-leetcode_2020-02-28.md\":\"d20bf622\",\"rust-leetcode_2020-03-02.md\":\"822d3ece\",\"rust-leetcode_2020-03-03.md\":\"0ff4f664\",\"rust-leetcode_2020-03-04.md\":\"32c1ab47\",\"rust-leetcode_2020-03-05.md\":\"94e29c88\",\"rust-leetcode_2020-03-06.md\":\"760b8ad6\",\"rust-leetcode_2020-03-09.md\":\"46dddc10\",\"rust-leetcode_2020-03-10.md\":\"03f9e60f\",\"rust-leetcode_2020-03-11.md\":\"881c874b\",\"rust-leetcode_2020-03-12.md\":\"b2bb56c6\",\"rust-leetcode_2020-03-13.md\":\"03e7007c\",\"rust-leetcode_2020-03-16.md\":\"f351be05\",\"rust-leetcode_2020-03-17.md\":\"b686f7c0\",\"rust-leetcode_2020-03-18.md\":\"e793e847\",\"rust-leetcode_2020-03-19.md\":\"68d93f62\",\"rust-leetcode_2020-03-20.md\":\"80d4d6e7\",\"rust-leetcode_2020-03-23.md\":\"f97f788b\",\"rust-leetcode_2020-03-24.md\":\"30ae8a61\",\"rust-leetcode_2020-03-25.md\":\"97bd37b7\",\"rust-leetcode_2020-03-26.md\":\"e6e0c07b\",\"rust-leetcode_2020-03-27.md\":\"8eb4a99f\",\"rust-leetcode_2020-03-30.md\":\"805098b5\",\"rust-leetcode_2020-03-31.md\":\"22b032dd\",\"rust-leetcode_2020-07-09.md\":\"d0e564f8\",\"rust-leetcode_index.md\":\"0e350145\",\"rust-leetcode_æ¨¡æ¿.md\":\"0c7f1103\",\"rust_futures_explained_in_200_lines_of_rust.md\":\"018cf133\",\"rust_futures_explained_in_200_lines_of_rust2.md\":\"1d9ef2da\",\"rust_futures_explained_in_200_lines_of_rust_with_error_version.md\":\"be124c2e\",\"rust_build_your_own_block_on.md\":\"b91d4ec6\",\"rust_build_your_own_executor.md\":\"36a59a43\",\"rust_convert_an_integer_to_an_enum.md\":\"40801e06\",\"rust_index.md\":\"a49cbc03\",\"rust_lock-freedom-without-garbage-collection.md\":\"682df061\",\"rust_my_note.md\":\"1fa0a41f\",\"rust_ownership101.md\":\"ac0c27f7\",\"rust_rnats_1.start.md\":\"af3b6c01\",\"rust_rnats_2.parser.md\":\"2d229695\",\"rust_rnats_3.sublist.md\":\"e7d5777f\",\"rust_rnats_4.server.md\":\"2f3a255e\",\"rust_rnats_5.server.client.md\":\"f8468d91\",\"rust_rnats_6.client.md\":\"80320c5f\",\"rust_rnats_index.md\":\"a9a5a692\",\"rust_rnats_ppt_index.md\":\"93c0c750\",\"rust_rnats_ppt_ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-client.md\":\"02f11603\",\"rust_rnats_ppt_ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.client.md\":\"e654c8e7\",\"rust_rnats_ppt_ä»é›¶å®ç°æ¶ˆæ¯ä¸­é—´ä»¶-server.md\":\"071656c5\",\"rust_rust_async_lock.md\":\"e7576d77\",\"rust_rust_atomic.md\":\"2e4b4afe\",\"rust_rust_global_function_pointer.md\":\"d5c4a80f\",\"rust_rustå¼€å‘å·¥å…·.md\":\"94983999\",\"rust_tokio_async_await åˆæ¢.md\":\"bb556170\",\"rust_tokioç¬”è®°.md\":\"939d9167\",\"rust_äº¤å‰ç¼–è¯‘rust.md\":\"f7d462aa\",\"static_analysis_index.md\":\"4a8aa30f\",\"static_analysis_llvm_overview.md\":\"8c4fb740\",\"static_analysis_llvm_programmers_mannual.md\":\"f5bb4478\",\"static_analysis_mariana-introduction.md\":\"3abc5d1b\",\"system_armv8v9_arch_csdn.md\":\"f28744c2\",\"web-security_gokart.md\":\"40a26408\",\"web-security_index.md\":\"9f1a0673\",\"web-security_sql_inject_chinese_gbk.md\":\"53226067\"}")</script>
    <script type="module" async src="/assets/app.3dd4ae37.js"></script>
    
  </body>
</html>