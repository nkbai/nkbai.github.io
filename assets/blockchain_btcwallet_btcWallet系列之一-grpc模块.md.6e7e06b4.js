import{_ as n,c as s,o as a,a as t}from"./app.577f36ad.js";const d='{"title":"btcWallet\u7CFB\u5217\u4E4B\u4E00-grpc\u6A21\u5757","description":"","frontmatter":{"title":"btcWallet\u7CFB\u5217\u4E4B\u4E00-grpc\u6A21\u5757","date":"2019-05-19T01:46:15.071Z","draft":false,"markup":"mmark"},"headers":[{"level":2,"title":"Service\u5206\u7C7B","slug":"service\u5206\u7C7B"},{"level":3,"title":"VersionService","slug":"versionservice"},{"level":3,"title":"WalletLoaderService","slug":"walletloaderservice"},{"level":2,"title":"\u6838\u5FC3\u670D\u52A1WalletService","slug":"\u6838\u5FC3\u670D\u52A1walletservice"},{"level":3,"title":"\u63A5\u53E3","slug":"\u63A5\u53E3"},{"level":3,"title":"stream\u8FD4\u56DE\u7684\u5B9E\u73B0","slug":"stream\u8FD4\u56DE\u7684\u5B9E\u73B0"},{"level":2,"title":"\u5176\u4ED6: \u4E0Ehttp rpc\u670D\u52A1\u7684\u7B80\u5355\u6BD4\u8F83","slug":"\u5176\u4ED6-\u4E0Ehttp-rpc\u670D\u52A1\u7684\u7B80\u5355\u6BD4\u8F83"}],"relativePath":"blockchain/btcwallet/btcWallet\u7CFB\u5217\u4E4B\u4E00-grpc\u6A21\u5757.md"}',e={},p=t(`<h1 id="btcwallet\u5BF9\u5916\u670D\u52A1" tabindex="-1">btcwallet\u5BF9\u5916\u670D\u52A1 <a class="header-anchor" href="#btcwallet\u5BF9\u5916\u670D\u52A1" aria-hidden="true">#</a></h1><p>btcwallet\u9664\u4E86\u50CFbtcd\u5BF9\u5916\u63D0\u4F9Brpc\u670D\u52A1\u4EE5\u5916,\u8FD8\u63D0\u4F9B\u4E86grpc\u670D\u52A1,\u540C\u65F6grpc\u91C7\u7528\u7684\u662Fprotobuf\u6765\u5B9E\u73B0. \u8FD9\u65B9\u4FBF\u4E0E\u4E0D\u540C\u8BED\u8A00\u8FDB\u884C\u4EA4\u4E92,\u964D\u4F4E\u5BA2\u6237\u7AEF\u4EE3\u7801\u7F16\u5199\u91CF.</p><p>\u9605\u8BFB\u8FD9\u4E2A\u6A21\u5757,\u987A\u4FBF\u4E86\u89E3\u4E00\u4E0Bproto\u7684\u4F7F\u7528,\u66F4\u8BE6\u7EC6\u7684\u7EC6\u8282\u95EE\u9898.</p><h2 id="service\u5206\u7C7B" tabindex="-1">Service\u5206\u7C7B <a class="header-anchor" href="#service\u5206\u7C7B" aria-hidden="true">#</a></h2><p>\u603B\u5171\u6709\u4E09\u79CDService,\u5206\u522B\u662FVersionService,WalletService\u548CWalletLoaderService, \u4ECE\u4E2D\u53EF\u4EE5\u770B\u51FA</p><h3 id="versionservice" tabindex="-1">VersionService <a class="header-anchor" href="#versionservice" aria-hidden="true">#</a></h3><p>\u53EA\u662F\u63D0\u4F9B\u7248\u672C\u67E5\u8BE2\u670D\u52A1,\u4E3A\u4EC0\u4E48\u4F1A\u505A\u6210\u4E00\u4E2A\u72EC\u7ACB\u7684\u670D\u52A1,\u8BBE\u8BA1\u8005\u662F\u51FA\u4E8E\u4EC0\u4E48\u8003\u8651\u7684\u5462? \u8FD9\u91CC\u91CD\u70B9\u8003\u5BDFgrpc\u670D\u52A1\u7684\u542F\u52A8\u8FC7\u7A0B</p><ol><li>walletMain\u51FD\u6570\u4E2D\u4F20\u9012wallet.Loader\u8C03\u7528startRPCServers</li><li>\u914D\u7F6Egrpc\u6240\u9700\u53C2\u6570,\u5305\u62EC\u8BC1\u4E66</li><li>\u521B\u5EFAgrpcServer</li><li>\u901A\u8FC7rpcserver.StartVersionService\u6CE8\u518CVersionService</li><li>\u901A\u8FC7pb.RegisterVersionServiceServer \u6CE8\u518CversionServer \u8FD9\u91CC\u7684RegisterVersionServiceServer\u662F\u81EA\u52A8\u751F\u6210,</li><li>versionServer\u5B9E\u73B0\u4E86Version\u63A5\u53E3,\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1</li></ol><p>\u4E0B\u9762\u662Fproto\u81EA\u52A8\u751F\u6210\u7684Service Description ,\u5176\u4E2DHandlerType\u4E3A\u7A7A,\u9700\u8981\u6211\u4EEC\u81EA\u5DF1\u5B9E\u73B0.</p><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">var</span> _VersionService_serviceDesc <span class="token operator">=</span> grpc<span class="token punctuation">.</span>ServiceDesc<span class="token punctuation">{</span>
   ServiceName<span class="token punctuation">:</span> <span class="token string">&quot;walletrpc.VersionService&quot;</span><span class="token punctuation">,</span>
   HandlerType<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">*</span>VersionServiceServer<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   Methods<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>MethodDesc<span class="token punctuation">{</span>
   	<span class="token punctuation">{</span>
   		MethodName<span class="token punctuation">:</span> <span class="token string">&quot;Version&quot;</span><span class="token punctuation">,</span>
   		Handler<span class="token punctuation">:</span>    _VersionService_Version_Handler<span class="token punctuation">,</span>
   	<span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   Streams<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>StreamDesc<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   Metadata<span class="token punctuation">:</span> <span class="token string">&quot;api.proto&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="versionservice-client\u7684\u5B9E\u73B0" tabindex="-1">VersionService client\u7684\u5B9E\u73B0 <a class="header-anchor" href="#versionservice-client\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h4><p>\u540C\u65F6proto\u81EA\u52A8\u751F\u6210\u4E86\u5BA2\u6237\u7AEF\u8BBF\u95EE\u4EE3\u7801,</p><ol><li>\u901A\u8FC7NewVersionServiceClient\u521B\u5EFAVersionServiceClient</li><li>\u901A\u8FC7VersionServiceClient\u7684Version\u6765\u8BBF\u95EE</li></ol><h4 id="\u76F8\u5173\u53C2\u6570" tabindex="-1">\u76F8\u5173\u53C2\u6570 <a class="header-anchor" href="#\u76F8\u5173\u53C2\u6570" aria-hidden="true">#</a></h4><p>grpc\u8C03\u7528\u7684\u6240\u6709\u53C2\u6570\u90FD\u662F\u901A\u8FC7Message\u6765\u5B9A\u4E49, \u53EF\u4EE5\u770B\u51FA,\u867D\u7136VersionRequest\u4EC0\u4E48\u90FD\u6CA1\u5076,\u8FD8\u662F\u8981\u5B9A\u4E49</p><div class="language-proto line-numbers-mode"><pre><code>message VersionRequest {}
message VersionResponse {
	string version_string = 1;
	uint32 major = 2;
	uint32 minor = 3;
	uint32 patch = 4;
	string prerelease = 5;
	string build_metadata = 6;
}
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u7684\u5B9E\u73B0" tabindex="-1">\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u7684\u5B9E\u73B0 <a class="header-anchor" href="#\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h4><p>\u5BA2\u6237\u7AEF,\u7531proto\u81EA\u52A8\u751F\u6210, \u5B8C\u5168\u4E0D\u7528\u7BA1\u7406</p><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">type</span> VersionServiceClient <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Version</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> in <span class="token operator">*</span>VersionRequest<span class="token punctuation">,</span> opts <span class="token operator">...</span>grpc<span class="token punctuation">.</span>CallOption<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>VersionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>versionServiceClient<span class="token punctuation">)</span> <span class="token function">Version</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> in <span class="token operator">*</span>VersionRequest<span class="token punctuation">,</span> opts <span class="token operator">...</span>grpc<span class="token punctuation">.</span>CallOption<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>VersionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	out <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>VersionResponse<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;/walletrpc.VersionService/Version&quot;</span><span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">,</span> c<span class="token punctuation">.</span>cc<span class="token punctuation">,</span> opts<span class="token operator">...</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> out<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u670D\u52A1\u7AEF</p><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">type</span> VersionServiceServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Version</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>VersionRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>VersionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>versionServer<span class="token punctuation">)</span> <span class="token function">Version</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>pb<span class="token punctuation">.</span>VersionRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>pb<span class="token punctuation">.</span>VersionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>pb<span class="token punctuation">.</span>VersionResponse<span class="token punctuation">{</span>
		VersionString<span class="token punctuation">:</span> semverString<span class="token punctuation">,</span>
		Major<span class="token punctuation">:</span>         semverMajor<span class="token punctuation">,</span>
		Minor<span class="token punctuation">:</span>         semverMinor<span class="token punctuation">,</span>
		Patch<span class="token punctuation">:</span>         semverPatch<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u8FD9\u91CC\u7ED9\u7684\u4F8B\u5B50\u6BD4\u8F83\u7279\u6B8A,\u5C31\u662F\u8F93\u5165\u53C2\u6570\u6839\u672C\u6CA1\u7528,\u4E0D\u8FC7\u770B\u5F97\u51FA\u5982\u4F55\u4F7F\u7528proto\u4EE5\u53CAgrpc\u4E86.</p><h3 id="walletloaderservice" tabindex="-1">WalletLoaderService <a class="header-anchor" href="#walletloaderservice" aria-hidden="true">#</a></h3><p>\u6B64\u670D\u52A1\u4E3B\u8981\u7528\u4E8E\u6253\u5F00\u5173\u95ED\u94B1\u5305, StartConsensusRpc\u662F\u5728btcwallet\u542F\u52A8\u7684\u65F6\u5019\u6CA1\u6709\u6307\u5B9Abtcd\u7684\u60C5\u5F62\u4E0B,\u53EF\u4EE5\u8FDE\u63A5\u6307\u5B9A\u7684btcd.</p><div class="language-proto line-numbers-mode"><pre><code>service WalletLoaderService {
	rpc WalletExists (WalletExistsRequest) returns (WalletExistsResponse);
	rpc CreateWallet (CreateWalletRequest) returns (CreateWalletResponse);
	rpc OpenWallet (OpenWalletRequest) returns (OpenWalletResponse);
	rpc CloseWallet (CloseWalletRequest) returns (CloseWalletResponse);
	rpc StartConsensusRpc (StartConsensusRpcRequest) returns (StartConsensusRpcResponse);
}

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>WalletLoaderService\u542F\u52A8\u65B9\u5F0F\u548CVersionService\u5B8C\u5168\u4E00\u81F4.</p><p>\u6211\u7684\u95EE\u9898: \u94B1\u5305\u4E0D\u5B58\u5728\u7684\u65F6\u5019\u53EA\u80FD\u901A\u8FC7--create\u521B\u5EFA\u5B8C\u6210\u4EE5\u540E\u518D\u542F\u52A8,\u662F\u5426\u8FD9\u4E2A\u670D\u52A1\u76EE\u524D\u6839\u672C\u6CA1\u7528?</p><h2 id="\u6838\u5FC3\u670D\u52A1walletservice" tabindex="-1">\u6838\u5FC3\u670D\u52A1WalletService <a class="header-anchor" href="#\u6838\u5FC3\u670D\u52A1walletservice" aria-hidden="true">#</a></h2><h3 id="\u63A5\u53E3" tabindex="-1">\u63A5\u53E3 <a class="header-anchor" href="#\u63A5\u53E3" aria-hidden="true">#</a></h3><div class="language-proto line-numbers-mode"><pre><code>service WalletService {
	// Queries
	rpc Ping (PingRequest) returns (PingResponse);
	rpc Network (NetworkRequest) returns (NetworkResponse);
	rpc AccountNumber (AccountNumberRequest) returns (AccountNumberResponse);
	rpc Accounts (AccountsRequest) returns (AccountsResponse);
	rpc Balance (BalanceRequest) returns (BalanceResponse);
	rpc GetTransactions (GetTransactionsRequest) returns (GetTransactionsResponse);

	// Notifications
	rpc TransactionNotifications (TransactionNotificationsRequest) returns (stream TransactionNotificationsResponse);
	rpc SpentnessNotifications (SpentnessNotificationsRequest) returns (stream SpentnessNotificationsResponse);
	rpc AccountNotifications (AccountNotificationsRequest) returns (stream AccountNotificationsResponse);

	// Control
	rpc ChangePassphrase (ChangePassphraseRequest) returns (ChangePassphraseResponse);
	rpc RenameAccount (RenameAccountRequest) returns (RenameAccountResponse);
	rpc NextAccount (NextAccountRequest) returns (NextAccountResponse);
	rpc NextAddress (NextAddressRequest) returns (NextAddressResponse);
	rpc ImportPrivateKey (ImportPrivateKeyRequest) returns (ImportPrivateKeyResponse);
	rpc FundTransaction (FundTransactionRequest) returns (FundTransactionResponse);
	rpc SignTransaction (SignTransactionRequest) returns (SignTransactionResponse);
	rpc PublishTransaction (PublishTransactionRequest) returns (PublishTransactionResponse);
}
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>###\u542F\u52A8\u8FC7\u7A0B</p><ol><li>walletMain\u4E2D\u7B49\u5F85\u94B1\u5305\u6253\u5F00\u4EE5\u540E\u83B7\u53D6\u5230\u94B1\u5305\u53E5\u67C4,\u7136\u540E\u8C03\u7528startWalletRPCServices</li><li>\u6CE8\u610FstartWalletRPCServices\u4F20\u9012\u8FDB\u53BB\u4E09\u4E2A\u53C2\u6570,\u4E00\u4E2A\u662F\u94B1\u5305\u53E5\u67C4,\u4E00\u4E2A\u662Fgrpc server,\u53E6\u4E00\u4E2A\u662F\u666E\u901A\u7684http rpc server</li><li>rpcserver.StartWalletService\u542F\u52A8grpc WalletService</li><li>legacyServer.RegisterWallet \u6CE8\u518Chttp rpc\u670D\u52A1</li><li>pb.RegisterWalletServiceServer\u6CE8\u518Crpc.walletServer</li><li>rpc.walletServer\u5B9E\u73B0\u4E86\u63A5\u53E3</li></ol><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">type</span> WalletServiceServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token comment">// Queries</span>
	<span class="token function">Ping</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>PingRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>PingResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Network</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NetworkRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NetworkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">AccountNumber</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>AccountNumberRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>AccountNumberResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Accounts</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>AccountsRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>AccountsResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Balance</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>BalanceRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>BalanceResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">GetTransactions</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>GetTransactionsRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>GetTransactionsResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token comment">// Notifications</span>
	<span class="token function">TransactionNotifications</span><span class="token punctuation">(</span><span class="token operator">*</span>TransactionNotificationsRequest<span class="token punctuation">,</span> WalletService_TransactionNotificationsServer<span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">SpentnessNotifications</span><span class="token punctuation">(</span><span class="token operator">*</span>SpentnessNotificationsRequest<span class="token punctuation">,</span> WalletService_SpentnessNotificationsServer<span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">AccountNotifications</span><span class="token punctuation">(</span><span class="token operator">*</span>AccountNotificationsRequest<span class="token punctuation">,</span> WalletService_AccountNotificationsServer<span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token comment">// Control</span>
	<span class="token function">ChangePassphrase</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ChangePassphraseRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ChangePassphraseResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">RenameAccount</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>RenameAccountRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>RenameAccountResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NextAccount</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NextAccountRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NextAccountResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NextAddress</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NextAddressRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NextAddressResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ImportPrivateKey</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ImportPrivateKeyRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ImportPrivateKeyResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">FundTransaction</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>FundTransactionRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>FundTransactionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">SignTransaction</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>SignTransactionRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>SignTransactionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">PublishTransaction</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>PublishTransactionRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>PublishTransactionResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="stream\u8FD4\u56DE\u7684\u5B9E\u73B0" tabindex="-1">stream\u8FD4\u56DE\u7684\u5B9E\u73B0 <a class="header-anchor" href="#stream\u8FD4\u56DE\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h3><p>stream\u5C31\u662F\u6301\u7EED\u4E0D\u65AD\u7684\u6709\u8FD4\u56DE\u7684\u610F\u601D\u5427. <code> rpc TransactionNotifications (TransactionNotificationsRequest) returns (stream TransactionNotificationsResponse); </code> proto\u4E2D\u7684\u63A5\u53E3\u88AB\u8F6C\u6362\u6210\u4E86<code> TransactionNotifications(*TransactionNotificationsRequest, WalletService_TransactionNotificationsServer) error </code> \u5176\u4E2D<code>TransactionNotificationsResponse</code>\u88AB\u8F6C\u6362\u6210\u4E86</p><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">type</span> WalletService_TransactionNotificationsServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Send</span><span class="token punctuation">(</span><span class="token operator">*</span>TransactionNotificationsResponse<span class="token punctuation">)</span> <span class="token builtin">error</span>
	grpc<span class="token punctuation">.</span>ServerStream
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u670D\u52A1\u7AEFTransactionNotifications\u5B9E\u73B0</p><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>walletServer<span class="token punctuation">)</span> <span class="token function">TransactionNotifications</span><span class="token punctuation">(</span>req <span class="token operator">*</span>pb<span class="token punctuation">.</span>TransactionNotificationsRequest<span class="token punctuation">,</span>
	svr pb<span class="token punctuation">.</span>WalletService_TransactionNotificationsServer<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>

	n <span class="token operator">:=</span> s<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>NtfnServer<span class="token punctuation">.</span><span class="token function">TransactionNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> n<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	ctxDone <span class="token operator">:=</span> svr<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		<span class="token keyword">select</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>n<span class="token punctuation">.</span>C<span class="token punctuation">:</span>
			resp <span class="token operator">:=</span> pb<span class="token punctuation">.</span>TransactionNotificationsResponse<span class="token punctuation">{</span>
				AttachedBlocks<span class="token punctuation">:</span>           <span class="token function">marshalBlocks</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>AttachedBlocks<span class="token punctuation">)</span><span class="token punctuation">,</span>
				DetachedBlocks<span class="token punctuation">:</span>           <span class="token function">marshalHashes</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>DetachedBlocks<span class="token punctuation">)</span><span class="token punctuation">,</span>
				UnminedTransactions<span class="token punctuation">:</span>      <span class="token function">marshalTransactionDetails</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>UnminedTransactions<span class="token punctuation">)</span><span class="token punctuation">,</span>
				UnminedTransactionHashes<span class="token punctuation">:</span> <span class="token function">marshalHashes</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>UnminedTransactionHashes<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
			err <span class="token operator">:=</span> svr<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>resp<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token function">translateError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctxDone<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="\u5176\u4ED6-\u4E0Ehttp-rpc\u670D\u52A1\u7684\u7B80\u5355\u6BD4\u8F83" tabindex="-1">\u5176\u4ED6: \u4E0Ehttp rpc\u670D\u52A1\u7684\u7B80\u5355\u6BD4\u8F83 <a class="header-anchor" href="#\u5176\u4ED6-\u4E0Ehttp-rpc\u670D\u52A1\u7684\u7B80\u5355\u6BD4\u8F83" aria-hidden="true">#</a></h2><p>\u901A\u8FC7\u4EE3\u7801\u5B9E\u73B0\u5BF9\u6BD4\u5C31\u53EF\u4EE5\u53D1\u73B0http rpc\u670D\u52A1\u5B9E\u73B0\u8D77\u6765\u6BD4\u8F83\u7E41\u7410,\u5404\u79CD\u5BA2\u6237\u7AEF\u7F16\u89E3\u7801\u9700\u8981\u81EA\u5DF1\u5904\u7406, \u4E0D\u8FC7\u4ECE\u4EE3\u7801\u5B8C\u5584\u5EA6\u6765\u8BF4,http\u63A5\u53E3\u660E\u663E\u66F4\u80DC\u4E00\u7B79,\u65E0\u8BBA\u662F\u6CE8\u91CA\u8FD8\u662F\u6D4B\u8BD5case,\u5305\u62ECapi\u6587\u6863.</p><p>\u5982\u679C\u751F\u4EA7\u4E2D\u4F7F\u7528,\u8FD8\u662F\u4F7F\u7528http rpc\u66F4\u597D,\u5982\u679C\u719F\u6089\u4EE3\u7801\u7684\u8BDD,\u4F7F\u7528grpc\u66F4\u6E05\u6670.</p>`,41),o=[p];function c(r,l,i,u,k,b){return a(),s("div",null,o)}var v=n(e,[["render",c]]);export{d as __pageData,v as default};
