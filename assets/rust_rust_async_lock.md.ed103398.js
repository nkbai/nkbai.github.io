import{_ as n,c as s,o as a,a as p}from"./app.8a942cb0.js";const _='{"title":"Rust\u5F02\u6B65\u7F16\u7A0B\u4E2D\u6211\u4EEC\u5E94\u8BE5\u7528\u90A3\u79CD\u9501?","description":"","frontmatter":{"title":"Rust\u5F02\u6B65\u7F16\u7A0B\u4E2D\u6211\u4EEC\u5E94\u8BE5\u7528\u90A3\u79CD\u9501?","date":"2020-12-31T03:57:03.000Z","draft":false,"tags":["rust"],"categories":["\u6280\u672F\u76F8\u5173"]},"headers":[{"level":2,"title":"\u4E24\u79CD\u9501\u7684\u5F02\u540C","slug":"\u4E24\u79CD\u9501\u7684\u5F02\u540C"},{"level":2,"title":"\u4E24\u79CD\u9501\u7684\u9009\u7528","slug":"\u4E24\u79CD\u9501\u7684\u9009\u7528"},{"level":3,"title":"tokio\u4E2D\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA","slug":"tokio\u4E2D\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA"},{"level":3,"title":"\u6807\u51C6\u5E93\u4E2D\u9501\u7684\u4EE3\u4EF7\u9AD8\u4E48?","slug":"\u6807\u51C6\u5E93\u4E2D\u9501\u7684\u4EE3\u4EF7\u9AD8\u4E48"}],"relativePath":"rust/rust_async_lock.md"}',t={},e=p(`<p>\u5728rust\u5F02\u6B65\u7F16\u7A0B\u4E2D,\u6211\u4EEC\u6709\u4E24\u79CD\u9501\u53EF\u4EE5\u9009\u62E9,\u4E00\u79CD\u662F\u6807\u51C6\u5E93\u91CC\u63D0\u4F9B\u7684\u9501(<code>std::sync::Mutex</code>),\u4E0B\u79F0\u6807\u51C6\u9501; \u53E6\u4E00\u79CD\u53EF\u4EE5\u662F\u5F02\u6B65\u5E93\u63D0\u4F9B\u7684\u9501,\u6BD4\u5982<code>async_std::sync::Mutex</code>,\u7B80\u79F0\u5F02\u6B65\u9501, \u90A3\u4E48\u4E24\u79CD\u9501\u6709\u4F55\u5F02\u540C,\u6211\u4EEC\u8BE5\u5982\u4F55\u9009\u62E9\u5462? \u672C\u6587\u5C06\u4F1A\u7ED9\u51FA\u7B54\u6848.</p><p>\u6309\u7167\u6211\u7684\u4E60\u60EF,\u5148\u8BF4\u7ED3\u8BBA:</p><ol><li>\u5982\u679C\u6807\u51C6\u9501\u6EE1\u8DB3\u8981\u6C42,\u5C3D\u91CF\u4F7F\u7528\u6807\u51C6\u9501</li><li>\u6807\u51C6\u9501\u4E0D\u80FD\u7528\u65F6,\u518D\u7528\u5F02\u6B65\u9501</li></ol><h2 id="\u4E24\u79CD\u9501\u7684\u5F02\u540C" tabindex="-1">\u4E24\u79CD\u9501\u7684\u5F02\u540C <a class="header-anchor" href="#\u4E24\u79CD\u9501\u7684\u5F02\u540C" aria-hidden="true">#</a></h2><p>\u76F8\u540C\u70B9:</p><ul><li>\u90FD\u80FD\u8D77\u5230\u540C\u6B65\u4E92\u65A5\u7684\u6548\u679C</li></ul><p>\u4E0D\u540C\u70B9:</p><ul><li>\u6807\u51C6\u9501\u4E0D\u80FD\u8DE8await</li><li>\u5F02\u6B65\u9501\u53EF\u4EE5\u8DE8await</li></ul><p>\u5982\u679C\u4F60\u7684\u4EE3\u7801\u4E2D\u9700\u8981\u8DE8await\u6301\u6709\u9501,\u90A3\u4E48\u4F60\u5C31\u53EA\u80FD\u7528\u5F02\u6B65\u5E93\u9501. \u6BD4\u5982\u4E0B\u9762\u8FD9\u79CD\u60C5\u51B5:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">struct</span> <span class="token type-definition class-name">SomeSharedStructure</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">SomeSharedStructure</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">do1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_mutex_guard_await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">SomeSharedStructure</span> <span class="token punctuation">{</span> v<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">async_std<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">do1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_mutex_guard_cannot_compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">SomeSharedStructure</span> <span class="token punctuation">{</span> v<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// let s2=s.clone();</span>
    <span class="token namespace">async_std<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">do1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>test_mutex_guard_cannot_compile \u65E0\u6CD5\u7F16\u8BD1\u901A\u8FC7,\u56E0\u4E3A<code>future cannot be sent between threads safely</code> ,\u51C6\u786E\u6765\u8BF4\u5C31\u662F<code>std::sync::MutexGuard</code>\u4E0D\u80FD\u5728\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB. \u8FD9\u4E2A\u5176\u5B9E\u5F88\u5BB9\u6613\u7406\u89E3,Mutex\u5C31\u662F\u4E3A\u4E86\u89E3\u51B3\u7EBF\u7A0B\u540C\u6B65\u95EE\u9898\u7684,\u5DF2\u7ECF\u89E3\u9501\u7684\u6570\u636E\u5982\u679C\u53EF\u4EE5\u5728\u7EBF\u7A0B\u4E4B\u95F4\u4F20\u9012,\u90A3\u4E48Rust\u4FDD\u8BC1\u7684\u7EBF\u7A0B\u5B89\u5168\u5C82\u4E0D\u6210\u4E86\u7B11\u8BDD.</p><p>\u800C<code>async_std::sync::MutexGuard</code>\u5374\u662F\u53EF\u4EE5\u5728\u7EBF\u7A0B\u4E4B\u95F4\u4F20\u9012\u7684,\u5177\u4F53\u53EF\u4EE5\u770Basync-mutex\u8FD9\u4E2Acrate\u7684\u4EE3\u7801:</p><div class="language-rust line-numbers-mode"><pre><code><span class="token comment">/// A guard that releases the mutex when dropped.</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">Send</span> <span class="token keyword">for</span> <span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">Sync</span> <span class="token keyword">for</span> <span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u81F3\u4E8E<code>async_std::sync::MutexGuard</code>\u662F\u5982\u4F55\u4FDD\u8BC1\u65E2\u53EF\u4EE5\u5728\u7EBF\u7A0B\u4E4B\u95F4\u4F20\u9012,\u8FD8\u80FD\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168,\u6211\u4F1A\u5728\u5176\u4ED6\u6587\u7AE0\u4E2D\u4E13\u95E8\u89E3\u91CA.</p><h2 id="\u4E24\u79CD\u9501\u7684\u9009\u7528" tabindex="-1">\u4E24\u79CD\u9501\u7684\u9009\u7528 <a class="header-anchor" href="#\u4E24\u79CD\u9501\u7684\u9009\u7528" aria-hidden="true">#</a></h2><p>\u90A3\u4E48\u95EE\u9898\u6765\u4E86,\u8FD9\u4E24\u79CD\u9501\u6211\u4EEC\u9002\u5408\u5728\u4EC0\u4E48\u573A\u666F\u4E0B\u4F7F\u7528\u5462?</p><ol><li>\u5982\u679C\u9700\u8981\u8DE8await,\u53EA\u80FD\u7528\u5F02\u6B65\u9501</li><li>\u5176\u4ED6\u60C5\u51B5,\u4E24\u79CD\u9501\u968F\u4FBF\u7528\u54EA\u4E2A\u90FD\u53EF\u4EE5?</li></ol><h3 id="tokio\u4E2D\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA" tabindex="-1">tokio\u4E2D\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA <a class="header-anchor" href="#tokio\u4E2D\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA" aria-hidden="true">#</a></h3><p>\u53EF\u4EE5\u5148\u770B\u770B<a href="https://tokio-rs.github.io/tokio/doc/tokio/sync/struct.Mutex.html" target="_blank" rel="noopener noreferrer">tokio\u5173\u4E8E\u5F02\u6B65\u9501\u7684\u89E3\u91CA</a>.</p><div class="language-"><pre><code>Which kind of mutex should you use?
Contrary to popular belief, it is ok and often preferred to use the ordinary Mutex from the standard library in asynchronous code. This section will help you decide on which kind of mutex you should use.
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5355\u6765\u8BF4\u5C31\u662F,\u5982\u679C\u53EF\u4EE5\u7528\u6807\u51C6\u9501\u5C31\u7528\u6807\u51C6\u9501. \u90A3\u4E48\u4E3A\u4EC0\u4E48\u5462?</p><h3 id="\u6807\u51C6\u5E93\u4E2D\u9501\u7684\u4EE3\u4EF7\u9AD8\u4E48" tabindex="-1">\u6807\u51C6\u5E93\u4E2D\u9501\u7684\u4EE3\u4EF7\u9AD8\u4E48? <a class="header-anchor" href="#\u6807\u51C6\u5E93\u4E2D\u9501\u7684\u4EE3\u4EF7\u9AD8\u4E48" aria-hidden="true">#</a></h3><p>\u5728\u6CA1\u8BA4\u771F\u9605\u8BFB\u4EE3\u7801\u4E4B\u524D,\u6211\u4EE5\u4E3A\u5F02\u6B65\u9501\u7684\u4EE3\u4EF7\u8981\u4F4E\u4E00\u4E9B,\u56E0\u4E3A\u4ED6\u4EEC\u662F\u57FA\u4E8Eatomic\u7684,\u52A0\u9501\u4E0D\u4F1A\u89E6\u53D1\u7CFB\u7EDF\u8C03\u7528,\u800C\u6807\u51C6\u9501\u4F1A\u89E6\u53D1\u7CFB\u7EDF\u8C03\u7528,\u4EE3\u4EF7\u6602\u8D35. \u4F46\u662F\u771F\u7684\u662F\u8FD9\u6837\u7684\u4E48? \u8BA9\u6211\u4EEC\u6765\u8DDF\u4E00\u4E0B\u6807\u51C6\u9501\u7684\u5B9E\u73B0.</p><h4 id="_1-lock" tabindex="-1">1. lock <a class="header-anchor" href="#_1-lock" aria-hidden="true">#</a></h4><div class="language-rust line-numbers-mode"><pre><code>    <span class="token attribute attr-name">#[stable(feature = <span class="token string">&quot;rust1&quot;</span>, since = <span class="token string">&quot;1.0.0&quot;</span>)]</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">LockResult</span><span class="token operator">&lt;</span><span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">raw_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MutexGuard</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u6807\u51C6\u9501\u6267\u884C\u7684\u662Finner\u7684raw_lock</p><h4 id="_2-raw-lock" tabindex="-1">2. raw_lock <a class="header-anchor" href="#_2-raw-lock" aria-hidden="true">#</a></h4><div class="language-rust line-numbers-mode"><pre><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MovableMutex</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token namespace">imp<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/// Locks the mutex blocking the current thread until it is available.</span>
    <span class="token attribute attr-name">#[inline]</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">raw_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>self.0\u5B9E\u9645\u4E0A\u662Fimp::Mutex,\u8DDF\u4E0B\u53BB\u5C31\u662F\u6807\u51C6\u5E93\u4EE3\u7801\u4E2D\u7684:<code>src/sys/unix/mutex.rs</code></p><h4 id="_3-\u5E73\u53F0\u76F8\u5173\u7684lock" tabindex="-1">3. \u5E73\u53F0\u76F8\u5173\u7684lock <a class="header-anchor" href="#_3-\u5E73\u53F0\u76F8\u5173\u7684lock" aria-hidden="true">#</a></h4><p>\u8FD9\u91CC\u4EE5linux\u5E73\u53F0\u4E0A\u7684\u5B9E\u73B0\u4E3A\u4F8B,\u6765\u8DDF\u8E2A:</p><div class="language-rust line-numbers-mode"><pre><code>    <span class="token attribute attr-name">#[inline]</span>
    <span class="token keyword">pub</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token namespace">libc<span class="token punctuation">::</span></span><span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">debug_assert_eq!</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\u6700\u7EC8\u8C03\u7528\u7684\u662Flibc::pthread_mutex_lock.</p><h4 id="_4-glibc\u4E2D\u7684pthread-mutex-lock" tabindex="-1">4. glibc\u4E2D\u7684pthread_mutex_lock <a class="header-anchor" href="#_4-glibc\u4E2D\u7684pthread-mutex-lock" aria-hidden="true">#</a></h4><p>\u8FD9\u91CC\u4EE5\u6211\u624B\u5934\u7684glibc 2.23\u4EE3\u7801\u4E3A\u4F8B\u6765\u8FDB\u884C\u8DDF\u8E2A. x86\u5E73\u53F0\u4E0B\u7684pthread_mutex_lock.c\u5B9E\u9645\u4E0A\u7528\u5F97\u662F:<code>#include &quot;nptl/pthread_mutex_lock.c&quot;</code></p><div class="language-c line-numbers-mode"><pre><code>nt
<span class="token function">__pthread_mutex_lock</span> <span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__size<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> type <span class="token operator">=</span> <span class="token function">PTHREAD_MUTEX_TYPE_ELISION</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">LIBC_PROBE</span> <span class="token punctuation">(</span>mutex_entry<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>type <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span>PTHREAD_MUTEX_KIND_MASK_NP
				 <span class="token operator">|</span> PTHREAD_MUTEX_ELISION_FLAGS_NP<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">__pthread_mutex_lock_full</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token function">LIBC_PROBE</span> <span class="token punctuation">(</span>mutex_acquired<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u770B\u6700\u7B80\u5355\u7684\u60C5\u51B5,\u6CA1\u6709\u5176\u4ED6\u4EBA\u6301\u6709\u9501,\u76F4\u63A5\u5C31\u5F97\u5230\u9501\u7684\u60C5\u51B5,\u7B80\u5355\u8BFB\u4E00\u4E0B\u5C31\u53EF\u4EE5\u770B\u5230,\u5B83\u5B9E\u73B0\u7528\u5F97\u4E5F\u662Fatomic\u7684CAS,\u4E5F\u5C31\u662F\u8BF4\u6839\u672C\u6CA1\u6709\u4EC0\u4E48\u7CFB\u7EDF\u8C03\u7528. \u663E\u7136\u76F8\u6BD4async_std/tokio\u4E2D\u7684\u4EE3\u7801,libc\u4E2D\u7684\u4EE3\u7801\u66F4\u52A0\u4E45\u7ECF\u8003\u9A8C,\u4E5F\u66F4\u6E05\u695A\u5404\u4E2A\u5E73\u53F0\u7684\u4F18\u52BF\u548C\u7F3A\u70B9.</p><p>\u5177\u4F53\u7684\u4EE3\u7801\u592A\u957F\u4E86,\u6211\u5C31\u9644\u5728\u4E0B\u9762,\u611F\u5174\u8DA3\u7684\u81EA\u884C\u9605\u8BFB\u5C31\u884C\u4E86.</p><p>\u771F\u7684\u662F**<code>Talk is cheap. Show me the code</code>**, \u4F5C\u4E3A\u7801\u519C\u8FD8\u662F\u5C3D\u91CF\u5C11\u53BB\u731C,\u591A\u53BB\u770B\u4EE3\u7801\u624D\u662F\u5173\u952E.</p><div class="language-c line-numbers-mode"><pre><code><span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">__pthread_mutex_lock_full</span> <span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> oldval<span class="token punctuation">;</span>
  <span class="token class-name">pid_t</span> id <span class="token operator">=</span> <span class="token function">THREAD_GETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> tid<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">PTHREAD_MUTEX_TYPE</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_ROBUST_RECURSIVE_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_ROBUST_ERRORCHECK_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_ROBUST_NORMAL_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_ROBUST_ADAPTIVE_NP<span class="token operator">:</span>
      <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span>
		     <span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__list<span class="token punctuation">.</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>

      oldval <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">;</span>
      <span class="token keyword">do</span>
	<span class="token punctuation">{</span>
	again<span class="token operator">:</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_OWNER_DIED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	      <span class="token comment">/* The previous owner died.  Try locking the mutex.  */</span>
	      <span class="token keyword">int</span> newval <span class="token operator">=</span> id<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">NO_INCR</span></span>
	      newval <span class="token operator">|=</span> FUTEX_WAITERS<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	      newval <span class="token operator">|=</span> <span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_WAITERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

	      newval
		<span class="token operator">=</span> <span class="token function">atomic_compare_and_exchange_val_acq</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
						       newval<span class="token punctuation">,</span> oldval<span class="token punctuation">)</span><span class="token punctuation">;</span>

	      <span class="token keyword">if</span> <span class="token punctuation">(</span>newval <span class="token operator">!=</span> oldval<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
		  oldval <span class="token operator">=</span> newval<span class="token punctuation">;</span>
		  <span class="token keyword">goto</span> again<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	      <span class="token comment">/* We got the mutex.  */</span>
	      mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	      <span class="token comment">/* But it is inconsistent unless marked otherwise.  */</span>
	      mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner <span class="token operator">=</span> PTHREAD_MUTEX_INCONSISTENT<span class="token punctuation">;</span>

	      <span class="token function">ENQUEUE_MUTEX</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	      <span class="token comment">/* Note that we deliberately exit here.  If we fall
		 through to the end of the function __nusers would be
		 incremented which is not correct because the old
		 owner has to be discounted.  If we are not supposed
		 to increment __nusers we actually have to decrement
		 it here.  */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">NO_INCR</span></span>
	      <span class="token operator">--</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__nusers<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

	      <span class="token keyword">return</span> EOWNERDEAD<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>

	  <span class="token comment">/* Check whether we already hold the mutex.  */</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_TID_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	      <span class="token keyword">int</span> kind <span class="token operator">=</span> <span class="token function">PTHREAD_MUTEX_TYPE</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_ROBUST_ERRORCHECK_NP<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
		  <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span>
				 <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token keyword">return</span> EDEADLK<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	      <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_ROBUST_RECURSIVE_NP<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
		  <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span>
				 <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		  <span class="token comment">/* Just bump the counter.  */</span>
		  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		    <span class="token comment">/* Overflow of the counter.  */</span>
		    <span class="token keyword">return</span> EAGAIN<span class="token punctuation">;</span>

		  <span class="token operator">++</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count<span class="token punctuation">;</span>

		  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>

	  oldval <span class="token operator">=</span> <span class="token function">LLL_ROBUST_MUTEX_LOCK</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner
				<span class="token operator">==</span> PTHREAD_MUTEX_NOTRECOVERABLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	      <span class="token comment">/* This mutex is now not recoverable.  */</span>
	      mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	      <span class="token function">lll_unlock</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
			  <span class="token function">PTHREAD_ROBUST_MUTEX_PSHARED</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token keyword">return</span> ENOTRECOVERABLE<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_OWNER_DIED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token function">ENQUEUE_MUTEX</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token comment">/* The PI support requires the Linux futex system call.  If that&#39;s not
       available, pthread_mutex_init should never have allowed the type to
       be set.  So it will get the default case for an invalid type.  */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__NR_futex</span></span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_RECURSIVE_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ERRORCHECK_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_NORMAL_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ADAPTIVE_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ROBUST_RECURSIVE_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ROBUST_ERRORCHECK_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ROBUST_NORMAL_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PI_ROBUST_ADAPTIVE_NP<span class="token operator">:</span>
      <span class="token punctuation">{</span>
	<span class="token keyword">int</span> kind <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__kind <span class="token operator">&amp;</span> PTHREAD_MUTEX_KIND_MASK_NP<span class="token punctuation">;</span>
	<span class="token keyword">int</span> robust <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__kind <span class="token operator">&amp;</span> PTHREAD_MUTEX_ROBUST_NORMAL_NP<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>robust<span class="token punctuation">)</span>
	  <span class="token comment">/* Note: robust PI futexes are signaled by setting bit 0.  */</span>
	  <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uintptr_t</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__list<span class="token punctuation">.</span>__next<span class="token punctuation">)</span>
				   <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	oldval <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">;</span>

	<span class="token comment">/* Check whether we already hold the mutex.  */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_TID_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_ERRORCHECK_NP<span class="token punctuation">)</span>
	      <span class="token punctuation">{</span>
		<span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> EDEADLK<span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>

	    <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_RECURSIVE_NP<span class="token punctuation">)</span>
	      <span class="token punctuation">{</span>
		<span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/* Just bump the counter.  */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		  <span class="token comment">/* Overflow of the counter.  */</span>
		  <span class="token keyword">return</span> EAGAIN<span class="token punctuation">;</span>

		<span class="token operator">++</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count<span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>
	  <span class="token punctuation">}</span>

	<span class="token keyword">int</span> newval <span class="token operator">=</span> id<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">ifdef</span> <span class="token expression">NO_INCR</span></span>
	newval <span class="token operator">|=</span> FUTEX_WAITERS<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">endif</span></span>
	oldval <span class="token operator">=</span> <span class="token function">atomic_compare_and_exchange_val_acq</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
						      newval<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>oldval <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token comment">/* The mutex is locked.  The kernel will now take care of
	       everything.  */</span>
	    <span class="token keyword">int</span> private <span class="token operator">=</span> <span class="token punctuation">(</span>robust
			   <span class="token operator">?</span> <span class="token function">PTHREAD_ROBUST_MUTEX_PSHARED</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span>
			   <span class="token operator">:</span> <span class="token function">PTHREAD_MUTEX_PSHARED</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">INTERNAL_SYSCALL_DECL</span> <span class="token punctuation">(</span>__err<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token function">INTERNAL_SYSCALL</span> <span class="token punctuation">(</span>futex<span class="token punctuation">,</span> __err<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
				      <span class="token function">__lll_private_flag</span> <span class="token punctuation">(</span>FUTEX_LOCK_PI<span class="token punctuation">,</span>
							  private<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">INTERNAL_SYSCALL_ERROR_P</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> __err<span class="token punctuation">)</span>
		<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">INTERNAL_SYSCALL_ERRNO</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> __err<span class="token punctuation">)</span> <span class="token operator">==</span> ESRCH
		    <span class="token operator">||</span> <span class="token function">INTERNAL_SYSCALL_ERRNO</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> __err<span class="token punctuation">)</span> <span class="token operator">==</span> EDEADLK<span class="token punctuation">)</span><span class="token punctuation">)</span>
	      <span class="token punctuation">{</span>
		<span class="token function">assert</span> <span class="token punctuation">(</span><span class="token function">INTERNAL_SYSCALL_ERRNO</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> __err<span class="token punctuation">)</span> <span class="token operator">!=</span> EDEADLK
			<span class="token operator">||</span> <span class="token punctuation">(</span>kind <span class="token operator">!=</span> PTHREAD_MUTEX_ERRORCHECK_NP
			    <span class="token operator">&amp;&amp;</span> kind <span class="token operator">!=</span> PTHREAD_MUTEX_RECURSIVE_NP<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/* ESRCH can happen only for non-robust PI mutexes where
		   the owner of the lock died.  */</span>
		<span class="token function">assert</span> <span class="token punctuation">(</span><span class="token function">INTERNAL_SYSCALL_ERRNO</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> __err<span class="token punctuation">)</span> <span class="token operator">!=</span> ESRCH <span class="token operator">||</span> <span class="token operator">!</span>robust<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/* Delay the thread indefinitely.  */</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		  <span class="token function">pause_not_cancel</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>

	    oldval <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">;</span>

	    <span class="token function">assert</span> <span class="token punctuation">(</span>robust <span class="token operator">||</span> <span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_OWNER_DIED<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> FUTEX_OWNER_DIED<span class="token punctuation">)</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token function">atomic_and</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span> <span class="token operator">~</span>FUTEX_OWNER_DIED<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token comment">/* We got the mutex.  */</span>
	    mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	    <span class="token comment">/* But it is inconsistent unless marked otherwise.  */</span>
	    mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner <span class="token operator">=</span> PTHREAD_MUTEX_INCONSISTENT<span class="token punctuation">;</span>

	    <span class="token function">ENQUEUE_MUTEX_PI</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token comment">/* Note that we deliberately exit here.  If we fall
	       through to the end of the function __nusers would be
	       incremented which is not correct because the old owner
	       has to be discounted.  If we are not supposed to
	       increment __nusers we actually have to decrement it here.  */</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">ifdef</span> <span class="token expression">NO_INCR</span></span>
	    <span class="token operator">--</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__nusers<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">endif</span></span>

	    <span class="token keyword">return</span> EOWNERDEAD<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>robust
	    <span class="token operator">&amp;&amp;</span> <span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner
				 <span class="token operator">==</span> PTHREAD_MUTEX_NOTRECOVERABLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token comment">/* This mutex is now not recoverable.  */</span>
	    mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	    <span class="token function">INTERNAL_SYSCALL_DECL</span> <span class="token punctuation">(</span>__err<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">INTERNAL_SYSCALL</span> <span class="token punctuation">(</span>futex<span class="token punctuation">,</span> __err<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
			      <span class="token function">__lll_private_flag</span> <span class="token punctuation">(</span>FUTEX_UNLOCK_PI<span class="token punctuation">,</span>
						  <span class="token function">PTHREAD_ROBUST_MUTEX_PSHARED</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">return</span> ENOTRECOVERABLE<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>

	mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>robust<span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token function">ENQUEUE_MUTEX_PI</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> robust_head<span class="token punctuation">.</span>list_op_pending<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">/* __NR_futex.  */</span></span>

    <span class="token keyword">case</span> PTHREAD_MUTEX_PP_RECURSIVE_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PP_ERRORCHECK_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PP_NORMAL_NP<span class="token operator">:</span>
    <span class="token keyword">case</span> PTHREAD_MUTEX_PP_ADAPTIVE_NP<span class="token operator">:</span>
      <span class="token punctuation">{</span>
	<span class="token keyword">int</span> kind <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__kind <span class="token operator">&amp;</span> PTHREAD_MUTEX_KIND_MASK_NP<span class="token punctuation">;</span>

	oldval <span class="token operator">=</span> mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">;</span>

	<span class="token comment">/* Check whether we already hold the mutex.  */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner <span class="token operator">==</span> id<span class="token punctuation">)</span>
	  <span class="token punctuation">{</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_ERRORCHECK_NP<span class="token punctuation">)</span>
	      <span class="token keyword">return</span> EDEADLK<span class="token punctuation">;</span>

	    <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> PTHREAD_MUTEX_RECURSIVE_NP<span class="token punctuation">)</span>
	      <span class="token punctuation">{</span>
		<span class="token comment">/* Just bump the counter.  */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		  <span class="token comment">/* Overflow of the counter.  */</span>
		  <span class="token keyword">return</span> EAGAIN<span class="token punctuation">;</span>

		<span class="token operator">++</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count<span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>
	  <span class="token punctuation">}</span>

	<span class="token keyword">int</span> oldprio <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ceilval<span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	  <span class="token punctuation">{</span>
	    <span class="token keyword">int</span> ceiling <span class="token operator">=</span> <span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> PTHREAD_MUTEX_PRIO_CEILING_MASK<span class="token punctuation">)</span>
			  <span class="token operator">&gt;&gt;</span> PTHREAD_MUTEX_PRIO_CEILING_SHIFT<span class="token punctuation">;</span>

	    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__pthread_current_priority</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> ceiling<span class="token punctuation">)</span>
	      <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>oldprio <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		  <span class="token function">__pthread_tpp_change_priority</span> <span class="token punctuation">(</span>oldprio<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> EINVAL<span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>

	    <span class="token keyword">int</span> retval <span class="token operator">=</span> <span class="token function">__pthread_tpp_change_priority</span> <span class="token punctuation">(</span>oldprio<span class="token punctuation">,</span> ceiling<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>retval<span class="token punctuation">)</span>
	      <span class="token keyword">return</span> retval<span class="token punctuation">;</span>

	    ceilval <span class="token operator">=</span> ceiling <span class="token operator">&lt;&lt;</span> PTHREAD_MUTEX_PRIO_CEILING_SHIFT<span class="token punctuation">;</span>
	    oldprio <span class="token operator">=</span> ceiling<span class="token punctuation">;</span>

	    oldval
	      <span class="token operator">=</span> <span class="token function">atomic_compare_and_exchange_val_acq</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">NO_INCR</span></span>
						     ceilval <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
						     ceilval <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
						     ceilval<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldval <span class="token operator">==</span> ceilval<span class="token punctuation">)</span>
	      <span class="token keyword">break</span><span class="token punctuation">;</span>

	    <span class="token keyword">do</span>
	      <span class="token punctuation">{</span>
		oldval
		  <span class="token operator">=</span> <span class="token function">atomic_compare_and_exchange_val_acq</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
							 ceilval <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span>
							 ceilval <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> PTHREAD_MUTEX_PRIO_CEILING_MASK<span class="token punctuation">)</span> <span class="token operator">!=</span> ceilval<span class="token punctuation">)</span>
		  <span class="token keyword">break</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>oldval <span class="token operator">!=</span> ceilval<span class="token punctuation">)</span>
		  <span class="token function">lll_futex_wait</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span> ceilval <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span>
				  <span class="token function">PTHREAD_MUTEX_PSHARED</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span>
	    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">atomic_compare_and_exchange_val_acq</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__lock<span class="token punctuation">,</span>
							ceilval <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span> ceilval<span class="token punctuation">)</span>
		   <span class="token operator">!=</span> ceilval<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldval <span class="token operator">&amp;</span> PTHREAD_MUTEX_PRIO_CEILING_MASK<span class="token punctuation">)</span> <span class="token operator">!=</span> ceilval<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">assert</span> <span class="token punctuation">(</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">/* Correct code cannot set any other type.  */</span>
      <span class="token keyword">return</span> EINVAL<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment">/* Record the ownership.  */</span>
  mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__owner <span class="token operator">=</span> id<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">NO_INCR</span></span>
  <span class="token operator">++</span>mutex<span class="token operator">-&gt;</span>__data<span class="token punctuation">.</span>__nusers<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

  <span class="token function">LIBC_PROBE</span> <span class="token punctuation">(</span>mutex_acquired<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br></div></div>`,40),o=[e];function c(l,u,r,i,k,b){return a(),s("div",null,o)}var d=n(t,[["render",c]]);export{_ as __pageData,d as default};
