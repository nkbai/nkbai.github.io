import{_ as a,c as e,o as n,a as s}from"./app.8e8e8923.js";const g='{"title":"\u5982\u4F55\u4F7F\u7528 smartraiden \u4EE5\u53CA lnd \u8FDB\u884C\u8DE8\u94FE\u539F\u5B50\u8D44\u4EA7\u4EA4\u6362","description":"","frontmatter":{"title":"\u5982\u4F55\u4F7F\u7528 smartraiden \u4EE5\u53CA lnd \u8FDB\u884C\u8DE8\u94FE\u539F\u5B50\u8D44\u4EA7\u4EA4\u6362","date":"2018-08-30T13:01:43.000Z","draft":false,"markup":"mmark"},"headers":[{"level":3,"title":"\u95EE\u9898","slug":"\u95EE\u9898"},{"level":3,"title":"\u5B9E\u73B0\u65B9\u6CD5","slug":"\u5B9E\u73B0\u65B9\u6CD5"},{"level":3,"title":"\u65F6\u5E8F\u56FE","slug":"\u65F6\u5E8F\u56FE"},{"level":3,"title":"smartraiden \u63A5\u53E3\u8BBE\u8BA1","slug":"smartraiden-\u63A5\u53E3\u8BBE\u8BA1"},{"level":2,"title":"\u5176\u4ED6","slug":"\u5176\u4ED6"}],"relativePath":"blockchain/ethereum/\u5982\u4F55\u4F7F\u7528 smartraiden \u4EE5\u53CA lnd \u8FDB\u884C\u8DE8\u94FE\u539F\u5B50\u8D44\u4EA7\u4EA4\u6362.md"}',t={},r=s(`<h1 id="\u53BB\u4E2D\u5FC3\u5316\u4EA4\u6613\u6240-mvp" tabindex="-1">\u53BB\u4E2D\u5FC3\u5316\u4EA4\u6613\u6240 MVP <a class="header-anchor" href="#\u53BB\u4E2D\u5FC3\u5316\u4EA4\u6613\u6240-mvp" aria-hidden="true">#</a></h1><p>smartraiden \u548C lighting network \u8FDB\u884C\u8DE8\u94FE\u539F\u5B50\u8D44\u4EA7\u4EA4\u6362</p><h3 id="\u95EE\u9898" tabindex="-1">\u95EE\u9898 <a class="header-anchor" href="#\u95EE\u9898" aria-hidden="true">#</a></h3><ol><li>Alice \u5728\u67D0\u4E2A\u4FE1\u606F\u53D1\u5E03\u7F51\u7AD9\u4E0A\u53D1\u5E03\u4FE1\u606F,\u5E0C\u671B\u75281\u4E2A BTC \u7F6E\u6362100\u4E2A SMT</li><li>Bob \u770B\u5230\u4EE5\u540E,\u548C Alice \u8FDB\u884C\u6C9F\u901A,\u8FBE\u6210\u4EA4\u6362\u610F\u89C1 \u90A3\u4E48Alice \u548C Bob \u5982\u4F55\b\u4E0D\u9700\u8981\u501F\u52A9\u4EFB\u4F55\u7B2C\u4E09\u65B9\u5B9E\u73B0\u539F\u5B50\u8D44\u4EA7\u7F6E\u6362\u5462</li></ol><h3 id="\u5B9E\u73B0\u65B9\u6CD5" tabindex="-1">\u5B9E\u73B0\u65B9\u6CD5 <a class="header-anchor" href="#\u5B9E\u73B0\u65B9\u6CD5" aria-hidden="true">#</a></h3><h4 id="_1-bob\u548C-alice-\u5206\u522B\u542F\u52A8\u81EA\u5DF1\u7684-exchange-\u670D\u52A1" tabindex="-1">1. Bob\u548C Alice \u5206\u522B\u542F\u52A8\u81EA\u5DF1\u7684 ExChange \u670D\u52A1 <a class="header-anchor" href="#_1-bob\u548C-alice-\u5206\u522B\u542F\u52A8\u81EA\u5DF1\u7684-exchange-\u670D\u52A1" aria-hidden="true">#</a></h4><p>Exchange \u670D\u52A1\u4F1A\u542F\u52A8\u54CD\u5E94\u7684SmartRaiden\u548CLnd \u5047\u8BBE Alice \u5728SmartRaiden\u7684\u8282\u70B9\b\u4F7F\u7528\u7684\u79C1\u94A5\u4E3A SA_Priv, \u516C\u94A5\u4E3A SA, \u5728 Lnd \u8282\u70B9\u4F7F\u7528\u7684\u79C1\u94A5\u4E3A LA_Priv, \u516C\u94A5\u4E3A LA \u5047\u8BBE Bob \u5728 SmartRaiden \u8282\u70B9\u4F7F\u7528\u7684\u79C1\u94A5\u4E3A SB_Priv, \u516C\u94A5\u4E3A SB, \u5728 Lnd \u8282\u70B9\u4F7F\u7528\u7684\u79C1\u94A5\u4E3A LB_Priv, \u516C\u94A5\u4E3A LB</p><h4 id="_2-bob-\u7684exchange\u670D\u52A1" tabindex="-1">2. Bob \u7684Exchange\b\u670D\u52A1 <a class="header-anchor" href="#_2-bob-\u7684exchange\u670D\u52A1" aria-hidden="true">#</a></h4><h5 id="_2-1-bob\u53D1\u8D77\u4EA4\u6613-\u6307\u5B9Asecret-\u91D1\u989D\u4E3A100-token-\u4E3A-smt-\u63A5\u6536\u65B9\u4E3A-sa" tabindex="-1">2.1 Bob\u53D1\u8D77\u4EA4\u6613,\u6307\u5B9ASecret,\u91D1\u989D\u4E3A100,token \u4E3A SMT,\u63A5\u6536\u65B9\u4E3A SA <a class="header-anchor" href="#_2-1-bob\u53D1\u8D77\u4EA4\u6613-\u6307\u5B9Asecret-\u91D1\u989D\u4E3A100-token-\u4E3A-smt-\u63A5\u6536\u65B9\u4E3A-sa" aria-hidden="true">#</a></h5><ul><li>--&gt;\u8C03\u7528 Transfer \u63A5\u53E3</li></ul><h5 id="_2-2-bob\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E00\u4E2A\u91D1\u989D\u4E3A1btc-\u5BC6\u7801-hash-\u4E3A-sha256-secret" tabindex="-1">2.2 Bob\b\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E00\u4E2A\u91D1\u989D\u4E3A1BTC,\u5BC6\u7801 hash \u4E3A Sha256(Secret), <a class="header-anchor" href="#_2-2-bob\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E00\u4E2A\u91D1\u989D\u4E3A1btc-\u5BC6\u7801-hash-\u4E3A-sha256-secret" aria-hidden="true">#</a></h5><ul><li>--&gt;\u901A\u8FC7 listinvoices\u63A5\u53E3\u8F6E\u8BE2</li></ul><h5 id="_2-3-\u6536\u5230\u4EE5\u540E-\u5141\u8BB8\u81EA\u5DF1\u7684-smartraiden-\u54CD\u5E94-secretrequest" tabindex="-1">2.3 \u6536\u5230\u4EE5\u540E,\u5141\u8BB8\u81EA\u5DF1\u7684 SmartRaiden \u54CD\u5E94 SecretRequest <a class="header-anchor" href="#_2-3-\u6536\u5230\u4EE5\u540E-\u5141\u8BB8\u81EA\u5DF1\u7684-smartraiden-\u54CD\u5E94-secretrequest" aria-hidden="true">#</a></h5><ul><li>--&gt;\u901A\u8FC7/api/1/allowrevealsecret \u63A5\u53E3</li></ul><h4 id="_3-alice-\u7684exchange-\u670D\u52A1" tabindex="-1">3. Alice \u7684ExChange \u670D\u52A1 <a class="header-anchor" href="#_3-alice-\u7684exchange-\u670D\u52A1" aria-hidden="true">#</a></h4><h5 id="_3-1-alice-\u5728-smartraiden-\u4E0A\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E86\u6765\u81EA-bob-\u7684100\u4E2A-smt\u4EA4\u6613" tabindex="-1">3.1 Alice \u5728 SmartRaiden \u4E0A\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E86\u6765\u81EA Bob \u7684100\u4E2A SMT\u4EA4\u6613 <a class="header-anchor" href="#_3-1-alice-\u5728-smartraiden-\u4E0A\u7B49\u5F85\u662F\u5426\u6536\u5230\u4E86\u6765\u81EA-bob-\u7684100\u4E2A-smt\u4EA4\u6613" aria-hidden="true">#</a></h5><ul><li>--&gt;\u901A\u8FC7/api/1/getunfinishedreceivedtransfer/:tokenaddress/:locksecrethash\u63A5\u53E3\u8F6E\u8BE2 <h5 id="_3-2-\u4E00\u65E6\u6536\u5230-alice-\u6821\u9A8C\u8BE5\u4EA4\u6613\u662F\u5426\u6709\u6548-\u6BD4\u5982-expiration-\u65F6\u95F4\u662F\u5426\u8DB3\u591F-\u5FC5\u987B\u5927\u4E8E125\u5206\u949F-500spectrum-\u5757" tabindex="-1">3.2 \u4E00\u65E6\u6536\u5230, Alice \u6821\u9A8C\u8BE5\u4EA4\u6613\u662F\u5426\u6709\u6548,\u6BD4\u5982 Expiration \u65F6\u95F4\u662F\u5426\u8DB3\u591F,\u5FC5\u987B\u5927\u4E8E125\u5206\u949F(500Spectrum \u5757) <a class="header-anchor" href="#_3-2-\u4E00\u65E6\u6536\u5230-alice-\u6821\u9A8C\u8BE5\u4EA4\u6613\u662F\u5426\u6709\u6548-\u6BD4\u5982-expiration-\u65F6\u95F4\u662F\u5426\u8DB3\u591F-\u5FC5\u987B\u5927\u4E8E125\u5206\u949F-500spectrum-\u5757" aria-hidden="true">#</a></h5><h5 id="_3-3-\u5982\u679C\u90FD\u4E00\u81F4-\u90A3\u4E48\u901A\u8FC7\u5411\u81EA\u5DF1\u7684-lnd-\u6CE8\u518C\u8FD9\u4E2A-paymentreq-\u5E76\u6307\u5B9A\u8FC7\u671F\u65F6\u95F4\u4E3A100\u5206\u949F-secrethash" tabindex="-1">3.3 \u5982\u679C\u90FD\u4E00\u81F4,\u90A3\u4E48\u901A\u8FC7\u5411\u81EA\u5DF1\u7684 Lnd \u6CE8\u518C\u8FD9\u4E2A PaymentReq,\u5E76\u6307\u5B9A\u8FC7\u671F\u65F6\u95F4\u4E3A100\u5206\u949F,\bsecretHash <a class="header-anchor" href="#_3-3-\u5982\u679C\u90FD\u4E00\u81F4-\u90A3\u4E48\u901A\u8FC7\u5411\u81EA\u5DF1\u7684-lnd-\u6CE8\u518C\u8FD9\u4E2A-paymentreq-\u5E76\u6307\u5B9A\u8FC7\u671F\u65F6\u95F4\u4E3A100\u5206\u949F-secrethash" aria-hidden="true">#</a></h5></li><li>--&gt;SendPaymentSync \u63A5\u53E3 <h5 id="_3-5-\u68C0\u6D4B-lnd-\u662F\u5426\u6536\u5230\u4E86\u5BC6\u7801-\u5982\u679C\u6536\u5230\u4E86-\u7ACB\u5373\u5411-\u81EA\u5DF1\u7684smartraiden-\u6CE8\u518C\u5BC6\u7801" tabindex="-1">3.5 \u68C0\u6D4B Lnd \u662F\u5426\u6536\u5230\u4E86\u5BC6\u7801,\u5982\u679C\u6536\u5230\u4E86,\u7ACB\u5373\u5411 \u81EA\u5DF1\u7684SmartRaiden \u6CE8\u518C\u5BC6\u7801 <a class="header-anchor" href="#_3-5-\u68C0\u6D4B-lnd-\u662F\u5426\u6536\u5230\u4E86\u5BC6\u7801-\u5982\u679C\u6536\u5230\u4E86-\u7ACB\u5373\u5411-\u81EA\u5DF1\u7684smartraiden-\u6CE8\u518C\u5BC6\u7801" aria-hidden="true">#</a></h5></li><li>--&gt;\b\u6839\u636E SendPaymentSync \u7684\u8FD4\u56DE\u5F97\u5230\u5BC6\u7801,\u8C03\u7528/api/1/registersecret\u6CE8\u518C\u5BC6\u7801</li></ul><h3 id="\u65F6\u5E8F\u56FE" tabindex="-1">\u65F6\u5E8F\u56FE <a class="header-anchor" href="#\u65F6\u5E8F\u56FE" aria-hidden="true">#</a></h3><pre class="mermaid loading">sequenceDiagram
    participant ae as  Alice&#39;s Exchange
    participant al as Alice&#39;s Lnd
    participant as as Alice&#39;s smartraiden
   participant space
    participant bs as Bob&#39;s smartraiden
    participant bl as Bob&#39;s Lnd
     participant be as Bob&#39;s Exchange
    
    be-&gt;&gt;ae:\u53EF\u4EE5\u7528\u6211\u7684100SMT \u6362\u4F60\u76841\u4E2A BTC?
    ae-&gt;&gt;be:\u6CA1\u95EE\u9898
    be-&gt;&gt;bs: send Transfer to Alice ,Secret,100,SMT
    be-&gt;&gt;bl: \u51C6\u5907\u597D\u63A5\u6536\u91D1\u989D\u4E3A1BTC,\u5BC6\u7801\u4E3A Secret \u7684\u4EA4\u6613
    bs-&gt;&gt;as: MediatedTransfer(Secret,100SMT,from Bob to Alice,Expiration=600)
    as-&gt;&gt;ae:\u6536\u5230\u4E86\u6709\u6548\u7684 MediatedTransfer
    ae-&gt;&gt;al:\u5411bob\u53D1\u8D77\u95EA\u7535\u7F51\u7EDC\u4EA4\u6613(1BTC,secertHash,Expiration=10Block)
    al-&gt;&gt;bl:send payment to bob(1BTC,secertHash,Expiration=10Block)
    bl-&gt;&gt;al:\u51ED Secret \u6362\u56DE1BTC
    bl-&gt;&gt;be: \u6536\u5230\u4E86\u6709\u6548\u7684 HTLC
    loop bob wait
        be-&gt;&gt;be: \u6536\u5230\u4E86\u6765\u81EA Alice \u76841BTC?
    end    
    be-&gt;&gt;bs:\u54CD\u5E94\u6765\u81EA\bAlice&#39;s smartraiden \u7684 SecretRequest
    bs-&gt;&gt;as: send secret to Alice,\u5F00\u59CB\u6B63\u5E38\u96F7\u7535\u4EA4\u6613
    loop alice wait
        al-&gt;&gt;al: \u662F\u5426\u6536\u5230\u4E86 Secret( \u5305\u62EC\u94FE\u4E0A\u6CE8\u518C\u7684\u5BC6\u7801)
    end
    ae-&gt;&gt;as: \u6CE8\u518C\u5BC6\u7801</pre><h3 id="smartraiden-\u63A5\u53E3\u8BBE\u8BA1" tabindex="-1">smartraiden \u63A5\u53E3\u8BBE\u8BA1 <a class="header-anchor" href="#smartraiden-\u63A5\u53E3\u8BBE\u8BA1" aria-hidden="true">#</a></h3><ol><li>\u53D1\u8D77\u4EA4\u6613 POST /api/1/transfer/:token/:receipt</li></ol><div class="language-go line-numbers-mode"><pre><code><span class="token keyword">type</span> TransferData <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Initiator      <span class="token builtin">string</span>   <span class="token string">\`json:&quot;initiator_address&quot;\`</span>
	Target         <span class="token builtin">string</span>   <span class="token string">\`json:&quot;target_address&quot;\`</span>
	Token          <span class="token builtin">string</span>   <span class="token string">\`json:&quot;token_address&quot;\`</span>
	Amount         <span class="token operator">*</span>big<span class="token punctuation">.</span>Int <span class="token string">\`json:&quot;amount&quot;\`</span>
	Secret       <span class="token builtin">string</span>   <span class="token string">\`json:&quot;secret&quot;\`</span>
	Fee            <span class="token operator">*</span>big<span class="token punctuation">.</span>Int <span class="token string">\`json:&quot;fee&quot;\`</span>
    IsDirect       <span class="token builtin">bool</span>     <span class="token string">\`json:&quot;is_direct&quot;\`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>\u5141\u8BB8\u54CD\u5E94 SecretRequest POST /api/1/allowrevealsecret/</li></ol><div class="language-"><pre><code>{
    &quot;lock_secret_hash&quot;:&quot;0xaaaa&quot;,
    &quot;token_address&quot;:&quot;0xbbbbb&quot;,
}
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u8BBE\u7F6E\u4EA4\u6613\u53D1\u8D77\u65B9\u5BF9\u5E94\u7684\u8FD9\u4E2A SecretRequest \u5141\u8BB8\u54CD\u5E94 3. \u67E5\u8BE2\u672A\u5B8C\u6210\u6536\u5230\u4EA4\u6613 GET /api/1/getunfinishedreceivedtransfer/:tokenaddress/:locksecrethash</p><div class="language-go line-numbers-mode"><pre><code>   <span class="token keyword">type</span> TransferData <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Initiator      <span class="token builtin">string</span>   <span class="token string">\`json:&quot;initiator_address&quot;\`</span>
	Target         <span class="token builtin">string</span>   <span class="token string">\`json:&quot;target_address&quot;\`</span>
	Token          <span class="token builtin">string</span>   <span class="token string">\`json:&quot;token_address&quot;\`</span>
	Amount         <span class="token operator">*</span>big<span class="token punctuation">.</span>Int <span class="token string">\`json:&quot;amount&quot;\`</span>
    LockSecretHash       <span class="token builtin">string</span>   <span class="token string">\`json:&quot;lock_secret_hash&quot;\`</span>
    Expiration <span class="token builtin">uint64</span>  <span class="token comment">//\u76F8\u5BF9\u4E8E\u5F53\u524D\u5757\u8FD8\u6709\u591A\u5C11\u5757\u8FC7\u671F</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u6CE8\u518C\u5BC6\u7801 POST /api/1/registersecret</li></ol><div class="language-"><pre><code>{
    &quot;secret&quot;:&quot;0xaaaaaaa&quot;,
    &quot;token_address&quot;:&quot;0xbbbbbbb&quot;,
}
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5C06\u5BC6\u7801\u6CE8\u518C\u5230\u76F8\u5E94\u7684 channel \u4E2D,\u5E76\u4E14\u5C06 secret \u4E5F\u6CE8\u518C\u5230\u5BF9\u5E94\u7684 TargetStateManager</p><h2 id="\u5176\u4ED6" tabindex="-1">\u5176\u4ED6 <a class="header-anchor" href="#\u5176\u4ED6" aria-hidden="true">#</a></h2><p>\u95EA\u7535\u7F51\u7EDC\u4E2D\u5BC6\u7801\u7684 hash \u503C\u8BA1\u7B97\u65B9\u5F0F\u4E3A rHash := sha256.Sum256(paymentPreimage[:])</p>`,31),i=[r];function l(c,o,p,d,b,u){return n(),e("div",null,i)}var m=a(t,[["render",l]]);export{g as __pageData,m as default};
