import{_ as s,c as a,o as n,N as l}from"./chunks/framework.3a9190c5.js";const C=JSON.parse('{"title":"用 go 写 WebAssembly入门","description":"","frontmatter":{"title":"用 go 写 WebAssembly入门","date":"2018-09-07T01:14:10.000Z","draft":false,"markup":"mmark"},"headers":[],"relativePath":"other/用 go 写 WebAssembly入门.md"}'),p={name:"other/用 go 写 WebAssembly入门.md"},e=l(`<h1 id="golang-webassembly-入门" tabindex="-1">Golang WebAssembly 入门 <a class="header-anchor" href="#golang-webassembly-入门" aria-label="Permalink to &quot;Golang WebAssembly 入门&quot;">​</a></h1><p>Golang 在1.11版本中引入了 WebAssembly 支持,意味着以后可以用 go编写可以在浏览器中运行的程序,当然这个肯定也是要受浏览器沙盒环境约束的.</p><h2 id="_1-浏览器中运行-go" tabindex="-1">1. 浏览器中运行 Go <a class="header-anchor" href="#_1-浏览器中运行-go" aria-label="Permalink to &quot;1. 浏览器中运行 Go&quot;">​</a></h2><h3 id="_1-1-code" tabindex="-1">1.1 code <a class="header-anchor" href="#_1-1-code" aria-label="Permalink to &quot;1.1 code&quot;">​</a></h3><div class="language-go line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello, WebAssembly!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-2-编译" tabindex="-1">1.2 编译 <a class="header-anchor" href="#_1-2-编译" aria-label="Permalink to &quot;1.2 编译&quot;">​</a></h3><p>必须是 go1.11才行</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">GOARCH=wasm GOOS=js go build -o test.wasm main.go</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_1-3-运行" tabindex="-1">1.3 运行 <a class="header-anchor" href="#_1-3-运行" aria-label="Permalink to &quot;1.3 运行&quot;">​</a></h3><p>单独的 wasm 文件是无法直接运行的,必须载入浏览器中.</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test.wasm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> $GOROOT</span><span style="color:#C3E88D;">/misc/wasm/wasm_exec.{html,js}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-3-1-一个测试-http-服务器" tabindex="-1">1.3.1 一个测试 http 服务器 <a class="header-anchor" href="#_1-3-1-一个测试-http-服务器" aria-label="Permalink to &quot;1.3.1 一个测试 http 服务器&quot;">​</a></h4><p>chrome 是不支持本地文件中运行 wasm 的,所以必须有一个 http 服务器</p><div class="language-go line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//http.go</span></span>
<span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">flag</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">log</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">net/http</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">strings</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	listen </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> flag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:8080</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listen address</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	dir    </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> flag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">directory to serve</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	flag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Parse</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">	log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listening on %q...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Fatal</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ListenAndServe</span><span style="color:#89DDFF;">(*</span><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">HandlerFunc</span><span style="color:#89DDFF;">(func(</span><span style="color:#A6ACCD;">resp http</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ResponseWriter</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> req </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Request</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> strings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">HasSuffix</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">URL</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.wasm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Header</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">Set</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content-type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/wasm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">FileServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Dir</span><span style="color:#89DDFF;">(*</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">)).</span><span style="color:#82AAFF;">ServeHTTP</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resp</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> req</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">})))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_1-3-2-http-go" tabindex="-1">1.3.2 http.go <a class="header-anchor" href="#_1-3-2-http-go" aria-label="Permalink to &quot;1.3.2 http.go&quot;">​</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http.go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#FFCB6B;">go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http.go</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-4-效果" tabindex="-1">1.4 效果 <a class="header-anchor" href="#_1-4-效果" aria-label="Permalink to &quot;1.4 效果&quot;">​</a></h4><p>在浏览器中打开<code>http://localhost:8080/wasm_exec.html</code>,点击 run 按钮,可以在控制台看到 Hello, WebAssembly!字符串</p><h2 id="_2-node中运行-wasm" tabindex="-1">2. node中运行 wasm <a class="header-anchor" href="#_2-node中运行-wasm" aria-label="Permalink to &quot;2. node中运行 wasm&quot;">​</a></h2><p>这个更直接</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node wasm_exec.js test.wasm</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>就可以在控制台看到Hello, WebAssembly!字符串了.</p><h2 id="_3-其他例子" tabindex="-1">3. 其他例子 <a class="header-anchor" href="#_3-其他例子" aria-label="Permalink to &quot;3. 其他例子&quot;">​</a></h2><p>在<a href="https://github.com/stdiopt/gowasm-experiments" target="_blank" rel="noreferrer"> example</a>中可以看到更多例子</p><h3 id="_3-1-bouncy" tabindex="-1">3.1 bouncy <a class="header-anchor" href="#_3-1-bouncy" aria-label="Permalink to &quot;3.1 bouncy&quot;">​</a></h3><p><img alt="" data-src="https://img2018.cnblogs.com/blog/124391/201809/124391-20180907090933841-1091730982.png" loading="lazy" class="lazy"></p><h3 id="_3-2-ranbow-mouse" tabindex="-1">3.2 ranbow-mouse <a class="header-anchor" href="#_3-2-ranbow-mouse" aria-label="Permalink to &quot;3.2 ranbow-mouse&quot;">​</a></h3><p>会跟着鼠标画出彩虹图案,挺好看的 <img alt="" data-src="https://img2018.cnblogs.com/blog/124391/201809/124391-20180907091057014-1717034536.png" loading="lazy" class="lazy"></p><h3 id="_3-3-bumpy" tabindex="-1">3.3 bumpy <a class="header-anchor" href="#_3-3-bumpy" aria-label="Permalink to &quot;3.3 bumpy&quot;">​</a></h3><p>可以画一些自定义的形状,形状不同,落地效果不同.球就会反弹,三角形就不会.不过都摔不坏,不会变形,这点不够真实 <img alt="" data-src="https://img2018.cnblogs.com/blog/124391/201809/124391-20180907091344841-321938760.png" loading="lazy" class="lazy"></p>`,30),o=[e];function t(r,c,D,i,F,y){return n(),a("div",null,o)}const b=s(p,[["render",t]]);export{C as __pageData,b as default};
