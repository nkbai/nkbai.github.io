import{_ as a,c as s,o as e,N as n}from"./chunks/framework.3a9190c5.js";const m=JSON.parse('{"title":"使用ubuntu搭建时间机器备份服务","description":"","frontmatter":{"title":"使用ubuntu搭建时间机器备份服务","date":"2018-11-20T04:15:04.000Z","draft":false,"markup":"mmark"},"headers":[],"relativePath":"other/使用ubuntu搭建时间机器备份服务.md"}'),l={name:"other/使用ubuntu搭建时间机器备份服务.md"},t=n(`<h1 id="如何在ubuntu下搭建时间备份服务" tabindex="-1">如何在ubuntu下搭建时间备份服务 <a class="header-anchor" href="#如何在ubuntu下搭建时间备份服务" aria-label="Permalink to &quot;如何在ubuntu下搭建时间备份服务&quot;">​</a></h1><p>折腾了很久,终于可以了. 请严格按照下面的方式来操作. 真正明白问题的,可以按照自己的思路来. 我用的是ubnutu 16.04</p><h2 id="安装配置netatalk" tabindex="-1">安装配置netatalk <a class="header-anchor" href="#安装配置netatalk" aria-label="Permalink to &quot;安装配置netatalk&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">netatalk</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="修改配置文件-etc-default-netatalk" tabindex="-1">修改配置文件 /etc/default/netatalk <a class="header-anchor" href="#修改配置文件-etc-default-netatalk" aria-label="Permalink to &quot;修改配置文件 /etc/default/netatalk&quot;">​</a></h4><div class="language-conf line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ATALKD_RUN=no</span></span>
<span class="line"><span style="color:#A6ACCD;">PAPD_RUN=no</span></span>
<span class="line"><span style="color:#A6ACCD;">CNID_METAD_RUN=yes</span></span>
<span class="line"><span style="color:#A6ACCD;">AFPD_RUN=yes</span></span>
<span class="line"><span style="color:#A6ACCD;">TIMELORD_RUN=no</span></span>
<span class="line"><span style="color:#A6ACCD;">A2BOOT_RUN=no</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="修改-etc-netatalk-applevolumes-default" tabindex="-1">修改/etc/netatalk/AppleVolumes.default <a class="header-anchor" href="#修改-etc-netatalk-applevolumes-default" aria-label="Permalink to &quot;修改/etc/netatalk/AppleVolumes.default&quot;">​</a></h4><div class="language-conf line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">/your/path  VolumeName</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意不要添加allow:@groupname options:usedots,upriv这些信息</p><h4 id="修改-etc-netatalk-afpd-conf" tabindex="-1">修改/etc/netatalk/afpd.conf <a class="header-anchor" href="#修改-etc-netatalk-afpd-conf" aria-label="Permalink to &quot;修改/etc/netatalk/afpd.conf&quot;">​</a></h4><p>添加如下内容: [Time Machine Voume] path = /home/bai/data time machine = yes spotlight = no valid users = bai</p><h4 id="重启" tabindex="-1">重启 <a class="header-anchor" href="#重启" aria-label="Permalink to &quot;重启&quot;">​</a></h4><p>sudo /etc/init.d/netatalk restart</p><p>这时候通过finder 就可以看到共享文件夹了 选择服务器--&gt;afp://your ip</p><h2 id="mac-配置" tabindex="-1">mac 配置 <a class="header-anchor" href="#mac-配置" aria-label="Permalink to &quot;mac 配置&quot;">​</a></h2><p>启用网络共享服务器作为时间机器配置目标.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">defaults</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">write</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com.apple.systempreferences</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TMShowUnsupportedNetworkVolumes</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这时候你的时间机器磁盘列表中应该是空的,如果你的不是空,那就直接备份,跳过以下步骤.</p><h4 id="创建备份-sparsebundle" tabindex="-1">创建备份 sparsebundle <a class="header-anchor" href="#创建备份-sparsebundle" aria-label="Permalink to &quot;创建备份 sparsebundle&quot;">​</a></h4><p>选择磁盘工具,在你的共享目录中创建一个用于备份的sparsebundle文件夹,一定要足够大. 如果你的磁盘中有区分大小写的文件系统,请务必选择<code>Mac OS 扩展（区分大小写，日志式）</code>这种格式. 当然如果没有区分大小写的文件系统,创建成这样,也没有任何问题.</p><p>至于创建的过程有很多我就不说了,关键是创建的结果一定要如下图,比如你选了不一样的文件系统,比如apfs,不一样的格式,比如sparseimage,都有可能不成功.</p><p><img alt="时间机器" data-src="https://img2018.cnblogs.com/blog/124391/201811/124391-20181120121204888-1173606625.png" loading="lazy" class="lazy"> 这时候你的时间机器列表中还应该是空的,没办法,只能通过命令行了.</p><h4 id="启动备份" tabindex="-1">启动备份 <a class="header-anchor" href="#启动备份" aria-label="Permalink to &quot;启动备份&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tmutil</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">setdestination</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/Volumes/bk_macos</span></span>
<span class="line"><span style="color:#FFCB6B;">tmutil</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">startbackup</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我这么一路下来成功了,你可能会碰到很多问题,说真的,mac的时间机器用起来真心不方便.</p><h2 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-label="Permalink to &quot;参考链接&quot;">​</a></h2><p><a href="https://missingreadme.wordpress.com/2010/05/08/how-to-set-up-afp-filesharing-on-ubuntu/" target="_blank" rel="noreferrer">https://missingreadme.wordpress.com/2010/05/08/how-to-set-up-afp-filesharing-on-ubuntu/</a></p>`,27),p=[t];function o(r,c,i,u,d,h){return e(),s("div",null,p)}const C=a(l,[["render",o]]);export{m as __pageData,C as default};
