import{_ as s,c as e,o as a,a as n}from"./app.3dd4ae37.js";const _='{"title":"rcore\u5B9E\u9A8C\u8BB0\u5F55","description":"","frontmatter":{"title":"rcore\u5B9E\u9A8C\u8BB0\u5F55","date":"2022-07-31T03:06:23.000Z","draft":false},"headers":[{"level":2,"title":"rust\u8BED\u8A00\u5B66\u4E60","slug":"rust\u8BED\u8A00\u5B66\u4E60"},{"level":2,"title":"\u5B9E\u9A8C\u8BB0\u5F55","slug":"\u5B9E\u9A8C\u8BB0\u5F55"},{"level":3,"title":"\u5B9E\u9A8Cos3","slug":"\u5B9E\u9A8Cos3"},{"level":3,"title":"os4","slug":"os4"},{"level":3,"title":"os5","slug":"os5"},{"level":3,"title":"os6","slug":"os6"},{"level":3,"title":"os8","slug":"os8"}],"relativePath":"other/rcore_os_program.md"}',r={},l=n(`<h1 id="rcore\u5B9E\u9A8C\u8BB0\u5F55" tabindex="-1">rCore\u5B9E\u9A8C\u8BB0\u5F55 <a class="header-anchor" href="#rcore\u5B9E\u9A8C\u8BB0\u5F55" aria-hidden="true">#</a></h1><h2 id="rust\u8BED\u8A00\u5B66\u4E60" tabindex="-1">rust\u8BED\u8A00\u5B66\u4E60 <a class="header-anchor" href="#rust\u8BED\u8A00\u5B66\u4E60" aria-hidden="true">#</a></h2><p>rust\u8BED\u8A00\u5DF2\u7ECF\u63A5\u89E6\u6BD4\u8F83\u4E45\u4E86,\u6240\u4EE5rustlings\u53EA\u662F\u7B80\u5355\u505A\u4E86\u4E00\u5C0F\u90E8\u5206. rustlings\u4F5C\u4E3A\u4E00\u4E2A\u5DE5\u5177\u8003\u8BD5\u5DE5\u5177\u8FD8\u662F\u4E0D\u9519\u7684. \u4EE5\u540E\u53EF\u4EE5\u5728\u6B64\u57FA\u7840\u4E0A\u505A\u4E00\u4E9B\u5C0F\u5DE5\u5177.</p><h2 id="\u5B9E\u9A8C\u8BB0\u5F55" tabindex="-1">\u5B9E\u9A8C\u8BB0\u5F55 <a class="header-anchor" href="#\u5B9E\u9A8C\u8BB0\u5F55" aria-hidden="true">#</a></h2><p>\u4E0B\u9762\u8BF4\u4E00\u4E0B\u505A\u5B9E\u9A8C\u7684\u8FC7\u7A0B, \u64CD\u4F5C\u7CFB\u7EDF\u5DF2\u7ECF\u5B66\u4E86\u5F88\u591A\u5E74\u4E86,\u4E00\u76F4\u4E5F\u6CA1\u6709\u4E0A\u624B\u7684\u673A\u4F1A.\u73B0\u5728\u6709\u4E86qemu\u8FD9\u6837\u7684\u5DE5\u5177, \u53EF\u4EE5\u5B8C\u5168\u8131\u79BB\u786C\u4EF6\u6765\u5B66\u4E60os. \u5F53\u5E74\u5B66\u6821minix\u7684\u65F6\u5019,\u90FD\u8981\u7528vmware\u8FD9\u6837\u7684\u5DE5\u5177\u624D\u884C. \u76F8\u6BD4\u4E4B\u4E0B,qemu\u4F9D\u8D56\u8981\u5C11\u5F97\u591A.\u6211\u770B\u4E0D\u5C11\u540C\u5B66\u90FD\u505A\u4E86\u53EF\u89C6\u5316\u7684\u8C03\u8BD5\u5DE5\u5177. \u57FA\u4E8Eqemu,\u6211\u77E5\u9053\u53EF\u4EE5\u7528gdb\u8C03\u8BD5\u5185\u6838. \u5237ctf\u9898\u7684\u65F6\u5019\u8C03\u8BD5\u8FC7, \u73B0\u5728\u6709\u4E86vscode\u8FD9\u6837\u7684\u8D85\u7EA7\u5B9A\u5236\u6B3Eide,\u786E\u5B9E\u628Aos\u5F00\u53D1\u7684\u95E8\u69DB\u964D\u4F4E\u4E86\u5F88\u591A.</p><p>\u6211\u4E3B\u8981\u505A\u4E86\u56DB\u4E2A\u5B9E\u9A8C,\u5206\u522B\u662Fos3,os4,os5,os6. \u7531\u4E8E\u65F6\u95F4\u5173\u7CFB,os8\u5C31\u6CA1\u505A\u4E86,\u6765\u4E0D\u53CA\u4E86.</p><h3 id="\u5B9E\u9A8Cos3" tabindex="-1">\u5B9E\u9A8Cos3 <a class="header-anchor" href="#\u5B9E\u9A8Cos3" aria-hidden="true">#</a></h3><p>\u8FD9\u4E2A\u5B9E\u9A8C\u662F\u7EC3\u624B\u719F\u6089\u7CFB\u7EDF\u7528\u7684,\u5B9E\u73B0\u4E24\u4E2A\u7B80\u5355\u7684syscall,\u5206\u522B\u662Fget_time\u548Csys_task_info. \u5C24\u5176\u662F\u50CFget_time\u8FD9\u79CD\u9AD8\u9891\u7684\u7CFB\u7EDF\u8C03\u7528,\u76EE\u524D\u90FD\u5DF2\u7ECF\u4E0D\u5728\u901A\u8FC7\u7CFB\u7EDF\u8C03\u7528\u6765\u5B9E\u73B0\u4E86,\u90FD\u662F\u901A\u8FC7vdso. \u5B9E\u9A8C\u4E2D\u53EF\u4EE5\u770B\u5230\u6BCF\u6B21\u7CFB\u7EDF\u8C03\u7528\u8FDB\u51FA,\u8981\u4FDD\u5B58\u5F88\u591A\u4E1C\u897F,\u9000\u51FA\u8FD8\u8981\u590D\u539F\u5F88\u591A\u4E1C\u897F. \u8FD9\u8FD8\u662F\u5728os3\u8FD9\u79CD\u6CA1\u6709\u5206\u9875\u652F\u6301,\u5982\u679C\u52A0\u5165\u4E86\u5206\u9875,\u7CFB\u7EDF\u8C03\u7528\u7684\u6210\u672C\u5C31\u66F4\u9AD8\u4E86.</p><p>\u4E0B\u9762\u7ED9\u4E00\u4E2A\u76EE\u524Dubuntu\u4E0A vdso\u7684\u4E00\u4E2A\u6837\u4F8B:</p><div class="language-txt line-numbers-mode"><pre><code>vagrant@ubuntu-bionic:~$ cat /proc/self/maps
563beb95e000-563beb966000 r-xp 00000000 08:01 13                         /bin/cat
563bebb65000-563bebb66000 r--p 00007000 08:01 13                         /bin/cat
563bebb66000-563bebb67000 rw-p 00008000 08:01 13                         /bin/cat
563bed3d5000-563bed3f6000 rw-p 00000000 00:00 0                          [heap]
7fb1c6c63000-7fb1c6c85000 rw-p 00000000 00:00 0
7fb1c6c85000-7fb1c6df8000 r--p 00000000 08:01 7839                       /usr/lib/locale/C.UTF-8/LC_COLLATE
7fb1c6df8000-7fb1c6fdf000 r-xp 00000000 08:01 2243                       /lib/x86_64-linux-gnu/libc-2.27.so
7fb1c6fdf000-7fb1c71df000 ---p 001e7000 08:01 2243                       /lib/x86_64-linux-gnu/libc-2.27.so
7fb1c71df000-7fb1c71e3000 r--p 001e7000 08:01 2243                       /lib/x86_64-linux-gnu/libc-2.27.so
7fb1c71e3000-7fb1c71e5000 rw-p 001eb000 08:01 2243                       /lib/x86_64-linux-gnu/libc-2.27.so
7fb1c71e5000-7fb1c71e9000 rw-p 00000000 00:00 0
7fb1c71e9000-7fb1c7212000 r-xp 00000000 08:01 2238                       /lib/x86_64-linux-gnu/ld-2.27.so
7fb1c7233000-7fb1c7264000 r--p 00000000 08:01 7840                       /usr/lib/locale/C.UTF-8/LC_CTYPE
7fb1c7264000-7fb1c7265000 r--p 00000000 08:01 7845                       /usr/lib/locale/C.UTF-8/LC_NUMERIC
7fb1c7265000-7fb1c7266000 r--p 00000000 08:01 7848                       /usr/lib/locale/C.UTF-8/LC_TIME
7fb1c7266000-7fb1c7267000 r--p 00000000 08:01 7843                       /usr/lib/locale/C.UTF-8/LC_MONETARY
7fb1c7267000-7fb1c7268000 r--p 00000000 08:01 7837                       /usr/lib/locale/C.UTF-8/LC_MESSAGES/SYS_LC_MESSAGES
7fb1c7268000-7fb1c7269000 r--p 00000000 08:01 7846                       /usr/lib/locale/C.UTF-8/LC_PAPER
7fb1c7269000-7fb1c726a000 r--p 00000000 08:01 7844                       /usr/lib/locale/C.UTF-8/LC_NAME
7fb1c726a000-7fb1c726b000 r--p 00000000 08:01 7838                       /usr/lib/locale/C.UTF-8/LC_ADDRESS
7fb1c726b000-7fb1c7406000 r--p 00000000 08:01 7834                       /usr/lib/locale/locale-archive
7fb1c7406000-7fb1c7408000 rw-p 00000000 00:00 0
7fb1c7408000-7fb1c7409000 r--p 00000000 08:01 7847                       /usr/lib/locale/C.UTF-8/LC_TELEPHONE
7fb1c7409000-7fb1c740a000 r--p 00000000 08:01 7842                       /usr/lib/locale/C.UTF-8/LC_MEASUREMENT
7fb1c740a000-7fb1c7411000 r--s 00000000 08:01 5046                       /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache
7fb1c7411000-7fb1c7412000 r--p 00000000 08:01 7841                       /usr/lib/locale/C.UTF-8/LC_IDENTIFICATION
7fb1c7412000-7fb1c7413000 r--p 00029000 08:01 2238                       /lib/x86_64-linux-gnu/ld-2.27.so
7fb1c7413000-7fb1c7414000 rw-p 0002a000 08:01 2238                       /lib/x86_64-linux-gnu/ld-2.27.so
7fb1c7414000-7fb1c7415000 rw-p 00000000 00:00 0
7ffc16f28000-7ffc16f49000 rw-p 00000000 00:00 0                          [stack]
7ffc16f93000-7ffc16f96000 r--p 00000000 00:00 0                          [vvar]
7ffc16f96000-7ffc16f98000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><a href="https://en.wikipedia.org/wiki/VDSO" target="_blank" rel="noopener noreferrer">vdso</a> \u4F5C\u4E3A\u4E00\u79CD\u7075\u6D3B\u7684,\u7CFB\u7EDF\u63D0\u4F9B\u7ED9\u7528\u6237\u5C42\u7684\u4EE3\u7801,\u50CFget_time\u8FD9\u79CD\u9AD8\u9891\u8C03\u7528,\u6210\u672C\u5C31\u4F4E\u591A\u4E86.</p><p>\u8FD9\u4E2A\u5B9E\u9A8C\u78B0\u5230\u7684\u6BD4\u8F83\u5751\u7684\u4E00\u4E2A\u95EE\u9898\u662F,get_time\u56E0\u4E3A\u6A21\u62DF\u5668\u7684\u539F\u56E0,\u5E76\u4E0D\u51C6. \u6700\u540E\u91C7\u7528\u4E86\u4E00\u4E2A\u5F88\u626F\u6DE1\u7684\u65B9\u5F0F,\u76F4\u63A5\u52A0\u4E8650\u6765\u5E94\u4ED8\u5355\u5143\u6D4B\u8BD5. \u5176\u5B9E\u5E94\u8BE5\u6DF1\u5165\u770B\u770B\u4E3A\u5565\u6A21\u62DF\u5668\u7684\u65F6\u95F4\u4F1A\u98D8.</p><h3 id="os4" tabindex="-1">os4 <a class="header-anchor" href="#os4" aria-hidden="true">#</a></h3><p>\u8FD9\u4E2A\u5B9E\u9A8C\u76EE\u7684\u662F\u8BA9\u4EBA\u7406\u89E3\u57FA\u4E8E\u9875\u7684\u5185\u5B58\u7BA1\u7406\u7684\u5B9E\u73B0. \u9996\u5148\u7B2C\u4E00\u70B9,\u5C31\u662F\u56E0\u4E3A\u5F15\u5165\u4E86\u865A\u62DF\u5185\u5B58\u7BA1\u7406,\u8FDB\u7A0B\u4E4B\u95F4\u53EF\u4EE5\u4F7F\u7528\u5B8C\u5168\u76F8\u540C\u7684\u5730\u5740\u7A7A\u95F4,\u4E0D\u50CFos3\u4E2D\u8FD8\u9700\u8981\u7CBE\u5FC3\u5E03\u5C40. \u4E0D\u8FC7\u8BDD\u8BF4,\u5728\u8D44\u6E90\u53D7\u9650\u7684\u5D4C\u5165\u5F0F\u7CFB\u7EDF\u4E2D,os3\u8FD9\u79CD\u4EFB\u52A1\u7BA1\u7406\u65B9\u5F0F\u672A\u5FC5\u4E0D\u662F\u4E00\u4EF6\u597D\u7684\u65B9\u5F0F. \u5206\u9875\u4EE5\u540E,\u590D\u6742\u5EA6\u4E00\u4E0B\u5B50\u590D\u6742\u4E86\u4E0D\u5C11.</p><p>\u5176\u6B21, sys_mmap\u7684\u5B9E\u73B0,\u8FD9\u4E2A\u76F8\u5BF9\u6BD4\u8F83\u7B80\u5355,\u56E0\u4E3A\u5DF2\u7ECF\u6709\u53C2\u8003\u5B9E\u73B0\u4E86,insert_framed_area\u5DF2\u7ECF\u662F\u73B0\u6210\u7684\u4E86. \u53EA\u662F\u81EA\u5DF1\u5B9E\u73B0\u4E00\u4E0B<code>is_mapped</code>\u5373\u53EF. \u5173\u952E\u5C31\u662F\u7406\u89E3<code>MemorySet</code>\u7684\u7ED3\u6784.</p><p>\u6709\u4E86<code>is_mapped</code>,\u76F8\u5BF9\u6765\u8BF4,<code>remove_framed_area</code>\u7684\u5B9E\u73B0,\u4E5F\u5C31\u4E0D\u590D\u6742\u4E86.</p><h3 id="os5" tabindex="-1">os5 <a class="header-anchor" href="#os5" aria-hidden="true">#</a></h3><p>\u76F8\u6BD4\u4E4B\u4E0B,os5\u8981\u6BD4os4\u7B80\u5355\u8BB8\u591A,\u56E0\u4E3A\u8FDB\u7A0B\u8C03\u5EA6:</p><ol><li>\u8FDB\u7A0B\u8C03\u5EA6\u7B97\u6CD5\u672C\u8EAB\u6BD4\u8F83\u7B80\u5355</li><li>\u8FD9\u662F\u6BCF\u4E00\u95E8\u64CD\u4F5C\u7CFB\u7EDF\u8BFE\u7A0B\u4F1A\u53CD\u590D\u5F3A\u8C03,\u751A\u81F3\u4F1A\u8BA9\u5B66\u751F\u8BA1\u7B97\u7684\u4E00\u7AE0.</li><li>\u73AF\u5883\u90FD\u5DF2\u7ECF\u51C6\u5907\u597D\u4E86,fork,exec\u7684\u5B9E\u73B0\u90FD\u5DF2\u7ECF\u63D0\u4F9B\u4E86\u5269\u4E0B\u7684,\u53EA\u662F\u7167\u6284,\u7EC4\u5408\u4E00\u4E0B\u5373\u53EF.</li><li>stride\u8C03\u5EA6\u7B97\u6CD5,\u672C\u8EAB\u5B9E\u73B0\u8D77\u6765\u5F88\u7B80\u5355,\u53EA\u8981\u627E\u5BF9\u5730\u65B9,\u5728\u8FDB\u7A0B\u53D1\u751F\u5207\u6362\u7684\u5730\u65B9\u8BB0\u5F55\u4E00\u4E0Bpass\u5373\u53EF.</li></ol><h3 id="os6" tabindex="-1">os6 <a class="header-anchor" href="#os6" aria-hidden="true">#</a></h3><p>\u6587\u4EF6\u7CFB\u7EDF\u672C\u8EAB\u6BD4\u8F83\u590D\u6742,\u4E0D\u8FC7\u8FD8\u597D,\u62FF\u5230\u624B\u7684\u5DF2\u7ECF\u6709\u4E86\u6700\u6838\u5FC3\u7684\u57FA\u4E8Eblock\u8BBE\u5907\u7684inode\u7BA1\u7406\u4E0E\u5206\u914D. \u6BD4\u5982Bitmap\u8FD9\u6837\u7684\u6570\u636E\u7ED3\u6784.</p><p>\u603B\u7684\u6765\u8BF4,\u4F9D\u846B\u82A6\u753B\u74E2\u672C\u8EAB\u4E0D\u96BE,\u5F88\u5FEB\u5C31\u6709\u4E86,\u4E3B\u8981\u78B0\u5230\u7684\u95EE\u9898,\u6709\u4E24\u4E2A,\u4E00\u4E2A\u662Feasy_fs println\u7684\u652F\u6301,\u4E8C\u662F\u53D1\u73B0clear\u5076\u5C14\u5931\u8D25\u7684\u95EE\u9898.</p><h4 id="easy-fs-\u652F\u6301println" tabindex="-1">easy_fs \u652F\u6301println <a class="header-anchor" href="#easy-fs-\u652F\u6301println" aria-hidden="true">#</a></h4><p>easy_fs\u8FD9\u4E2A\u6A21\u5757\u6BD4\u8F83\u7279\u6B8A,\u5B83\u65E2\u8981\u5728\u5185\u6838\u5C42\u5DE5\u4F5C,\u4E5F\u8981\u4E3Aeasy_fs_fuse\u670D\u52A1. \u6240\u4EE5\u5B83\u672C\u8EAB\u6CA1\u6709\u4EFB\u4F55log,\u4E3A\u4E86\u8BA9\u5B83\u652F\u6301log,\u8FD9\u91CC\u7528\u4E86\u4E00\u4E2A\u5F88\u5077\u61D2\u7684\u529E\u6CD5,\u5C31\u662F\u51FD\u6570\u6307\u9488. \u8BA9\u7528\u6237\u5C42\u63D0\u4F9B\u7528\u6237\u5C42\u7684\u51FD\u6570\u6307\u9488,\u5185\u6838\u5C42\u63D0\u4F9B\u5185\u6838\u7684\u51FD\u6570\u6307\u9488,\u4ECE\u800C\u90FD\u53EF\u4EE5println!. \u6307\u5BFC\u4E66\u4E2D\u5EFA\u8BAE\u5F15\u5165log,\u6211\u5BF9\u6B64\u6CA1\u6709\u7814\u7A76,\u540E\u7EED\u6709\u65F6\u95F4\u53EF\u4EE5\u518D\u770B\u770B. \u8FD9\u91CC\u8FD8\u6709\u4E00\u4E2A\u9898\u5916\u8BDD,\u5C31\u662F\u56E0\u4E3A\u5FD8\u8BB0\u5728memory\u4E2D\u6620\u5C04MMIO,\u8FD8\u4EE5\u4E3A\u662F\u51FD\u6570\u6307\u9488\u8BBE\u7F6E\u7684\u95EE\u9898,\u53CD\u590D\u6D4B\u8BD5,\u6D6A\u8D39\u4E86\u4E0D\u5C11\u65F6\u95F4,\u4E3B\u8981\u662F\u65B9\u5411\u9519\u4E86.</p><h4 id="clear\u5076\u5C14\u5931\u8D25\u7684\u95EE\u9898" tabindex="-1">clear\u5076\u5C14\u5931\u8D25\u7684\u95EE\u9898 <a class="header-anchor" href="#clear\u5076\u5C14\u5931\u8D25\u7684\u95EE\u9898" aria-hidden="true">#</a></h4><p>\u8FD9\u4E2A\u95EE\u9898\u5F88\u626F\u6DE1,\u8DDF\u8E2A\u8C03\u8BD5\u4E86\u5F88\u4E45,\u4E5F\u4E0D\u65AD\u7684\u770B\u4EE3\u7801,\u89C9\u5F97\u4E0D\u5E94\u8BE5\u6709\u95EE\u9898. \u6700\u540E\u518D\u8BFB\u5199block\u7684\u5730\u65B9\u6253\u5370\u65E5\u5FD7\u627E\u5230\u4E86\u95EE\u9898,\u539F\u6765\u662F\u5199\u8FDB\u53BB\u4EE5\u540E\u8BFB\u51FA\u6765\u5C31\u4E0D\u5BF9\u4E86.</p><p>\u8FD9\u4E0B\u7B97\u662F\u5361\u4F4F\u4E86,\u5728\u5434\u4E00\u51E1\u540C\u5B66\u7684\u63D0\u793A\u4E0B,\u8BF4\u662F\u8DE8\u9875\u95EE\u9898. \u5C31\u722C\u4E86\u722CrCore\u7684issue,\u76F4\u63A5\u627E\u5230\u4E86\u7B54\u6848. \u7528Vec\u6765\u4EE3\u66FF\u6570\u7EC4,\u56E0\u4E3AVec\u5206\u914D\u7684\u65F6\u5019\u662F\u5BF9\u9F50\u7684,\u907F\u514D\u4E86\u6570\u636E\u7684\u8DE8\u9875\u95EE\u9898.</p><h3 id="os8" tabindex="-1">os8 <a class="header-anchor" href="#os8" aria-hidden="true">#</a></h3><p>\u7ECF\u5178\u7684\u6B7B\u9501\u89E3\u51B3\u7B97\u6CD5, \u5E73\u65F6\u57FA\u672C\u4E0A\u4E5F\u7528\u4E0D\u5230,\u52A0\u4E0A\u786E\u5B9E\u65F6\u95F4\u6765\u4E0D\u53CA\u4E86,\u5C31\u6218\u7565\u653E\u5F03\u5427.</p>`,29),c=[l];function b(i,p,o,f,t,u){return a(),e("div",null,c)}var h=s(r,[["render",b]]);export{_ as __pageData,h as default};
