import{o as n,c as s,f as a,e as p}from"./app.4e97a0ca.js";const t='{"title":"5.libra的AC模块","description":"","frontmatter":{"title":"5.libra的AC模块","date":"2019-06-29T03:00:34.000Z","draft":false,"tags":["rust","blockchain","libra"],"series":["libra"],"categories":["技术相关"]},"headers":[{"level":2,"title":"SubmitTransaction","slug":"submittransaction"},{"level":3,"title":"相关代码简单分析","slug":"相关代码简单分析"},{"level":2,"title":"updatetolatest_ledger","slug":"update-to-latest-ledger"},{"level":3,"title":"请求参数","slug":"请求参数"},{"level":3,"title":"返回结果","slug":"返回结果"},{"level":3,"title":"具体实现","slug":"具体实现"},{"level":2,"title":"启动流程","slug":"启动流程"},{"level":3,"title":"main.rs","slug":"main-rs"},{"level":3,"title":"AdmissionControlNode","slug":"admissioncontrolnode"}],"relativePath":"blockchain/libra/5.libra_ac.md","lastUpdated":1564531739000}',e={},o=p('<ul><li><a href="#submittransaction"> SubmitTransaction</a><ul><li><a href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90"> 相关代码简单分析</a></li></ul></li><li><a href="#update_to_latest_ledger"> update_to_latest_ledger</a><ul><li><a href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"> 请求参数</a></li><li><a href="#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"> 返回结果</a></li><li><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"> 具体实现</a></li></ul></li><li><a href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"> 启动流程</a><ul><li><a href="#mainrs"> main.rs</a></li><li><a href="#admissioncontrolnode"> AdmissionControlNode</a></li></ul></li></ul>',1),c=p('<p>根据Libra的架构图,AC(admission control)是位于Validator与普通用户交互的入口. <img alt="Libra结构图" data-src="https://developers.libra.org/docs/assets/illustrations/validator.svg" loading="lazy" class="lazy"></p><p>因此AC基本上就干了两件事,提供了两个接口.一个是<code>SubmitTransaction</code>,另一个是<code>UpdateToLatestLedger</code>.</p><p>主要代码位于<code>admission_control_service\\admission_control_service.rs</code> 这个是对<code>admission_control.proto</code>的<code>service AdmissionControl</code>的实现.</p><h2 id="submittransaction"><a class="header-anchor" href="#submittransaction" aria-hidden="true">#</a> SubmitTransaction</h2><p>这个模块主要是接受来自普通用户的Tx,如果合理有效则提交给MemPool模块,最终会进入到block中. 工作流程:</p><ol><li>校验Tx,包括三个部分一个是签名是否有效,另一个则是gas是否有效,第三个则是执行Tx中的code是否能够通过.</li><li>校验账户余额是否足够,然后通过grpc链接发送给mempool模块</li><li>将mempool结果返回给用户</li></ol><p>需要说明的是<a href="https://developers.libra.org/docs/crates/admission-control" target="_blank" rel="noopener noreferrer">官方文档</a>与代码并不完全相符,实际上校验Tx都是在``VMValidator`中进行的. 相关代码都不在AC模块</p><h3 id="相关代码简单分析"><a class="header-anchor" href="#相关代码简单分析" aria-hidden="true">#</a> 相关代码简单分析</h3><div class="language-rust line-numbers-mode"><pre><code> <span class="token comment">/// Validate transaction signature, then via VM, and add it to Mempool if it passes VM check.</span>\n    <span class="token comment">/// 流程非常简单</span>\n    <span class="token comment">/// 1. 交由本地validator验证Tx执行能否通过,如果不通过报错,否则继续2</span>\n    <span class="token comment">/// 2.  获取账户最新状态,组装`AddTransactionWithValidationRequest`</span>\n    <span class="token comment">/// 3. 调用mempool grpc接口,添加Tx到mempool中</span>\n    <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">crate</span><span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function-definition function">submit_transaction_inner</span><span class="token punctuation">(</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>\n        req<span class="token punctuation">:</span> <span class="token class-name">SubmitTransactionRequest</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">SubmitTransactionResponse</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 就是校验mempool服务是否正常</span>\n        <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">can_send_txn_to_mempool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>\n            <span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">&quot;Mempool is full&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token constant">OP_COUNTERS</span><span class="token punctuation">.</span><span class="token function">inc_by</span><span class="token punctuation">(</span><span class="token string">&quot;submit_txn.rejected.mempool_full&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">let</span> <span class="token keyword">mut</span> response <span class="token operator">=</span> <span class="token class-name">SubmitTransactionResponse</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            response<span class="token punctuation">.</span><span class="token function">set_mempool_status</span><span class="token punctuation">(</span><span class="token class-name">MempoolIsFull</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">let</span> signed_txn_proto <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">get_signed_txn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">//利用`FromProto`这个trait将grpc 类型转换为内部类型.</span>\n        <span class="token keyword">let</span> signed_txn <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token class-name">SignedTransaction</span><span class="token punctuation">::</span><span class="token function">from_proto</span><span class="token punctuation">(</span>signed_txn_proto<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token class-name">Ok</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">,</span>\n            <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n                <span class="token function">security_log</span><span class="token punctuation">(</span><span class="token class-name">SecurityEvent</span><span class="token punctuation">::</span><span class="token class-name">InvalidTransactionAC</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>e<span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>signed_txn_proto<span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">let</span> <span class="token keyword">mut</span> response <span class="token operator">=</span> <span class="token class-name">SubmitTransactionResponse</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                response<span class="token punctuation">.</span><span class="token function">set_ac_status</span><span class="token punctuation">(</span><span class="token class-name">AdmissionControlStatus</span><span class="token punctuation">::</span><span class="token class-name">Rejected</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token constant">OP_COUNTERS</span><span class="token punctuation">.</span><span class="token function">inc_by</span><span class="token punctuation">(</span><span class="token string">&quot;submit_txn.rejected.invalid_txn&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token comment">//交由vm_validator校验Tx是否合法.实际对应的是`VMValidator`这个struct</span>\n        <span class="token comment">//签名校验是否有效实际上是在vm_validator中.</span>\n        <span class="token keyword">let</span> gas_cost <span class="token operator">=</span> signed_txn<span class="token punctuation">.</span><span class="token function">max_gas_amount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> validation_status <span class="token operator">=</span> <span class="token keyword">self</span>\n            <span class="token punctuation">.</span>vm_validator\n            <span class="token punctuation">.</span><span class="token function">validate_transaction</span><span class="token punctuation">(</span>signed_txn<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>\n                <span class="token function">security_log</span><span class="token punctuation">(</span><span class="token class-name">SecurityEvent</span><span class="token punctuation">::</span><span class="token class-name">InvalidTransactionAC</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>e<span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>signed_txn<span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                e\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span> <span class="token comment">//Validator验证Tx是否有效,注意该调用也是一个grpc调用,因此走的是异步,wait模式</span>\n        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>validation_status<span class="token punctuation">)</span> <span class="token operator">=</span> validation_status <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> <span class="token keyword">mut</span> response <span class="token operator">=</span> <span class="token class-name">SubmitTransactionResponse</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token constant">OP_COUNTERS</span><span class="token punctuation">.</span><span class="token function">inc_by</span><span class="token punctuation">(</span><span class="token string">&quot;submit_txn.vm_validation.failure&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token macro property">debug!</span><span class="token punctuation">(</span>\n                <span class="token string">&quot;txn failed in vm validation, status: {:?}, txn: {:?}&quot;</span><span class="token punctuation">,</span>\n                validation_status<span class="token punctuation">,</span> signed_txn\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            response<span class="token punctuation">.</span><span class="token function">set_vm_status</span><span class="token punctuation">(</span>validation_status<span class="token punctuation">.</span><span class="token function">into_proto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">let</span> sender <span class="token operator">=</span> signed_txn<span class="token punctuation">.</span><span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> account_state <span class="token operator">=</span> <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">get_account_state</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>storage_read_client<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> add_transaction_request <span class="token operator">=</span> <span class="token class-name">AddTransactionWithValidationRequest</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        add_transaction_request<span class="token punctuation">.</span>signed_txn <span class="token operator">=</span> req<span class="token punctuation">.</span>signed_txn<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        add_transaction_request<span class="token punctuation">.</span><span class="token function">set_max_gas_cost</span><span class="token punctuation">(</span>gas_cost<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sequence_number<span class="token punctuation">,</span> balance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> account_state <span class="token punctuation">{</span>\n            add_transaction_request<span class="token punctuation">.</span><span class="token function">set_account_balance</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            add_transaction_request<span class="token punctuation">.</span><span class="token function">set_latest_sequence_number</span><span class="token punctuation">(</span>sequence_number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token comment">//这个函数非常简单,就是调用mempool的grpc接口`add_transaction_with_validation` 来试图添加一个Tx到mempool中去</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">add_txn_to_mempool</span><span class="token punctuation">(</span>add_transaction_request<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="update-to-latest-ledger"><a class="header-anchor" href="#update-to-latest-ledger" aria-hidden="true">#</a> update_to_latest_ledger</h2><p>AC的另一个功能就是提供查询功能,这个包括账户状态,交易,ContractEvent等的查询. 这实际上可以看做libra所有对外能够提供的服务了.</p><h3 id="请求参数"><a class="header-anchor" href="#请求参数" aria-hidden="true">#</a> 请求参数</h3><p>主要有四类请求,深刻理解了这四类请求的所有数据结构,基本上就掌握了如何使用libra了.</p><div class="language-rust line-numbers-mode"><pre><code><span class="token attribute attr-name">#[derive(Arbitrary, Clone, Debug, Eq, PartialEq)]</span>\n<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">RequestItem</span> <span class="token punctuation">{</span>\n    <span class="token class-name">GetAccountTransactionBySequenceNumber</span> <span class="token punctuation">{</span>\n        account<span class="token punctuation">:</span> <span class="token class-name">AccountAddress</span><span class="token punctuation">,</span>\n        sequence_number<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>\n        fetch_events<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// this can&#39;t be the first variant, tracked here https://github.com/AltSysrq/proptest/issues/141</span>\n    <span class="token class-name">GetAccountState</span> <span class="token punctuation">{</span>\n        address<span class="token punctuation">:</span> <span class="token class-name">AccountAddress</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token class-name">GetEventsByEventAccessPath</span> <span class="token punctuation">{</span>\n        access_path<span class="token punctuation">:</span> <span class="token class-name">AccessPath</span><span class="token punctuation">,</span>\n        start_event_seq_num<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>\n        ascending<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>\n        limit<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token class-name">GetTransactions</span> <span class="token punctuation">{</span>\n        start_version<span class="token punctuation">:</span> <span class="token class-name">Version</span><span class="token punctuation">,</span>\n        limit<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>\n        fetch_events<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>从这些请求里面没有看到任何block相关字样,这也说明了libra有意弱化block概念,直接针对的是transaction.</p><h3 id="返回结果"><a class="header-anchor" href="#返回结果" aria-hidden="true">#</a> 返回结果</h3><p>请求和返回都位于types/src/get_with_proof.rs, types/src目录下就是系统的核心数据结构所在. 如果能够把这里面的数据结构都理解透了,理解整个libra不在话下啊.</p><div class="language-rust line-numbers-mode"><pre><code>\n<span class="token attribute attr-name">#[allow(clippy::large_enum_variant)]</span>\n<span class="token attribute attr-name">#[derive(Arbitrary, Clone, Debug, Eq, PartialEq)]</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">ResponseItem</span> <span class="token punctuation">{</span>\n    <span class="token class-name">GetAccountTransactionBySequenceNumber</span> <span class="token punctuation">{</span>\n        signed_transaction_with_proof<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">SignedTransactionWithProof</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        proof_of_current_sequence_number<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">AccountStateWithProof</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// this can&#39;t be the first variant, tracked here https://github.com/AltSysrq/proptest/issues/141</span>\n    <span class="token class-name">GetAccountState</span> <span class="token punctuation">{</span>\n        account_state_with_proof<span class="token punctuation">:</span> <span class="token class-name">AccountStateWithProof</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token class-name">GetEventsByEventAccessPath</span> <span class="token punctuation">{</span>\n        events_with_proof<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">EventWithProof</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        proof_of_latest_event<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">AccountStateWithProof</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token class-name">GetTransactions</span> <span class="token punctuation">{</span>\n        txn_list_with_proof<span class="token punctuation">:</span> <span class="token class-name">TransactionListWithProof</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="具体实现"><a class="header-anchor" href="#具体实现" aria-hidden="true">#</a> 具体实现</h3><p>实现非常简单,实际上就是一个请求转达,是直接调用的<code>storage</code>模块的grpc服务,所以阅读我的storage模块相关文章即可.</p><div class="language-rust line-numbers-mode"><pre><code>   <span class="token comment">/// Pass the UpdateToLatestLedgerRequest to Storage for read query.</span>\n    <span class="token keyword">fn</span> <span class="token function-definition function">update_to_latest_ledger_inner</span><span class="token punctuation">(</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>\n        req<span class="token punctuation">:</span> <span class="token class-name">UpdateToLatestLedgerRequest</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">UpdateToLatestLedgerResponse</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> rust_req <span class="token operator">=</span> <span class="token namespace">types<span class="token punctuation">::</span>get_with_proof<span class="token punctuation">::</span></span><span class="token class-name">UpdateToLatestLedgerRequest</span><span class="token punctuation">::</span><span class="token function">from_proto</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> <span class="token punctuation">(</span>response_items<span class="token punctuation">,</span> ledger_info_with_sigs<span class="token punctuation">,</span> validator_change_events<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span>\n            <span class="token punctuation">.</span>storage_read_client\n            <span class="token punctuation">.</span><span class="token function">update_to_latest_ledger</span><span class="token punctuation">(</span>rust_req<span class="token punctuation">.</span>client_known_version<span class="token punctuation">,</span> rust_req<span class="token punctuation">.</span>requested_items<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> rust_resp <span class="token operator">=</span> <span class="token namespace">types<span class="token punctuation">::</span>get_with_proof<span class="token punctuation">::</span></span><span class="token class-name">UpdateToLatestLedgerResponse</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>\n            response_items<span class="token punctuation">,</span>\n            ledger_info_with_sigs<span class="token punctuation">,</span>\n            validator_change_events<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//直接读取本地数据库,注意这个接口是查询而不是更新</span>\n        <span class="token class-name">Ok</span><span class="token punctuation">(</span>rust_resp<span class="token punctuation">.</span><span class="token function">into_proto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="启动流程"><a class="header-anchor" href="#启动流程" aria-hidden="true">#</a> 启动流程</h2><p>AC模块是一个独立的grpc服务,也是一个独立的可执行程序. 入口处位于<code>main.rs</code>. 这里简单分析一下启动流程</p><h3 id="main-rs"><a class="header-anchor" href="#main-rs" aria-hidden="true">#</a> <a href="http://main.rs" target="_blank" rel="noopener noreferrer">main.rs</a></h3><div class="language-rust line-numbers-mode"><pre><code><span class="token comment">/// Run a Admission Control service in its own process.</span>\n<span class="token comment">/// It will also setup global logger and initialize config.</span>\n<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> _logger<span class="token punctuation">,</span> _args<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">setup_executable</span><span class="token punctuation">(</span>\n        <span class="token string">&quot;Libra AdmissionControl node&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token constant">ARG_PEER_ID</span><span class="token punctuation">,</span> <span class="token constant">ARG_CONFIG_PATH</span><span class="token punctuation">,</span> <span class="token constant">ARG_DISABLE_LOGGING</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> admission_control_node <span class="token operator">=</span> <span class="token namespace">admission_control_node<span class="token punctuation">::</span></span><span class="token class-name">AdmissionControlNode</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    admission_control_node\n        <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to run AdmissionControl node&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>首先核心是使用<code>setup_executable</code>来解析参数,获取系统配置以及日志. 这个函数做整个libra所有的服务中都是这么使用的.</p><h3 id="admissioncontrolnode"><a class="header-anchor" href="#admissioncontrolnode" aria-hidden="true">#</a> AdmissionControlNode</h3><p>第二步则是创建<code>AdmissionControlNode</code></p><div class="language-rust line-numbers-mode"><pre><code><span class="token comment">/// Struct to run Admission Control service in a dedicated process. It will be used to spin up</span>\n<span class="token comment">/// extra AC instances to talk to the same validator.</span>\n<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AdmissionControlNode</span> <span class="token punctuation">{</span>\n    <span class="token comment">/// Config used to setup environment for this Admission Control service instance.</span>\n    node_config<span class="token punctuation">:</span> <span class="token class-name">NodeConfig</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>从定义中无法直接看出依赖,在run函数中可以看出启动过程.</p><div class="language-rust line-numbers-mode"><pre><code> <span class="token comment">/// Setup environment and start a new Admission Control service.</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n        <span class="token namespace">logger<span class="token punctuation">::</span></span><span class="token function">set_global_log_collector</span><span class="token punctuation">(</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config\n                <span class="token punctuation">.</span>log_collector\n                <span class="token punctuation">.</span><span class="token function">get_log_collector_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>log_collector<span class="token punctuation">.</span>is_async<span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>log_collector<span class="token punctuation">.</span>chan_size<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">&quot;Starting AdmissionControl node&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// Start receiving requests</span>\n        <span class="token keyword">let</span> client_env <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">EnvBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name_prefix</span><span class="token punctuation">(</span><span class="token string">&quot;grpc-ac-mem-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> mempool_connection_str <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span>\n            <span class="token string">&quot;{}:{}&quot;</span><span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>mempool<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>mempool<span class="token punctuation">.</span>mempool_service_port\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> mempool_channel <span class="token operator">=</span>\n            <span class="token class-name">ChannelBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>client_env<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mempool_connection_str<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">run_with_clients</span><span class="token punctuation">(</span>\n            client_env<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token comment">//依赖两个服务,一个是mempool服务</span>\n            <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MempoolClient</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>mempool_channel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token comment">//另一个是storage服务,正如我们上面的分析</span>\n            <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StorageReadServiceClient</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>\n                <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client_env<span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>address<span class="token punctuation">,</span>\n                <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>port<span class="token punctuation">,</span>\n            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>实际上在<code>run_with_clients</code>中还创建了vm_validator,只不过这个不是独立的服务罢了. 通过<code>run_with_clients</code>我们也可以学习构建grpc服务的流程.</p><div class="language-rust line-numbers-mode"><pre><code>   <span class="token comment">/// This method will start a node using the provided clients to external services.</span>\n    <span class="token comment">/// For now, mempool is a mandatory argument, and storage is Option. If it doesn&#39;t exist,</span>\n    <span class="token comment">/// it&#39;ll be generated before starting the node.</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run_with_clients</span><span class="token operator">&lt;</span><span class="token class-name">M</span><span class="token punctuation">:</span> <span class="token class-name">MempoolClientTrait</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>\n        <span class="token comment">/*\n        若是有where T：&#39;static 的约束，意思则是，类型T⾥⾯不包含任何指向短⽣命周期的借⽤指针，\n        意思是要么完全不包含任何借⽤，要么可以有指向&#39;static的借⽤指针。\n        */</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>\n        env<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Environment</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        mp_client<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">M</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>\n        storage_client<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">StorageReadServiceClient</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> <span class="token comment">/* storage_client是和后端的storage服务进行通信\n                                                               libra实现的各个服务之间都是通过grpc服务交互*/</span>\n    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n        <span class="token comment">// create storage client if doesn&#39;t exist</span>\n        <span class="token keyword">let</span> storage_client<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">StorageRead</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">match</span> storage_client <span class="token punctuation">{</span>\n            <span class="token class-name">Some</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">,</span>\n            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StorageReadServiceClient</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>\n                env<span class="token punctuation">,</span>\n                <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>address<span class="token punctuation">,</span>\n                <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>port<span class="token punctuation">,</span>\n            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">let</span> vm_validator <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">VMValidator</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">,</span> storage_client<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token class-name">AdmissionControlService</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>\n            mp_client<span class="token punctuation">,</span>\n            storage_client<span class="token punctuation">,</span>\n            vm_validator<span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config\n                <span class="token punctuation">.</span>admission_control\n                <span class="token punctuation">.</span>need_to_check_mempool_before_validation<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> service <span class="token operator">=</span> <span class="token namespace">admission_control_grpc<span class="token punctuation">::</span></span><span class="token function">create_admission_control</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">let</span> _ac_service_handle <span class="token operator">=</span> <span class="token function">spawn_service_thread</span><span class="token punctuation">(</span>\n            service<span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>admission_control<span class="token punctuation">.</span>address<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config\n                <span class="token punctuation">.</span>admission_control\n                <span class="token punctuation">.</span>admission_control_service_port<span class="token punctuation">,</span>\n            <span class="token string">&quot;admission_control&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">//这个debug服务与我们说的上述内容无关,纯粹是为了调试需要.</span>\n        <span class="token comment">// Start Debug interface</span>\n        <span class="token keyword">let</span> debug_service <span class="token operator">=</span>\n            <span class="token namespace">node_debug_interface_grpc<span class="token punctuation">::</span></span><span class="token function">create_node_debug_interface</span><span class="token punctuation">(</span><span class="token class-name">NodeDebugService</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> _debug_handle <span class="token operator">=</span> <span class="token function">spawn_service_thread</span><span class="token punctuation">(</span>\n            debug_service<span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config<span class="token punctuation">.</span>admission_control<span class="token punctuation">.</span>address<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config\n                <span class="token punctuation">.</span>debug_interface\n                <span class="token punctuation">.</span>admission_control_node_debug_port<span class="token punctuation">,</span>\n            <span class="token string">&quot;debug_service&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token macro property">info!</span><span class="token punctuation">(</span>\n            <span class="token string">&quot;Started AdmissionControl node on port {}&quot;</span><span class="token punctuation">,</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>node_config\n                <span class="token punctuation">.</span>admission_control\n                <span class="token punctuation">.</span>admission_control_service_port\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> \n</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div>',33);e.render=function(p,t,e,l,u,i){return n(),s("div",null,[a(' @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} '),a(" code_chunk_output "),o,a(" /code_chunk_output "),c])};export{t as __pageData,e as default};
