<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>我对 smartplasma 的理解 | Steven's Blog</title>
    <meta name="description" content="steven's Blog">
    <link rel="stylesheet" href="/assets/style.5d43a85e.css">
    <link rel="modulepreload" href="/assets/chunks/viewer.ac8119fd.js">
    <link rel="modulepreload" href="/assets/chunks/echarts.5647a860.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart.d087ce05.js">
    <link rel="modulepreload" href="/assets/chunks/mermaid.f445d939.js">
    <link rel="modulepreload" href="/assets/chunks/runner.27cb2152.js">
    <link rel="modulepreload" href="/assets/app.e7435feb.js">
    <link rel="modulepreload" href="/assets/blockchain_ethereum_我对 smartplasma 的理解.md.8a80c64d.lean.js">
    
    <link rel="icon" href="/logo.png">
  <meta name="twitter:title" content="我对 smartplasma 的理解 | Steven&#39;s Blog">
  <meta property="og:title" content="我对 smartplasma 的理解 | Steven&#39;s Blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Steven&#39;s Blog, back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="/logo.png" alt="Logo" data-v-cc01ef16> Steven&#39;s Blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/web-security/" data-v-b8818f8c>web安全相关 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/blockchain/" data-v-b8818f8c>block chain <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>静态分析 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/app_security/" data-v-b8818f8c>泛app安全 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust-leetcode/" data-v-b8818f8c>leetcode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust/" data-v-b8818f8c>rust <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>other <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/blog-vitepress" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/web-security/" data-v-b8818f8c>web安全相关 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/blockchain/" data-v-b8818f8c>block chain <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>静态分析 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/app_security/" data-v-b8818f8c>泛app安全 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust-leetcode/" data-v-b8818f8c>leetcode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/rust/" data-v-b8818f8c>rust <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>other <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/blog-vitepress" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/">libra</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/9.libria_vrf.html">9.libra中的vrf</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/8.libria_mempool_3.html">8.libra的mempool模块解读-3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/7.libra_mempool_2.html">7.libra的mempool模块解读-2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/6.libria_mempool_1.html">6.libra的mempool模块解读-1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/5.libra_ac.html">5.libra的AC模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/4.client_command_and_libriadb.html">4.打通client与libradb模块的任督二脉</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/3.Libra_Schema.html">3.Libra中数据存储的Schema</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/2.Protobuf_in_libria.html">2.在Libra中学习Protobuf</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/libra/1.start_in_one_minute.html">1.Libra入门教程-一分钟上手Libra</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/block_chain_core/">区块链核心技术</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/block_chain_core/ecc_signature_random.html">ECC签名中随机数不随机的危害</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/block_chain_core/vrf.html">一篇文章搞懂VRF</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/">btc wallet系列</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/wallet模块.html">wallet模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/chain模块.html">chain模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/hdwallet-bip0032.html">hdwallet-bip0032</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/wtxmgr模块.html">wtxmgr模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/wallet中的数据库设计.html">wallet中的数据库设计</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/拓扑排序在比特币Tx管理中的使用.html">拓扑排序在比特币Tx管理中的使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/btcWallet系列之一-grpc模块.html">btcWallet系列之一-grpc模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/waddrmgr模块.html">waddrmgr模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/walletdb.html">walletdb</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/snacl.html">snacl</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcwallet/readme.html">readme</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/">以太坊</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/并发和并行的区别.html">并发和并行的区别</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/以太坊evm笔记.html">以太坊evm笔记</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/合约注意事项.html">[9232585]合约注意事项</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/btc跨链设计.html">btc跨链设计</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/安全总结.html">安全总结</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/比特币的TxHash为什么会发生改变.html">比特币的TxHash为什么会发生改变</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/how_to_create_channel.html">how_to_create_channel</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/君士坦丁堡分叉引起的安全问题.html">君士坦丁堡分叉引起的安全问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/区块链问题笔记.html">区块链问题笔记</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/从一次盗币事件再谈合约安全问题.html">从一次盗币事件再谈合约安全问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/让photon支持go module.html">让photon支持go module</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/meshbox配置 OpenWrt.html">meshbox配置 OpenWrt</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/synapse代码阅读.html">synapse代码阅读</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/golang_plugin.html">golang_plugin</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/多链工作问题.html">多链工作问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/blockchain/ethereum/我对 smartplasma 的理解.html">我对 smartplasma 的理解</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_1-合约代码">1. 合约代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_2-合约文件简单介绍">2. 合约文件简单介绍</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-plasma-cash-的基础数据结构">3. Plasma Cash 的基础数据结构</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-1-plasma-cash-中的资产">3.1 Plasma Cash 中的资产</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-2-plasma-cash中的交易">3.2 Plasma Cash中的交易</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-3-plasma-cash-中的-block">3.3 Plasma Cash 中的 Block</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-4-plasma-cash-中资产的回归主链以太坊">3.4 Plasma Cash 中资产的回归主链以太坊</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_4-plasma-cash-中的退出示例">4. Plasma Cash 中的退出示例</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_5-其他问题">5. 其他问题</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/CrossChainAtomicExchange.html">CrossChainAtomicExchange</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/如何为 smartraiden 贡献代码.html">[9619946]如何为 smartraiden 贡献代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/闪电网络.html">闪电网络</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/如何使用 smartraiden 以及 lnd 进行跨链原子资产交换.html">如何使用 smartraiden 以及 lnd 进行跨链原子资产交换</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/raiden_graph.html">[9420361]raiden_graph</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/区块链计时器.html">区块链计时器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/如何使用 dlv 调试 smartraiden.html">如何使用 dlv 调试 smartraiden</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/异常退出各种情况.html">异常退出各种情况</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/闪电网络交易密钥.html">闪电网络交易密钥</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/solidity_mapping_implementation.html">[9249722]solidity_mapping_implementation</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/ethereum_erc20_wrapper.html"> 将以太坊封装为 ERC20 TOKEN</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/golang subprocess tests.html">golang Subprocess tests</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/how_to_use_channel.html">如何使用 Channel</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/ethereum/thedao.html">TheDao 简化版解释</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/">btcd系列</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/隔离见证.html">隔离见证</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/比特币的地址类型.html">[9491455]比特币的地址类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/indexer模块.html">indexer模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/btcjson.html">btcjson</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/mempool.html">mempool</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/peer.html">peer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/database.html">database</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/rpcclient.html">rpcclient</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/mining.html">mining</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/mruMap.html">mruMap</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/bitcoin script.html">[9485733]bitcoin script</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/比特币解锁脚本中的ScriptSignature都包含了什么东西.html">比特币解锁脚本中的ScriptSignature都包含了什么东西</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/wire_common.html">wire_common</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/bloom.html">bloom</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/比特币指令集说明.html">[9476013]比特币指令集说明</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blockchain/btcd/一个比特币脚本示例.html">[9476189]一个比特币脚本示例</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--[--><!----><!--]--><!--[--><div style="alignment:right;font-size:large;"> 最近更新: </div><!--]--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="plasma-cash-合约解读" tabindex="-1">Plasma Cash 合约解读 <a class="header-anchor" href="#plasma-cash-合约解读" aria-hidden="true">#</a></h1><ul><li><a href="#plasma-cash-%E5%90%88%E7%BA%A6%E8%A7%A3%E8%AF%BB">Plasma Cash 合约解读</a><ul><li><a href="#1-%E5%90%88%E7%BA%A6%E4%BB%A3%E7%A0%81">1. 合约代码</a></li><li><a href="#2-%E5%90%88%E7%BA%A6%E6%96%87%E4%BB%B6%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D">2. 合约文件简单介绍</a></li><li><a href="#3-plasma-cash-%E7%9A%84%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">3. Plasma Cash 的基础数据结构</a><ul><li><a href="#31-plasma-cash-%E4%B8%AD%E7%9A%84%E8%B5%84%E4%BA%A7">3.1 Plasma Cash 中的资产</a></li><li><a href="#32-plasma-cash%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93">3.2 Plasma Cash中的交易</a></li><li><a href="#33-plasma-cash-%E4%B8%AD%E7%9A%84-block">3.3 Plasma Cash 中的 Block</a></li><li><a href="#34-plasma-cash-%E4%B8%AD%E8%B5%84%E4%BA%A7%E7%9A%84%E5%9B%9E%E5%BD%92%E4%B8%BB%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A">3.4 Plasma Cash 中资产的回归主链以太坊</a><ul><li><a href="#341-%08%E8%B5%84%E4%BA%A7%E6%8B%A5%E6%9C%89%E8%AF%81%E6%98%8E">3.4.1 资产拥有证明</a></li><li><a href="#342-%E7%AD%89%E5%BE%85%E5%85%B6%E4%BB%96%E4%BA%BA%E6%9D%A5%E6%8C%91%E6%88%98%E6%88%91">3.4.2 等待其他人来挑战我</a></li><li><a href="#343-%E6%8C%91%E6%88%98%E6%9C%9F%E8%BF%87%E4%BA%86-bob-%E6%8B%BF%E5%9B%9E%E8%B5%84%E4%BA%A7-uid">3.4.3 挑战期过了, Bob 拿回资产 uid</a></li></ul></li></ul></li><li><a href="#4-plasma-cash-%E4%B8%AD%E7%9A%84%E9%80%80%E5%87%BA%E7%A4%BA%E4%BE%8B">4. Plasma Cash 中的退出示例</a></li><li><a href="#5-%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98">5. 其他问题</a> Plasma 由 V 神在2017年8月提出,希望通过链下交易来大幅提高以太坊的 TPS.</li></ul></li></ul><p>每条 Plasma 链都会将有关交易顺序的消息换算成一个哈希值存储在根链上。比特币和以太坊都属于根链——这两条区块链具有很高的安全性，并且通过去中心化保证了（安全性和活性）。</p><p>Plasma 设计模型有两个主要的分支：Plasma MVP 和 Plasma Cash 。这里我们来研究 SmartPlasma 实现的 Plasma Cash 合约,并通过合约分析来回答大家关于 Plasma Cash 的一系列疑问.</p><h2 id="_1-合约代码" tabindex="-1">1. 合约代码 <a class="header-anchor" href="#_1-合约代码" aria-hidden="true">#</a></h2><p>SmartPlasma的合约代码肯定会不断升级,我针对他们在今天(2018-09-14)最新版本进行分析,这份代码目前保存在我的 github 上<a href="https://github.com/nkbai/blog/tree/master/smartplasma/contracts" target="_blank" rel="noopener noreferrer"> plasma cash</a>.</p><h2 id="_2-合约文件简单介绍" tabindex="-1">2. 合约文件简单介绍 <a class="header-anchor" href="#_2-合约文件简单介绍" aria-hidden="true">#</a></h2><p>文件夹中有不少与 Plasma Cash 无关的合约,这里只关注直接与 Plasma Cash 相关合约,像 ERC20Token 相关合约就忽略,自行查看.</p><ul><li>Mediator.sol 是 Plasma Cash 链中资产的进出口</li><li>RootChain.sol 处理 Plasma Cash 子链(相对于以太坊而言)中的交易以及打包等</li><li>libraries/MerkleProof.sol 是子链中交易用到的默克尔树,用于子链参与方进行欺诈证明 fraud proof.</li><li>libraris/RLP.sol RLP编码支持,可以暂时忽略,子链中所有的交易都是用RLP 编码的.</li><li>libraries/PlasmaLib.sol 生成 uid 的辅助函数</li><li>ECRecovery.sol 签名验证</li><li>datastructures/Transaction.sol 描述交易的数据结构</li></ul><h2 id="_3-plasma-cash-的基础数据结构" tabindex="-1">3. Plasma Cash 的基础数据结构 <a class="header-anchor" href="#_3-plasma-cash-的基础数据结构" aria-hidden="true">#</a></h2><p>Plasma Cash 是一种子链结构,可以认为 Plasma Cash 是以太坊的一个是基于 =一种简化的UTXO模型的子链.</p><h3 id="_3-1-plasma-cash-中的资产" tabindex="-1">3.1 Plasma Cash 中的资产 <a class="header-anchor" href="#_3-1-plasma-cash-中的资产" aria-hidden="true">#</a></h3><p>Plasma Cash 中的资产都来自于以太坊,但是一旦进入 Plasma Cash 就会拥有唯一的 ID,并且不可分割. 可以参考 <a href="https://github.com/nkbai/blog/blob/master/smartplasma/contracts/Mediator.sol" target="_blank" rel="noopener noreferrer">Mediator.sol</a>的deposit函数. Mediator就是 Plasma Cash 资产存放的地方.</p><div class="language-solidity line-numbers-mode"><pre><code>        <span class="token comment">/** @dev Adds deposits on Smart Plasma.
     *  @param currency Currency address.
     *  @param amount Amount amount of currency.
     */</span>
    <span class="token keyword">function</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token builtin">address</span> currency<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>amount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Token token <span class="token operator">=</span> <span class="token function">Token</span><span class="token punctuation">(</span>currency<span class="token punctuation">)</span><span class="token punctuation">;</span>
        token<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/// deposit test1</span>

        <span class="token builtin">bytes32</span> uid <span class="token operator">=</span> rootChain<span class="token punctuation">.</span><span class="token function">deposit</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> currency<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/// deposit test2</span>
        cash<span class="token punctuation">[</span>uid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">entry</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            currency<span class="token punctuation">:</span> currency<span class="token punctuation">,</span>
            amount<span class="token punctuation">:</span> amount
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>通过合约可以看出进入 Plasma Cash 的资产必须是 ERC20 Token,这些资产实际上是存在 Mediator 这个合约上,然后由 RootChain 为其分配一个唯一的 ID, 也就是 uid. 这个 uid 代表着什么 token, 有多少个.</p><h3 id="_3-2-plasma-cash中的交易" tabindex="-1">3.2 Plasma Cash中的交易 <a class="header-anchor" href="#_3-2-plasma-cash中的交易" aria-hidden="true">#</a></h3><p>关键代码在<a href="https://github.com/nkbai/blog/blob/master/smartplasma/contracts/libraries/datastructures/Transaction.sol" target="_blank" rel="noopener noreferrer"> Transaction.sol</a>中.</p><div class="language-solidity line-numbers-mode"><pre><code>    <span class="token keyword">struct</span> <span class="token class-name">Tx</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span> prevBlock<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> uid<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> amount<span class="token punctuation">;</span>
        <span class="token builtin">address</span> newOwner<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> nonce<span class="token punctuation">;</span>
        <span class="token builtin">address</span> signer<span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这里可能不太明显,需要解释才能看出来这是一个 UTXO 交易的模型. 这里面的amount 和 hash 实际上都有点啰唆,可以忽略. 那么剩下的成员需要来解释.</p><p><code>prevBlock</code>就是 UTXO 中的输入,来自于哪块. 至于为什么没有像比特币一样的OutPoint 结构,也就是 TxHash+Index, 后续会讲到. <code>uid</code> 就是交易的资产 ID <code>newOwner</code> 交易输出给谁, 这里也不支持像 比特币一样的脚本. <code>nonce</code> 是这笔资产的第多少次交易,在双花证明中有重要作用. <code>signer</code>必须由资产原拥有者的签名.</p><p><code>amount</code> 不重要,是因为资产不可分割,导致这里的 Amount 不会随交易发生而发生变化. 而 <code>hash</code> 则是可以直接计算出来.</p><h3 id="_3-3-plasma-cash-中的-block" tabindex="-1">3.3 Plasma Cash 中的 Block <a class="header-anchor" href="#_3-3-plasma-cash-中的-block" aria-hidden="true">#</a></h3><p>如果一般区块链中的 Block 一样,他是交易的集合.但是不同于一般链的是,这里面的矿工(不一定是 Operator)不仅需要维护好子链,还需要周期性的将每一个 Block 对应的默克尔树根保存到以太坊中,这个工作只能有 Operator 来完成. 具体代码可见<a href="https://github.com/nkbai/blog/blob/master/smartplasma/contracts/RootChain.sol" target="_blank" rel="noopener noreferrer"> RootChain.sol</a>的.</p><div class="language-solidity line-numbers-mode"><pre><code>    <span class="token keyword">function</span> <span class="token function">newBlock</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> hash<span class="token punctuation">)</span> <span class="token keyword">public</span> onlyOperator <span class="token punctuation">{</span>
        blockNumber <span class="token operator">=</span> blockNumber<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        childChain<span class="token punctuation">[</span>blockNumber<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">;</span>

        <span class="token function">NewBlock</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>交易证据提交者只能是 Operator, 也就是合约的创建者. 这个 Operator 既可以是普通账户,这时他就是这个子链的管理员.也可以是一份合约,那么就可以通过合约来规定子链的出块规则.</p><h3 id="_3-4-plasma-cash-中资产的回归主链以太坊" tabindex="-1">3.4 Plasma Cash 中资产的回归主链以太坊 <a class="header-anchor" href="#_3-4-plasma-cash-中资产的回归主链以太坊" aria-hidden="true">#</a></h3><p>当资产在 Plasma 中交易一段时间以后,持有者Bob如果想退出Plasma Cash 子链,那么就需要向以太坊合约也就是 RootChain证明,他确实拥有这一笔资产.</p><h4 id="_3-4-1-资产拥有证明" tabindex="-1">3.4.1 资产拥有证明 <a class="header-anchor" href="#_3-4-1-资产拥有证明" aria-hidden="true">#</a></h4><p>这个思路和 UTXO 的思路是一样的,Bob能证明这笔资产是从哪里转给我的即可.具体见<a href="./.html">RootChain.sol</a>中的<code>startExit</code>函数. 其思路非常简单,证明</p><ul><li>这笔资产来自哪里(在哪 M块中转移到了 Alice 手中)</li><li>经过 Alice 签名转移给了Bob(在N块中 Alice 做了签名给我) 具体看代码 startExit</li></ul><div class="language-solidity line-numbers-mode"><pre><code><span class="token comment">/** @dev Starts the procedure for withdrawal of the deposit from the system.
     *  @param previousTx Penultimate deposit transaction.
     *  @param previousTxProof Proof of inclusion of a penultimate transaction in a Smart Plasma block.
     *  @param previousTxBlockNum The number of the block in which the penultimate transaction is included.
     *  @param lastTx Last deposit transaction.
     *  @param lastTxProof Proof of inclusion of a last transaction in a Smart Plasma block.
     *  @param lastTxBlockNum The number of the block in which the last transaction is included.
     */</span>
    <span class="token keyword">function</span> <span class="token function">startExit</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> previousTx<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> previousTxProof<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> previousTxBlockNum<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> lastTx<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> lastTxProof<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> lastTxBlockNum
    <span class="token punctuation">)</span>
        <span class="token keyword">public</span>
    <span class="token punctuation">{</span>
        Transaction<span class="token punctuation">.</span>Tx <span class="token keyword">memory</span> prevDecodedTx <span class="token operator">=</span> previousTx<span class="token punctuation">.</span><span class="token function">createTx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Transaction<span class="token punctuation">.</span>Tx <span class="token keyword">memory</span> decodedTx <span class="token operator">=</span> lastTx<span class="token punctuation">.</span><span class="token function">createTx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 证明在 prevBlock的时候 Alice 拥有资产 uid</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>previousTxBlockNum <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>prevBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>uid <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//amount 不变,证明资产不可分割</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>amount <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Alice 确实签名转移给了我,并且交易是相邻的两笔交易</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>newOwner <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>signer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>nonce <span class="token operator">==</span> prevDecodedTx<span class="token punctuation">.</span>nonce<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//紧挨着的两笔交易</span>
        <span class="token comment">//我是 Bob, 我要来拿走这笔资产</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>newOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>wallet<span class="token punctuation">[</span><span class="token builtin">bytes32</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">bytes32</span> prevTxHash <span class="token operator">=</span> prevDecodedTx<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> prevBlockRoot <span class="token operator">=</span> childChain<span class="token punctuation">[</span>previousTxBlockNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> txHash <span class="token operator">=</span> decodedTx<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> blockRoot <span class="token operator">=</span> childChain<span class="token punctuation">[</span>lastTxBlockNum<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">require</span><span class="token punctuation">(</span>
            prevTxHash<span class="token punctuation">.</span><span class="token function">verifyProof</span><span class="token punctuation">(</span>
                prevDecodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                prevBlockRoot<span class="token punctuation">,</span>
                previousTxProof
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>
            txHash<span class="token punctuation">.</span><span class="token function">verifyProof</span><span class="token punctuation">(</span>
                decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                blockRoot<span class="token punctuation">,</span>
                lastTxProof
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// Record the exit tx.</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>exits<span class="token punctuation">[</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">challengesLength</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        exits<span class="token punctuation">[</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            state<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            exitTime<span class="token punctuation">:</span> now<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>challengePeriod<span class="token punctuation">)</span><span class="token punctuation">,</span>
            exitTxBlkNum<span class="token punctuation">:</span> lastTxBlockNum<span class="token punctuation">,</span>
            exitTx<span class="token punctuation">:</span> lastTx<span class="token punctuation">,</span>
            txBeforeExitTxBlkNum<span class="token punctuation">:</span> previousTxBlockNum<span class="token punctuation">,</span>
            txBeforeExitTx<span class="token punctuation">:</span> previousTx
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">StartExit</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> previousTxBlockNum<span class="token punctuation">,</span> lastTxBlockNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>代码的前一半都是在用来证明在<code>lastTxBlockNum</code>的时候,资产 uid 归Bob所有. 然后后一半就是提出来,Bob想把资产 uid 提走. 我的这个想法会暂时保存在合约中,等待别人来挑战.</p><h4 id="_3-4-2-等待其他人来挑战我" tabindex="-1">3.4.2 等待其他人来挑战我 <a class="header-anchor" href="#_3-4-2-等待其他人来挑战我" aria-hidden="true">#</a></h4><p>有了以上信息, 就可以证明在 N 块时,这笔资产归Bob所用.但是这肯定不够,无法证明现在资产仍然属于Bob,也无法证明Alice 没有在 M 块以后再给别人. 更加不能证明在 M 块的时候 Alice 真的是 uid 的拥有者? 这些问题,看起来很难回答,其实思路也很简单. 这个思路和雷电网络中解决问题的办法是一样的, 让这笔资产的利益攸关者站出来举证. 比如: 如果 Carol能够举证这笔资产Bob 后来又转移给了 Carol, 那么实际上 Bob 就是在双花. 具体的挑战以及迎战代码比较复杂,但是这也是 Plasma Cash 的核心安全性所在.如果没有这些,所有的参与者都将无法保证自己的权益.</p><div class="language-"><pre><code>//challengeExit 挑战资产uid 其实不属于 Bob
  /** @dev Challenges a exit.
     *  @param uid Unique identifier of a deposit.
     *  @param challengeTx Transaction that disputes an exit.
     *  @param proof Proof of inclusion of the transaction in a Smart Plasma block.
     *  @param challengeBlockNum The number of the block in which the transaction is included.
     */
    function challengeExit(
        uint256 uid,
        bytes challengeTx,
        bytes proof,
        uint256 challengeBlockNum
    )
        public
    {
        require(exits[uid].state == 2);

        Transaction.Tx memory exitDecodedTx = (exits[uid].exitTx).createTx();
        Transaction.Tx memory beforeExitDecodedTx = (exits[uid].txBeforeExitTx).createTx();
        Transaction.Tx memory challengeDecodedTx = challengeTx.createTx();

        require(exitDecodedTx.uid == challengeDecodedTx.uid);
        require(exitDecodedTx.amount == challengeDecodedTx.amount);

        bytes32 txHash = challengeDecodedTx.hash;
        bytes32 blockRoot = childChain[challengeBlockNum];

        require(txHash.verifyProof(uid, blockRoot, proof));

        // test challenge #1 &amp; test challenge #2 最后一笔交易后面又进行了其他交易, Bob 在进行双花
        if (exitDecodedTx.newOwner == challengeDecodedTx.signer &amp;&amp;
        exitDecodedTx.nonce &lt; challengeDecodedTx.nonce) {
            delete exits[uid];
            return;
        }

        // test challenge #3, 双花了,  Alice 给了两个人,并且挑战者 Carol的BlockNumer 更小,也就是发生的更早.
        if (challengeBlockNum &lt; exits[uid].exitTxBlkNum &amp;&amp;
            (beforeExitDecodedTx.newOwner == challengeDecodedTx.signer &amp;&amp;
            challengeDecodedTx.nonce &gt; beforeExitDecodedTx.nonce)) {
            delete exits[uid];
            return;
        }

        // test challenge #4   在 M块之前,还有一笔交易,Alice 需要证明自己在 M 块确实拥有 uid
        // 这个更多的是防止这种情况 The operator can even start a withdrawal from an output created by an invalid transaction.
        // 也就是 Operator 无中生有产生了一个 Tx, 然后花费此 Tx
        // 而这实际上会伤害到 uid 真正持有人的利益,他一定会站出来说明此事
        if (challengeBlockNum &lt; exits[uid].txBeforeExitTxBlkNum ) {
            exits[uid].state = 1;
            addChallenge(uid, challengeTx, challengeBlockNum);
        }

        require(exits[uid].state == 1);

        ChallengeExit(uid);
    }

/*
这个内容,我们显然没有,如何解决呢  plasma mvp
Confirmation Signatures
Now what happens if a transaction gets included after the bad transaction? This can totally happen if a user makes a transaction, the transaction is sent to the operator, and the operator puts an invalid transaction before the user’s valid transaction. Users could try to exit from the inputs to the transaction, but that exit could be challenged by revealing the signed spend.

We deal with this scenario by requiring that transactions are invalid until they’re signed twice. Whenever a user makes a transaction, they’ll sign a first signature to have that transaction included in a block. Then, once the transaction is included in a valid block, the user will sign a second signature, called a confirmation signature. Users correctly following this rule will never sign a confirmation signature unless they know that their transaction was included in a valid block.

We add an extra rule that exit challenges also have to provide the confirmation signature. Now, if the operator includes a user’s transaction after their invalid transaction, the user simply won’t sign a confirmation signature. A transaction included after an invalid transaction won’t have a confirmation signature, and therefore won’t be valid. Every correctly behaving user can therefore get their funds back.
*/
//Bob应战,再次举证,实际上这个过程就是要不断的追加证据,将所有的交易连起来,最终证明 Alice 在 M块确实拥有 uid
 /** @dev Answers a challenge exit.
     *  @param uid Unique identifier of a deposit.
     *  @param challengeTx Transaction that disputes an exit.
     *  @param respondTx Transaction that answers to a dispute transaction.
     *  @param proof Proof of inclusion of the respond transaction in a Smart Plasma block.
     *  @param blockNum The number of the block in which the respond transaction is included.
     */
    function respondChallengeExit(
        uint256 uid,
        bytes challengeTx,
        bytes respondTx,
        bytes proof,
        uint blockNum
    )
        public
    {
        require(challengeExists(uid, challengeTx));
        require(exits[uid].state == 1);

        Transaction.Tx memory challengeDecodedTx = challengeTx.createTx();
        Transaction.Tx memory respondDecodedTx = respondTx.createTx();

        require(challengeDecodedTx.uid == respondDecodedTx.uid);
        require(challengeDecodedTx.amount == respondDecodedTx.amount);
        require(challengeDecodedTx.newOwner == respondDecodedTx.signer);
        require(challengeDecodedTx.nonce.add(uint256(1)) == respondDecodedTx.nonce);
        require(blockNum &lt; exits[uid].txBeforeExitTxBlkNum);

        bytes32 txHash = respondDecodedTx.hash;
        bytes32 blockRoot = childChain[blockNum];

        require(txHash.verifyProof(uid, blockRoot, proof));

        removeChallenge(uid, challengeTx);

        if (challengesLength(uid) == 0) {
            exits[uid].state = 2;
        }

        RespondChallengeExit(uid);
    }
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><h4 id="_3-4-3-挑战期过了-bob-拿回资产-uid" tabindex="-1">3.4.3 挑战期过了, Bob 拿回资产 uid <a class="header-anchor" href="#_3-4-3-挑战期过了-bob-拿回资产-uid" aria-hidden="true">#</a></h4><p>挑战期过后,Bob 在Mediator.sol 中提出将资产退回到以太坊中</p><div class="language-solidity line-numbers-mode"><pre><code> <span class="token comment">/** @dev withdraws deposit from Smart Plasma.
     *  @param prevTx Penultimate deposit transaction.
     *  @param prevTxProof Proof of inclusion of a penultimate transaction in a Smart Plasma block.
     *  @param prevTxBlkNum The number of the block in which the penultimate transaction is included.
     *  @param txRaw lastTx Last deposit transaction.
     *  @param txProof Proof of inclusion of a last transaction in a Smart Plasma block.
     *  @param txBlkNum The number of the block in which the last transaction is included.
     */</span>
    <span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span>
        <span class="token builtin">bytes</span> prevTx<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> prevTxProof<span class="token punctuation">,</span>
        <span class="token builtin">uint</span> prevTxBlkNum<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> txRaw<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> txProof<span class="token punctuation">,</span>
        <span class="token builtin">uint</span> txBlkNum
    <span class="token punctuation">)</span>
        <span class="token keyword">public</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">bytes32</span> uid <span class="token operator">=</span> rootChain<span class="token punctuation">.</span><span class="token function">finishExit</span><span class="token punctuation">(</span>
            msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>
            prevTx<span class="token punctuation">,</span>
            prevTxProof<span class="token punctuation">,</span>
            prevTxBlkNum<span class="token punctuation">,</span>
            txRaw<span class="token punctuation">,</span>
            txProof<span class="token punctuation">,</span>
            txBlkNum
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        entry invoice <span class="token operator">=</span> cash<span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">;</span>

        Token token <span class="token operator">=</span> <span class="token function">Token</span><span class="token punctuation">(</span>invoice<span class="token punctuation">.</span>currency<span class="token punctuation">)</span><span class="token punctuation">;</span>
        token<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> invoice<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/// 真正的资产转移</span>

        <span class="token keyword">delete</span><span class="token punctuation">(</span>cash<span class="token punctuation">[</span>uid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>RootChain 再次验证</p><div class="language-solidity line-numbers-mode"><pre><code> <span class="token comment">/** @dev Finishes the procedure for withdrawal of the deposit from the system.
     *       Can only call the owner. Usually the owner is the mediator contract.
     *  @param account Account that initialized the deposit withdrawal.
     *  @param previousTx Penultimate deposit transaction.
     *  @param previousTxProof Proof of inclusion of a penultimate transaction in a Smart Plasma block.
     *  @param previousTxBlockNum The number of the block in which the penultimate transaction is included.
     *  @param lastTx Last deposit transaction.
     *  @param lastTxProof Proof of inclusion of a last transaction in a Smart Plasma block.
     *  @param lastTxBlockNum The number of the block in which the last transaction is included.
     */</span>
    <span class="token keyword">function</span> <span class="token function">finishExit</span><span class="token punctuation">(</span>
        <span class="token builtin">address</span> account<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> previousTx<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> previousTxProof<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> previousTxBlockNum<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> lastTx<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> lastTxProof<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> lastTxBlockNum
    <span class="token punctuation">)</span>
        <span class="token keyword">public</span>
        onlyOwner
        <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Transaction<span class="token punctuation">.</span>Tx <span class="token keyword">memory</span> prevDecodedTx <span class="token operator">=</span> previousTx<span class="token punctuation">.</span><span class="token function">createTx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Transaction<span class="token punctuation">.</span>Tx <span class="token keyword">memory</span> decodedTx <span class="token operator">=</span> lastTx<span class="token punctuation">.</span><span class="token function">createTx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">require</span><span class="token punctuation">(</span>previousTxBlockNum <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>prevBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>uid <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>amount <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>prevDecodedTx<span class="token punctuation">.</span>newOwner <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>signer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>account <span class="token operator">==</span> decodedTx<span class="token punctuation">.</span>newOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">bytes32</span> prevTxHash <span class="token operator">=</span> prevDecodedTx<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> prevBlockRoot <span class="token operator">=</span> childChain<span class="token punctuation">[</span>previousTxBlockNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> txHash <span class="token operator">=</span> decodedTx<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        <span class="token builtin">bytes32</span> blockRoot <span class="token operator">=</span> childChain<span class="token punctuation">[</span>lastTxBlockNum<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">require</span><span class="token punctuation">(</span>
            prevTxHash<span class="token punctuation">.</span><span class="token function">verifyProof</span><span class="token punctuation">(</span>
                prevDecodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                prevBlockRoot<span class="token punctuation">,</span>
                previousTxProof
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">require</span><span class="token punctuation">(</span>
            txHash<span class="token punctuation">.</span><span class="token function">verifyProof</span><span class="token punctuation">(</span>
                decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                blockRoot<span class="token punctuation">,</span>
                lastTxProof
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">require</span><span class="token punctuation">(</span>exits<span class="token punctuation">[</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">.</span>exitTime <span class="token operator">&lt;</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//挑战期过了</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>exits<span class="token punctuation">[</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//并且没有人挑战或者我都给出了合适的证据</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">challengesLength</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        exits<span class="token punctuation">[</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

        <span class="token keyword">delete</span><span class="token punctuation">(</span>wallet<span class="token punctuation">[</span><span class="token builtin">bytes32</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">FinishExit</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token builtin">bytes32</span><span class="token punctuation">(</span>decodedTx<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h2 id="_4-plasma-cash-中的退出示例" tabindex="-1">4. Plasma Cash 中的退出示例 <a class="header-anchor" href="#_4-plasma-cash-中的退出示例" aria-hidden="true">#</a></h2><pre class="mermaid loading">sequenceDiagram
participant o as operator
participant u1 as alice
participant u2 as bob
participant u3 as carol
participant u4 as david
u1-&gt;&gt;rootchain: deposit asset to RootChain, get unique id asset1
o-&gt;&gt;rootchain: 生成 NewBlock 3, 记录此笔资产
u1-&gt;&gt;u2: transfer asset1 to bob
o-&gt;&gt;rootchain: 生成 NewBlock 7, 记录此笔交易
u1-&gt;&gt;u3: transfer asset1 to carol
o-&gt;&gt;rootchain: 生成 Newblock 11 记录此笔交易
u3-&gt;&gt;rootchain: 我要提现asset1到主链,提供asset1来自 alice,由 alice签名,发生在 11
u2-&gt;&gt;rootchain:  提出挑战,asset1应该属于我,提供 asset1 来自 alice,由 aice签名,发生在 7,rootchain 判定bob证据有效,拒绝carol提现
u2-&gt;&gt;u4: transfer asset1 to devid
o-&gt;&gt;rootchain:生成 Newblock 27,  记录此笔交易
u4-&gt;&gt;rootchain:提现 asset1,来自 bob,有 bob的签名,发生在 27
loop david wait for challenge
u4-&gt;&gt;u4:等待挑战期两周时间
end
u4-&gt;&gt; rootchain: withdraw,提现,将asset1从rootchain 转走</pre><p>@ import</p><h2 id="_5-其他问题" tabindex="-1">5. 其他问题 <a class="header-anchor" href="#_5-其他问题" aria-hidden="true">#</a></h2><ul><li><ol><li>为什么 Plasma Cash 中的资产是不可分割的? <br> 进入 rootchain 的资产类似于比特币的 UTXO 模型,但是是不可分割的,这个可以通过交易验证时每次都要求 amount 不变可以得出.</li></ol></li><li><ol start="2"><li>operator 的作用是什么? <br> operator 负责将子链中的交易证据(默克尔树)提交证明到以太坊主链中.</li></ol></li><li><ol start="3"><li>operator 是否必须可信任的? <br> 是的. 虽然 operator 不能将他人资产随意转移,但是却可以阻止他人资产转移.也就是说无法从 Plasma 子链中退回到以太坊中. 当然这部分是可以改进,降低 operator 作恶带来的风险.</li></ol></li><li><ol start="4"><li>operator 是否可以是一个合约呢? <br> 是的. 如果 operator 是一个 Pos 共识合约,那么可以降低问题3中的风险</li></ol></li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/blockchain/ethereum/多链工作问题" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>多链工作问题</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/blockchain/ethereum/CrossChainAtomicExchange" data-v-38ede35f><span class="text" data-v-38ede35f>CrossChainAtomicExchange</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"app_security_android_13_dp1_changes_security.md\":\"1b863316\",\"app_security_android_access_protected_components.md\":\"72e2e78b\",\"app_security_android_howto_protected_unexported_components.md\":\"b51ebf74\",\"app_security_android_lce_third_party.md\":\"42d1a0d4\",\"app_security_bilibili_arbitrary_code_execution.md\":\"d8f9385f\",\"app_security_hook_rest_for_work.md\":\"c348564a\",\"app_security_index.md\":\"96a12780\",\"app_security_tiktok_arbitrary_code_execution.md\":\"7128ae3d\",\"app_security_tiktok_arbitrary_code_execution_download_service.md\":\"b6064fdd\",\"app_security_tiktok_theft_of_arbitrary.md\":\"8ef2c84c\",\"app_security_use_cryptography_in_mobile_appls_the_right_way.md\":\"dc8e7d82\",\"blockchain_block_chain_core_ecc_signature_random.md\":\"17e160bf\",\"blockchain_block_chain_core_index.md\":\"b3953b92\",\"blockchain_block_chain_core_vrf.md\":\"a8381eed\",\"blockchain_btcd_bitcoin script.md\":\"a84eef1f\",\"blockchain_btcd_bloom.md\":\"22d669c2\",\"blockchain_btcd_btcjson.md\":\"a6625d77\",\"blockchain_btcd_database.md\":\"0fb596b5\",\"blockchain_btcd_index.md\":\"43035b03\",\"blockchain_btcd_indexer模块.md\":\"ff7597d1\",\"blockchain_btcd_mempool.md\":\"3cc62a25\",\"blockchain_btcd_mining.md\":\"938ea3b7\",\"blockchain_btcd_mrumap.md\":\"7652b51f\",\"blockchain_btcd_peer.md\":\"065e1a23\",\"blockchain_btcd_rpcclient.md\":\"5bcda98d\",\"blockchain_btcd_wire_common.md\":\"fa63733a\",\"blockchain_btcd_一个比特币脚本示例.md\":\"252976ca\",\"blockchain_btcd_比特币指令集说明.md\":\"fc2ec68d\",\"blockchain_btcd_比特币的地址类型.md\":\"99ea64c0\",\"blockchain_btcd_比特币解锁脚本中的scriptsignature都包含了什么东西.md\":\"03b522bc\",\"blockchain_btcd_隔离见证.md\":\"63985cc1\",\"blockchain_btcwallet_btcwallet系列之一-grpc模块.md\":\"fdf1ad33\",\"blockchain_btcwallet_chain模块.md\":\"fbf23fc2\",\"blockchain_btcwallet_hdwallet-bip0032.md\":\"9d85183c\",\"blockchain_btcwallet_index.md\":\"997e9942\",\"blockchain_btcwallet_readme.md\":\"94b2ca4d\",\"blockchain_btcwallet_snacl.md\":\"f1be15c9\",\"blockchain_btcwallet_waddrmgr模块.md\":\"1c914eb5\",\"blockchain_btcwallet_walletdb.md\":\"d70d9b64\",\"blockchain_btcwallet_wallet中的数据库设计.md\":\"138cb10b\",\"blockchain_btcwallet_wallet模块.md\":\"bca1b6cd\",\"blockchain_btcwallet_wtxmgr模块.md\":\"40016b74\",\"blockchain_btcwallet_拓扑排序在比特币tx管理中的使用.md\":\"2b0224b8\",\"blockchain_ethereum_crosschainatomicexchange.md\":\"34e8c4c1\",\"blockchain_ethereum_btc跨链设计.md\":\"4ca2d16f\",\"blockchain_ethereum_ethereum_erc20_wrapper.md\":\"67b439ad\",\"blockchain_ethereum_golang subprocess tests.md\":\"09183f50\",\"blockchain_ethereum_golang_plugin.md\":\"db3a4cb3\",\"blockchain_ethereum_how_to_create_channel.md\":\"a594df83\",\"blockchain_ethereum_how_to_use_channel.md\":\"461f1e63\",\"blockchain_ethereum_index.md\":\"8eedfd5e\",\"blockchain_ethereum_meshbox配置 openwrt.md\":\"43077135\",\"blockchain_ethereum_raiden_graph.md\":\"e228ed31\",\"blockchain_ethereum_solidity_mapping_implementation.md\":\"a4f746d1\",\"blockchain_ethereum_synapse代码阅读.md\":\"0c1b47fd\",\"blockchain_ethereum_thedao.md\":\"805d579e\",\"blockchain_ethereum_从一次盗币事件再谈合约安全问题.md\":\"6c7f0027\",\"blockchain_ethereum_以太坊evm笔记.md\":\"1fd2d61a\",\"blockchain_ethereum_区块链计时器.md\":\"55db591b\",\"blockchain_ethereum_区块链问题笔记.md\":\"532eaa2c\",\"blockchain_ethereum_合约注意事项.md\":\"419d9fa3\",\"blockchain_ethereum_君士坦丁堡分叉引起的安全问题.md\":\"2648ad90\",\"blockchain_ethereum_多链工作问题.md\":\"5ab80965\",\"blockchain_ethereum_如何为 smartraiden 贡献代码.md\":\"d1cd94eb\",\"blockchain_ethereum_如何使用 dlv 调试 smartraiden.md\":\"137819b4\",\"blockchain_ethereum_如何使用 smartraiden 以及 lnd 进行跨链原子资产交换.md\":\"348cd9b8\",\"blockchain_ethereum_安全总结.md\":\"7d5d5ac5\",\"blockchain_ethereum_并发和并行的区别.md\":\"e321cac6\",\"blockchain_ethereum_异常退出各种情况.md\":\"3ef62257\",\"blockchain_ethereum_我对 smartplasma 的理解.md\":\"8a80c64d\",\"blockchain_ethereum_比特币的txhash为什么会发生改变.md\":\"c19ac27a\",\"blockchain_ethereum_让photon支持go module.md\":\"1b27a141\",\"blockchain_ethereum_闪电网络.md\":\"8e5bec45\",\"blockchain_ethereum_闪电网络交易密钥.md\":\"4ea24d45\",\"blockchain_index.md\":\"681b1b95\",\"blockchain_libra_1.start_in_one_minute.md\":\"ca1062b5\",\"blockchain_libra_2.protobuf_in_libria.md\":\"6f7eb93d\",\"blockchain_libra_3.libra_schema.md\":\"7ca2e658\",\"blockchain_libra_4.client_command_and_libriadb.md\":\"cbff6832\",\"blockchain_libra_5.libra_ac.md\":\"0e252623\",\"blockchain_libra_6.libria_mempool_1.md\":\"9c6a01dc\",\"blockchain_libra_7.libra_mempool_2.md\":\"e8b0f6f3\",\"blockchain_libra_8.libria_mempool_3.md\":\"93dfd565\",\"blockchain_libra_9.libria_vrf.md\":\"f725bceb\",\"blockchain_libra_index.md\":\"428e7a2a\",\"index.md\":\"4d89b29a\",\"other_apt安装指定版本软件.md\":\"90bbcfc9\",\"other_asynq_introduction.md\":\"59c5fee5\",\"other_brew安装指定版本boost.md\":\"18c972df\",\"other_capture_with_wireshark_for_android.md\":\"fa8dcc6b\",\"other_clean_mac.md\":\"8b2c6c6e\",\"other_crossover source insight 4.0使用.md\":\"6d353a7f\",\"other_dynamic_tracing.md\":\"e8a63f42\",\"other_git以及github回退.md\":\"5021f349\",\"other_grpcox.md\":\"6aa77e84\",\"other_how_to_mine_smt_2022.md\":\"ed890195\",\"other_hugo博客写作.md\":\"37009927\",\"other_index.md\":\"d38a4e78\",\"other_learn_go.md\":\"6413882c\",\"other_learningpythonv4.md\":\"7225b2fb\",\"other_opc 统一架构学习笔记.md\":\"13a55701\",\"other_opcua-rust.md\":\"2bd848c8\",\"other_opcua_cross_compile_for_raspeberry.md\":\"2e28f268\",\"other_read_kerenel_use_clion.md\":\"776e843c\",\"other_typescript_advanced_syntax.md\":\"3c84878e\",\"other_vscode_cnblog_plugin.md\":\"295824d3\",\"other_webassembly_two_days_exercise.md\":\"ab421abe\",\"other_windows_hook_thiscall.md\":\"20233c03\",\"other_不用外部插件启用u盘ntfs写功能.md\":\"e04ca1ff\",\"other_五个goland进行go开发的小技巧.md\":\"ee0e73f0\",\"other_使用clion调试开发比特币源码.md\":\"7cc918be\",\"other_使用ubuntu搭建时间机器备份服务.md\":\"ccb318c3\",\"other_工作中常用工具入门.md\":\"c11da7f9\",\"other_用 go 写 webassembly入门.md\":\"eb2a9b0b\",\"other_阈值签名.md\":\"4660bce2\",\"other_高性能go开发.md\":\"7ca5db1a\",\"rust-leetcode_2019-06-01.md\":\"61bfe959\",\"rust-leetcode_2019-06-02.md\":\"f42dca28\",\"rust-leetcode_2019-06-03.md\":\"65789373\",\"rust-leetcode_2019-06-04.md\":\"9f80f5eb\",\"rust-leetcode_2019-06-05.md\":\"3ff04d4e\",\"rust-leetcode_2019-06-06.md\":\"a29318d0\",\"rust-leetcode_2019-06-07.md\":\"92a517b5\",\"rust-leetcode_2019-06-08.md\":\"c6a2671a\",\"rust-leetcode_2019-06-10.md\":\"73e9c80e\",\"rust-leetcode_2019-06-11.md\":\"df4e2758\",\"rust-leetcode_2019-06-14.md\":\"17299e02\",\"rust-leetcode_2019-06-15.md\":\"539f0050\",\"rust-leetcode_2019-06-17.md\":\"636c9e9b\",\"rust-leetcode_2019-06-18.md\":\"7d2324fb\",\"rust-leetcode_2019-08-04.md\":\"31ef6ca5\",\"rust-leetcode_2019-08-10.md\":\"0e71f068\",\"rust-leetcode_2019-08-11.md\":\"0d532620\",\"rust-leetcode_2019-08-12.md\":\"cbe643df\",\"rust-leetcode_2019-08-13.md\":\"bdc673a4\",\"rust-leetcode_2019-08-14.md\":\"2dcece89\",\"rust-leetcode_2019-08-15.md\":\"c33a6d89\",\"rust-leetcode_2019-08-16.md\":\"ca3c62cf\",\"rust-leetcode_2019-08-17.md\":\"fed5fb81\",\"rust-leetcode_2019-08-18.md\":\"51687d70\",\"rust-leetcode_2019-08-19.md\":\"0a3f24ba\",\"rust-leetcode_2019-08-20.md\":\"b6128e72\",\"rust-leetcode_2019-08-21.md\":\"9c9ff2a1\",\"rust-leetcode_2019-08-22.md\":\"463718d6\",\"rust-leetcode_2019-08-23.md\":\"d34ea398\",\"rust-leetcode_2019-08-26.md\":\"28df63eb\",\"rust-leetcode_2019-08-27.md\":\"6e39a36d\",\"rust-leetcode_2019-08-28.md\":\"b50fd38e\",\"rust-leetcode_2019-08-29.md\":\"f37b43f9\",\"rust-leetcode_2019-08-30.md\":\"4210c227\",\"rust-leetcode_2019-09-02.md\":\"aeadc1f1\",\"rust-leetcode_2019-09-03.md\":\"53c3feb0\",\"rust-leetcode_2019-09-04.md\":\"cc504f49\",\"rust-leetcode_2019-09-05.md\":\"4282ab36\",\"rust-leetcode_2019-09-06.md\":\"c0726f29\",\"rust-leetcode_2019-09-09.md\":\"b70c884b\",\"rust-leetcode_2019-09-10.md\":\"c64a6b4f\",\"rust-leetcode_2019-09-11.md\":\"4525bae5\",\"rust-leetcode_2019-09-12.md\":\"01ce1bad\",\"rust-leetcode_2019-09-13.md\":\"7cead7c5\",\"rust-leetcode_2019-09-16.md\":\"30aef99e\",\"rust-leetcode_2019-09-17.md\":\"7fada4d1\",\"rust-leetcode_2019-09-18.md\":\"d26e3285\",\"rust-leetcode_2019-09-19.md\":\"9164367b\",\"rust-leetcode_2019-09-20.md\":\"b2e5743e\",\"rust-leetcode_2019-09-23.md\":\"855952eb\",\"rust-leetcode_2019-09-24.md\":\"65a91bca\",\"rust-leetcode_2019-09-25.md\":\"33cf8c9b\",\"rust-leetcode_2019-09-26.md\":\"d0b56f6e\",\"rust-leetcode_2019-09-27.md\":\"5353924c\",\"rust-leetcode_2019-09-28.md\":\"0ff211c7\",\"rust-leetcode_2019-10-08.md\":\"f8f8d32f\",\"rust-leetcode_2019-10-09.md\":\"64eda47d\",\"rust-leetcode_2019-10-10.md\":\"249f83f3\",\"rust-leetcode_2019-10-11.md\":\"5e2e1227\",\"rust-leetcode_2019-10-14.md\":\"6c5252b3\",\"rust-leetcode_2019-10-15.md\":\"455b24ee\",\"rust-leetcode_2019-10-16.md\":\"776c299a\",\"rust-leetcode_2019-10-17.md\":\"d08a72bd\",\"rust-leetcode_2019-10-18.md\":\"44c5dd10\",\"rust-leetcode_2019-10-19.md\":\"0f3f990c\",\"rust-leetcode_2019-10-21.md\":\"3f36edb6\",\"rust-leetcode_2019-10-22.md\":\"708862c8\",\"rust-leetcode_2019-10-23.md\":\"d3f0b70d\",\"rust-leetcode_2019-10-24.md\":\"51bd4e4e\",\"rust-leetcode_2019-10-25.md\":\"951f5534\",\"rust-leetcode_2019-10-28.md\":\"3abf4c9e\",\"rust-leetcode_2019-10-29.md\":\"839dca18\",\"rust-leetcode_2019-10-30.md\":\"ea0d8f23\",\"rust-leetcode_2019-10-31.md\":\"d153fd3d\",\"rust-leetcode_2019-11-01.md\":\"039e486e\",\"rust-leetcode_2019-11-04.md\":\"34e82f18\",\"rust-leetcode_2019-11-05.md\":\"52ff13fd\",\"rust-leetcode_2019-11-06.md\":\"c1a279c7\",\"rust-leetcode_2019-11-07.md\":\"f1c65540\",\"rust-leetcode_2019-11-08.md\":\"acff17e0\",\"rust-leetcode_2019-11-11.md\":\"0b5bffab\",\"rust-leetcode_2019-11-12.md\":\"6a82cf18\",\"rust-leetcode_2019-11-13.md\":\"144a8c5f\",\"rust-leetcode_2019-11-14.md\":\"c66c6688\",\"rust-leetcode_2019-11-15.md\":\"d62f2367\",\"rust-leetcode_2019-11-18.md\":\"3052a958\",\"rust-leetcode_2019-11-19.md\":\"3cdb3adb\",\"rust-leetcode_2019-11-20.md\":\"ce6ced0e\",\"rust-leetcode_2019-11-21.md\":\"b3918762\",\"rust-leetcode_2019-11-22.md\":\"521eeefd\",\"rust-leetcode_2019-11-25.md\":\"c326d482\",\"rust-leetcode_2019-11-26.md\":\"cdcbb353\",\"rust-leetcode_2019-11-27.md\":\"1494af96\",\"rust-leetcode_2019-11-28.md\":\"5250314f\",\"rust-leetcode_2019-11-29.md\":\"cb2078fe\",\"rust-leetcode_2019-12-02.md\":\"6ad07f6f\",\"rust-leetcode_2019-12-03.md\":\"603faf82\",\"rust-leetcode_2019-12-04.md\":\"87f60736\",\"rust-leetcode_2019-12-05.md\":\"eefce309\",\"rust-leetcode_2019-12-06.md\":\"a247cca9\",\"rust-leetcode_2019-12-09.md\":\"ecf1d518\",\"rust-leetcode_2019-12-10.md\":\"789b0df0\",\"rust-leetcode_2019-12-11.md\":\"a5acd544\",\"rust-leetcode_2019-12-12.md\":\"d72bb811\",\"rust-leetcode_2019-12-13.md\":\"afe94e5e\",\"rust-leetcode_2019-12-16.md\":\"e07f9393\",\"rust-leetcode_2019-12-17.md\":\"4ec6afec\",\"rust-leetcode_2019-12-18.md\":\"0f04bb13\",\"rust-leetcode_2019-12-19.md\":\"c89b7548\",\"rust-leetcode_2019-12-20.md\":\"dcc4d429\",\"rust-leetcode_2019-12-23.md\":\"57f47e92\",\"rust-leetcode_2019-12-24.md\":\"39dd5adc\",\"rust-leetcode_2019-12-25.md\":\"7b6f5c78\",\"rust-leetcode_2019-12-26.md\":\"1f9018c9\",\"rust-leetcode_2019-12-27.md\":\"f8618196\",\"rust-leetcode_2019-12-30.md\":\"bba60d34\",\"rust-leetcode_2019-12-31.md\":\"523daf82\",\"rust-leetcode_2020-01-01.md\":\"26bc7006\",\"rust-leetcode_2020-01-02.md\":\"fe03ced8\",\"rust-leetcode_2020-01-03.md\":\"947990d3\",\"rust-leetcode_2020-01-06.md\":\"f73a3dd7\",\"rust-leetcode_2020-01-07.md\":\"7e15a96a\",\"rust-leetcode_2020-01-08.md\":\"70213bf0\",\"rust-leetcode_2020-01-09.md\":\"8d657a9d\",\"rust-leetcode_2020-01-10.md\":\"94985d6c\",\"rust-leetcode_2020-01-13.md\":\"e89829cc\",\"rust-leetcode_2020-01-14.md\":\"101d2828\",\"rust-leetcode_2020-01-15.md\":\"17e112c9\",\"rust-leetcode_2020-01-16.md\":\"4e1b730e\",\"rust-leetcode_2020-01-17.md\":\"d618f51c\",\"rust-leetcode_2020-01-20.md\":\"ee9dd080\",\"rust-leetcode_2020-01-21.md\":\"3818abd2\",\"rust-leetcode_2020-01-22.md\":\"c4a7c985\",\"rust-leetcode_2020-01-23.md\":\"aee029eb\",\"rust-leetcode_2020-01-24.md\":\"b4b64dca\",\"rust-leetcode_2020-02-03.md\":\"675dbc7b\",\"rust-leetcode_2020-02-04.md\":\"a049f780\",\"rust-leetcode_2020-02-05.md\":\"d0c3c1ae\",\"rust-leetcode_2020-02-06.md\":\"8aac34f5\",\"rust-leetcode_2020-02-07.md\":\"d4552e7f\",\"rust-leetcode_2020-02-10.md\":\"81c31647\",\"rust-leetcode_2020-02-11.md\":\"af1ba727\",\"rust-leetcode_2020-02-12.md\":\"e03af60a\",\"rust-leetcode_2020-02-13.md\":\"44491229\",\"rust-leetcode_2020-02-14.md\":\"d4234d98\",\"rust-leetcode_2020-02-17.md\":\"244bf3a0\",\"rust-leetcode_2020-02-18.md\":\"5baef4e8\",\"rust-leetcode_2020-02-19.md\":\"b511bdc2\",\"rust-leetcode_2020-02-20.md\":\"5c1e7831\",\"rust-leetcode_2020-02-21.md\":\"bd9f29f9\",\"rust-leetcode_2020-02-24.md\":\"7f9b0486\",\"rust-leetcode_2020-02-25.md\":\"0e83d36d\",\"rust-leetcode_2020-02-26.md\":\"99a67aff\",\"rust-leetcode_2020-02-27.md\":\"696c4d2a\",\"rust-leetcode_2020-02-28.md\":\"b204630c\",\"rust-leetcode_2020-03-02.md\":\"0039bbf0\",\"rust-leetcode_2020-03-03.md\":\"a5518ba5\",\"rust-leetcode_2020-03-04.md\":\"d013b5c4\",\"rust-leetcode_2020-03-05.md\":\"be1dd6a3\",\"rust-leetcode_2020-03-06.md\":\"60575b7c\",\"rust-leetcode_2020-03-09.md\":\"ddf5da5a\",\"rust-leetcode_2020-03-10.md\":\"708cedb7\",\"rust-leetcode_2020-03-11.md\":\"a5dfb46f\",\"rust-leetcode_2020-03-12.md\":\"bdb2db48\",\"rust-leetcode_2020-03-13.md\":\"5a1cf2b2\",\"rust-leetcode_2020-03-16.md\":\"54577f6a\",\"rust-leetcode_2020-03-17.md\":\"d7697463\",\"rust-leetcode_2020-03-18.md\":\"1ceed467\",\"rust-leetcode_2020-03-19.md\":\"e9fd165b\",\"rust-leetcode_2020-03-20.md\":\"70c6ff26\",\"rust-leetcode_2020-03-23.md\":\"d701160e\",\"rust-leetcode_2020-03-24.md\":\"c47bb528\",\"rust-leetcode_2020-03-25.md\":\"d4cbafd3\",\"rust-leetcode_2020-03-26.md\":\"f49269fd\",\"rust-leetcode_2020-03-27.md\":\"2c462130\",\"rust-leetcode_2020-03-30.md\":\"7c8b4d51\",\"rust-leetcode_2020-03-31.md\":\"6ec7fa21\",\"rust-leetcode_2020-07-09.md\":\"6de05ec6\",\"rust-leetcode_index.md\":\"ba84b027\",\"rust-leetcode_模板.md\":\"16d5507e\",\"rust_futures_explained_in_200_lines_of_rust.md\":\"3cd4fc35\",\"rust_futures_explained_in_200_lines_of_rust2.md\":\"e5d58d63\",\"rust_futures_explained_in_200_lines_of_rust_with_error_version.md\":\"b6f28e00\",\"rust_build_your_own_block_on.md\":\"a99d4606\",\"rust_build_your_own_executor.md\":\"ee7ad40c\",\"rust_convert_an_integer_to_an_enum.md\":\"fcf11cfa\",\"rust_index.md\":\"f67e6bab\",\"rust_lock-freedom-without-garbage-collection.md\":\"a3e10320\",\"rust_my_note.md\":\"85daf583\",\"rust_ownership101.md\":\"4a590d23\",\"rust_rnats_1.start.md\":\"ffb833c2\",\"rust_rnats_2.parser.md\":\"a1174044\",\"rust_rnats_3.sublist.md\":\"b903daa3\",\"rust_rnats_4.server.md\":\"57e25c64\",\"rust_rnats_5.server.client.md\":\"5c5effd1\",\"rust_rnats_6.client.md\":\"d1b25eac\",\"rust_rnats_index.md\":\"893e61cc\",\"rust_rnats_ppt_index.md\":\"5ffb4c62\",\"rust_rnats_ppt_从零实现消息中间件-client.md\":\"d0deb0cb\",\"rust_rnats_ppt_从零实现消息中间件-server.client.md\":\"30a93515\",\"rust_rnats_ppt_从零实现消息中间件-server.md\":\"4cfb22e6\",\"rust_rust_async_lock.md\":\"a437ec6f\",\"rust_rust_atomic.md\":\"6e6ca416\",\"rust_rust开发工具.md\":\"0b160af5\",\"rust_tokio_async_await 初探.md\":\"1829514b\",\"rust_tokio笔记.md\":\"c2b8ca76\",\"rust_交叉编译rust.md\":\"72b5aa66\",\"static_analysis_index.md\":\"c47521c1\",\"static_analysis_mariana-introduction.md\":\"17826fe2\",\"web-security_index.md\":\"8f53491c\",\"web-security_sql_inject_chinese_gbk.md\":\"960e1832\"}")</script>
    <script type="module" async src="/assets/app.e7435feb.js"></script>
    
  </body>
</html>