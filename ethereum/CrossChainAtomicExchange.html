<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CrossChainAtomicExchange | VitePress</title>
    <meta name="description" content="steven's Blog">
    <link rel="stylesheet" href="/assets/style.f12b8a37.css">
    <link rel="modulepreload" href="/assets/Home.0611433b.js">
    <link rel="modulepreload" href="/assets/vssue.1b5f3e65.js">
    <link rel="modulepreload" href="/assets/viewer.6bf00c48.js">
    <link rel="modulepreload" href="/assets/echarts.b33419de.js">
    <link rel="modulepreload" href="/assets/flowchart.31c8d424.js">
    <link rel="modulepreload" href="/assets/mermaid.409d2902.js">
    <link rel="modulepreload" href="/assets/runner.7dc2dd49.js">
    <link rel="modulepreload" href="/assets/app.7522cc54.js">
    <link rel="modulepreload" href="/assets/ethereum_CrossChainAtomicExchange.md.95a23b59.lean.js">
    <link rel="modulepreload" href="/assets/app.7522cc54.js">
    <link rel="icon" href="/logo.png">
    <meta name="twitter:title" content="CrossChainAtomicExchange | VitePress">
    <meta property="og:title" content="CrossChainAtomicExchange | VitePress">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="VitePress, back to home" data-v-675d8756 data-v-4a583abe><img class="logo" src="/logo.png" alt="Logo" data-v-4a583abe> VitePress</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>Other <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about.html" data-v-b8818f8c>about <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/btcwallet/" data-v-b8818f8c>btc wallet系列 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/btcd/" data-v-b8818f8c>btcd系列 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/libra/" data-v-b8818f8c>libra <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item active" href="/ethereum/" data-v-b8818f8c>以太坊 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/block_chain_core/" data-v-b8818f8c>区块链核心技术 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>静态分析 <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/Blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/other/" data-v-b8818f8c>Other <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about.html" data-v-b8818f8c>about <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/btcwallet/" data-v-b8818f8c>btc wallet系列 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/btcd/" data-v-b8818f8c>btcd系列 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/libra/" data-v-b8818f8c>libra <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item active" href="/ethereum/" data-v-b8818f8c>以太坊 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/block_chain_core/" data-v-b8818f8c>区块链核心技术 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/static_analysis/" data-v-b8818f8c>静态分析 <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/nkbai/Blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/ethereum_erc20_wrapper.html">&quot; 将以太坊封装为 ERC20 TOKEN&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/ethereum/CrossChainAtomicExchange.html">&quot;CrossChainAtomicExchange&quot;</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#前言">前言</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#场景">场景</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#智能雷电与闪电网络测试环境">智能雷电与闪电网络测试环境</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#什么是智能雷电？">什么是智能雷电？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#准备步骤">准备步骤</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#实现方法">实现方法</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#跨链时序图">跨链时序图</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/thedao.html">&quot;TheDao 简化版解释&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/[9232585]合约注意事项.html">&quot;[9232585]合约注意事项&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/[9249722]solidity_mapping_implementation.html">&quot;[9249722]solidity_mapping_implementation&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/[9420361]raiden_graph.html">&quot;[9420361]raiden_graph&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/[9619946]如何为 smartraiden 贡献代码.html">&quot;[9619946]如何为 smartraiden 贡献代码&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/btc跨链设计.html">&quot;btc跨链设计&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/golang subprocess tests.html">&quot;golang Subprocess tests&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/golang_plugin.html">&quot;golang_plugin&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/how_to_create_channel.html">&quot;how_to_create_channel&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/meshbox配置 OpenWrt.html">&quot;meshbox配置 OpenWrt&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/synapse代码阅读.html">&quot;synapse代码阅读&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/从一次盗币事件再谈合约安全问题.html">&quot;从一次盗币事件再谈合约安全问题&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/以太坊evm笔记.html">&quot;以太坊evm笔记&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/区块链计时器.html">&quot;区块链计时器&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/区块链问题笔记.html">&quot;区块链问题笔记&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/君士坦丁堡分叉引起的安全问题.html">&quot;君士坦丁堡分叉引起的安全问题&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/多链工作问题.html">&quot;多链工作问题&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/how_to_use_channel.html">&quot;如何使用 Channel&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/如何使用 dlv 调试 smartraiden.html">&quot;如何使用 dlv 调试 smartraiden&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/如何使用 smartraiden 以及 lnd 进行跨链原子资产交换.html">&quot;如何使用 smartraiden 以及 lnd 进行跨链原子资产交换&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/安全总结.html">&quot;安全总结&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/并发和并行的区别.html">&quot;并发和并行的区别&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/异常退出各种情况.html">&quot;异常退出各种情况&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/我对 smartplasma 的理解.html">&quot;我对 smartplasma 的理解&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/比特币的TxHash为什么会发生改变.html">&quot;比特币的TxHash为什么会发生改变&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/让photon支持go module.html">&quot;让photon支持go module&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/闪电网络.html">&quot;闪电网络&quot;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/ethereum/闪电网络交易密钥.html">&quot;闪电网络交易密钥&quot;</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="smartraiden-和-lighting-network-进行去中心化跨链原子资产交换"><a class="header-anchor" href="#smartraiden-和-lighting-network-进行去中心化跨链原子资产交换" aria-hidden="true">#</a> SmartRaiden 和 Lighting Network 进行去中心化跨链原子资产交换</h1><h2 id="前言"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>如果能够进行以太坊和比特币跨链原子资产交换，是不是一件很酷的事情？ 目前链下的扩容方式有很多，最广为人知的就是比特币的闪电网络和以太坊的雷电网络，今天我就来告诉如何通过智能雷电和闪电网络来实现跨链原子资产交换。</p><h2 id="场景"><a class="header-anchor" href="#场景" aria-hidden="true">#</a> 场景</h2><ol><li>Alice 在某个信息发布网站上发布信息,希望用1个 BTC 置换100个 SMT</li><li>Bob 看到以后,和 Alice 进行沟通,达成交换意见 那么Alice 和 Bob 如何不需要借助任何第三方实现原子资产置换呢?</li></ol><h2 id="智能雷电与闪电网络测试环境"><a class="header-anchor" href="#智能雷电与闪电网络测试环境" aria-hidden="true">#</a> 智能雷电与闪电网络测试环境</h2><h3 id="什么是智能雷电？"><a class="header-anchor" href="#什么是智能雷电？" aria-hidden="true">#</a> 什么是智能雷电？</h3><p>智能雷电是一种最新的链下扩容方案，可以实现即时的、低费用和可扩展的支付。可以运行与以太坊和光谱链，兼容ERC20 token 和 ERC233 token。 它是跨平台的，目前支持 Windows Linux MacOS Android IOS 为了更好的适用于移动设备各种复杂的网络环境，智能雷电支持无网支付，安全快捷。 同时智能雷电也是开源的，并且正在积极维护中，想要参与和详细了解请移步<a href="https://github.com/SmartMeshFoundation/SmartRaiden" target="_blank" rel="noopener noreferrer">官方源码</a>.</p><h3 id="准备步骤"><a class="header-anchor" href="#准备步骤" aria-hidden="true">#</a> 准备步骤</h3><h4 id="安装启动智能雷电"><a class="header-anchor" href="#安装启动智能雷电" aria-hidden="true">#</a> 安装启动智能雷电</h4><p>在本地搭建一个Bob和Alice的环境，让他们建立通道。假设你已经安装好了 <code>go</code> <code>geth</code> 如果没有请参考<a href="https://smartraiden.readthedocs.io/en/latest/installation_guide/" target="_blank" rel="noopener noreferrer">安装说明</a></p><h5 id="连接以太坊测试网络"><a class="header-anchor" href="#连接以太坊测试网络" aria-hidden="true">#</a> 连接以太坊测试网络</h5><p>连接以太坊的测试链<code>testnet</code></p><div class="language-"><pre><code>geth --testnet --fast --rpc --rpcapi eth,net,web3 --bootnodes &quot;enode://20c9ad97c081d63397d7b685a412227a40e23c8bdc6688c6f37e97cfbc22d2b4d1db1510d8f61e6a8866ad7f0e17c02b14182d37ea7c3c8b9c2683aeb6b733a1@52.169.14.227:30303,enode://6ce05930c72abc632c58e2e4324f7c7ea478cec0ed4fa2528982cf34483094e9cbc9216e7aa349691242576d552a2a56aaeae426c5303ded677ce455ba1acd9d@13.84.180.240:30303&quot;

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="启动节点"><a class="header-anchor" href="#启动节点" aria-hidden="true">#</a> 启动节点</h5><p>启动两个节点，分别是<code>Alice</code>和<code>Bob</code> 启动<code>Alice</code></p><div class="language-"><pre><code>smartraiden --datadir=.smartraiden --api-address=0.0.0.0:5001 --listen-address=127.0.0.1:400001 --address=&quot;0x69c5621db8093ee9a26cc2e253f929316e6e5b92&quot; --keystore-path ~/.ethereum/keystore  -password-file /file --eth-rpc-endpoint ws://127.0.0.1:8546 
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动<code>Bob</code></p><div class="language-"><pre><code>smartraiden --datadir=.smartraiden --api-address=0.0.0.0:5002 --listen-address=127.0.0.1:40002 --address=&quot;0x31ddac67e610c22d19e887fb1937bee3079b56cd&quot; --keystore-path ~/.ethereum/keystore --password-file /file --eth-rpc-endpoint ws://127.0.0.1:8546  
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>datadir</code> 节点的本地数据存储目录</li><li><code>api-address</code> rest api 监听端口</li><li><code>address</code> 以太坊节点地址，如果没有可以通过<code> geth account new</code>创建</li><li><code>keystore-path</code> --keystore-path 路径</li><li><code>password-file</code> password-file 路径</li><li><code>eth-rpc-endpoint</code> 以太坊全节点的rpc端口，默认的<code>websocket</code>是8546</li></ul><p>此时你就已经成功搭建好了本地智能雷电节点网络，可以通过查询<a href="https://smartraiden.readthedocs.io/en/v0.8/rest_api/" target="_blank" rel="noopener noreferrer">SmartRaiden api文档</a>来创建通道。</p><h4 id="安装启动闪电网络"><a class="header-anchor" href="#安装启动闪电网络" aria-hidden="true">#</a> 安装启动闪电网络</h4><p>本地搭建一个Bob和Alice的闪电网络测试环境，让他们建立通道。</p><h5 id="连接btcd测试链"><a class="header-anchor" href="#连接btcd测试链" aria-hidden="true">#</a> 连接Btcd测试链</h5><p>默认你已经安装好了<code>btcd</code>和<code>lnd</code>，如果没有请参考<a href="https://dev.lightning.community/guides/installation/" target="_blank" rel="noopener noreferrer">安装说明</a></p><p>运行btcd,打开终端，然后运行</p><div class="language-"><pre><code>btcd --txindex --testnet --rpcuser=kek --rpcpass=kek
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>txindex</code>是必须的，以便<code>lnd</code>客户端能够从中查询历史交易<code>btcd</code></li><li><code>testnet</code> 指定我们正在使用的<code>testnet</code>网络</li><li><code>rpcuser</code>和<code>rpcpass</code> 设置用于对<code>btcd</code>实例进行身份验证的默认密码</li></ul><h5 id="启动节点-1"><a class="header-anchor" href="#启动节点-1" aria-hidden="true">#</a> 启动节点</h5><p>启动两个节点，分别是<code>Alice</code>和<code>Bob</code> 启动<code>Alice</code></p><div class="language-"><pre><code>lnd --rpclisten=localhost:10001 --listen=localhost:10011 --restlisten=localhost:8001 --datadir=data --logdir=log --debuglevel=info --bitcoin.testnet --bitcoin.active --bitcoin.node=btcd --btcd.rpcuser=kek --btcd.rpcpass=kek 

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>rpclisten</code>：host：侦听RPC服务器的端口。这是应用程序与之通信的主要方式lnd</li><li><code>listen</code>：host：侦听传入P2P连接的端口。这是在网络层面，不同于Lightning频道网络和比特币/ Litcoin网络本身。</li><li><code>restlisten</code>：host：port，公开REST api，用于与lndHTTP 进行交互。例如，您可以通过向GET请求获取Alice的频道余额localhost:8001/v1/channels。</li><li><code>datadir</code>：lnd将存储数据的目录</li><li><code>logdir</code>：记录输出的目录。</li><li><code>debuglevel</code>：所有子系统的日志记录级别。可以设置为 trace，debug，info，warn，error，critical。</li><li><code>bitcoin.testnet</code>t：指定是否使用simnet或testnet</li><li><code>bitcoin.active</code>：指定比特币处于活动状态。还可以包括 --litecoin.active激活Litecoin。</li><li><code>bitcoin.node=btcd</code>：使用btcd完整节点与区块链连接。请注意，使用Litecoin时，选项是--litecoin.node=btcd。</li><li><code>btcd.rpcuser和--btcd.rpcpass</code>：btcd实例的用户名和密码。请注意，使用Litecoin时，选项为--ltcd.rpcuser 和--ltcd.rpcpass</li></ul><p>启动<code>Bob</code></p><div class="language-"><pre><code>lnd --rpclisten=localhost:10002 --listen=localhost:10012--restlisten=localhost:8002 --datadir=data --logdir=log --debuglevel=info --bitcoin.testnet --bitcoin.active --bitcoin.node=btcd --btcd.rpcuser=kek --btcd.rpcpass=kek 
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>为了不必每次都输入一堆命令，可以修改配置文件<code>lnd.conf</code></p><ul><li>MacOS:<code>lnd.conf</code>位于：<code>/Users/[username]/Library/Application\ Support/Lnd/lnd.conf</code></li><li>Linux:<code>~/.lnd/lnd.conf</code></li></ul><div class="language-"><pre><code>datadir=data
logdir=log
debuglevel=info
debughtlc=true

bitcoin.active=1
bitcoin.testnet=1
bitcoin.node=btcd
btcd.rpchost=localhost
btcd.rpcuser=kek
btcd.rpcpass=kek
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>现在启动Alice节点我们只需要输入</p><div class="language-"><pre><code>lnd --rpclisten=localhost:10001 --listen=localhost:10011 --restlisten=localhost:8001
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重新打开新的终端，创建<code>Alice</code>钱包密码</p><div class="language-"><pre><code>lncli --rpcserver=localhost:10001 --macaroonpath=data/admin.macaroon create
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>为了避免每次都输入<code>--rpcserver=localhost:1000X</code>和<code>--macaroonpath</code>标记,可以设置一些别名</p><div class="language-"><pre><code>alias lncli-alice=&quot;lncli --rpcserver=localhost:10001 --macaroonpath=data/admin.macaroon&quot;
alias lncli-bob=&quot;lncli --rpcserver=localhost:10002 --macaroonpath=data/admin.macaroon&quot;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Bob</code>创建钱包同上</p><p>此时<code>Alice</code>和<code>Bob</code>就可以创建通道了，详细教程请参考<a href="https://api.lightning.community/rest/index.html" target="_blank" rel="noopener noreferrer">lnd api</a></p><h2 id="实现方法"><a class="header-anchor" href="#实现方法" aria-hidden="true">#</a> 实现方法</h2><p>到这里我们为了进行SmartRaiden 和 Lighting Network 进行跨链原子资产交换的准备工作就已经完成了，具体的实现方法如下。 回到我们最初的那个问题</p><blockquote><p>Alice 在某个信息发布网站上发布信息,希望用1个 BTC 置换100个 SMT</p></blockquote><h4 id="bob和alice-smartraiden场景"><a class="header-anchor" href="#bob和alice-smartraiden场景" aria-hidden="true">#</a> Bob和Alice SmartRaiden场景</h4><pre class="mermaid loading">sequenceDiagram
participant A as Alice&#39;s SmartRaden
participant B as Bob&#39;s SmartRaiden 
B-&gt;&gt;A:发送100SMT 密码=Secret
Note over A,A:收到MediatedTransfer，密码hash=Sha256(Secret)
A-&gt;&gt;B:不断发送SecretRequest...</pre><h4 id="bob和alice-lnd场景"><a class="header-anchor" href="#bob和alice-lnd场景" aria-hidden="true">#</a> Bob和Alice Lnd场景</h4><pre class="mermaid loading">sequenceDiagram
participant A as Alice&#39;s Lnd
participant B as Bob&#39;s Lnd 
Note over B,B:Bob addinvoice：密码=Secret 1BTC
A-&gt;&gt;B:发送:1BTC，payment_hash=Sha256(Secret)
Note over B,B:校验Payment_hash=Sha256(Secret)
Note over A,A:发送成功后，可以知道交易的Secret</pre><h4 id="_1-bob和-alice-分别启动自己的-atmosphere-服务"><a class="header-anchor" href="#_1-bob和-alice-分别启动自己的-atmosphere-服务" aria-hidden="true">#</a> 1. Bob和 Alice 分别启动自己的 Atmosphere 服务</h4><p><a href="https://github.com/SmartMeshFoundation/Atmosphere" target="_blank" rel="noopener noreferrer">Atmosphere</a> 服务会启动响应的SmartRaiden和Lnd 假设 Alice 在SmartRaiden的节点使用的私钥为 SA_Priv, 公钥为 SA, 在 Lnd 节点使用的私钥为 LA_Priv, 公钥为 LA 假设 Bob 在 SmartRaiden 节点使用的私钥为 SB_Priv, 公钥为 SB, 在 Lnd 节点使用的私钥为 LB_Priv, 公钥为 LB</p><h4 id="_2-bob-的atmosphere服务"><a class="header-anchor" href="#_2-bob-的atmosphere服务" aria-hidden="true">#</a> 2. Bob 的Atmosphere服务</h4><ul><li><p>1 Bob发起交易,指定Secret,金额为100,token 为 SMT,接收方为 SA</p></li><li><p>2 Bob等待是否收到一个金额为1BTC,密码 hash 为 Sha256(Secret),</p></li><li><p>3 收到以后,允许自己的 SmartRaiden 响应 SecretRequest</p></li></ul><h4 id="_3-alice-的atmosphere-服务"><a class="header-anchor" href="#_3-alice-的atmosphere-服务" aria-hidden="true">#</a> 3. Alice 的Atmosphere 服务</h4><ul><li><p>1 Alice 在 SmartRaiden 上等待是否收到了来自 Bob 的100个 SMT交易</p></li><li><p>2 一旦收到, Alice 校验该交易是否有效,比如 Expiration 时间是否足够,必须大于125分钟(500Spectrum 块)</p></li><li><p>3 如果都一致,那么通过向自己的 Lnd 注册这个 PaymentReq,并指定过期时间为100分钟,secretHash</p></li><li><p>4 检测 Lnd 是否收到了密码,如果收到了,立即向 自己的SmartRaiden 注册密码</p></li></ul><h3 id="跨链时序图"><a class="header-anchor" href="#跨链时序图" aria-hidden="true">#</a> 跨链时序图</h3><pre class="mermaid loading">sequenceDiagram
participant ae as  Alice&#39;s Atmosphere
    participant al as Alice&#39;s Lnd
    participant as as Alice&#39;s SmartRaiden
    participant space
    participant bs as Bob&#39;s SmartRaiden
    participant bl as Bob&#39;s Lnd
    participant be as Bob&#39;s Atmosphere
    
    be-&gt;&gt;ae: 可以用我100SMT换你1 BTC? 
    ae-&gt;&gt;be: 没问题
    be-&gt;&gt;bs: 发送MediatedTransfer 给Alice:Secret,100SMT
    be-&gt;&gt;bl:准备接受金额为1BTC,密码为Secret的交易
    bs-&gt;&gt;as: MediatedTransfer(Secret,100SMT,from Bob to Alice,Expiration=600)
    as-&gt;&gt;ae: 收到了有效的 MediatedTransfer
    ae-&gt;&gt;al: 通过Lnd向bob发送 (1BTC, secretHash, Expiration=10Block) 
  
    al-&gt;&gt;bl: Send payment to bob(1BTC,secertHash,Expiration=10Block)
        loop alice wait
        al-&gt;&gt;al:是否收到了Secret(包括链上注册的密码)
    end
    bl-&gt;&gt;al: 凭借Secret换回1BTC
    bl-&gt;&gt;be: 收到有效的 HTLC
    loop bob wait
        be-&gt;&gt;be: 收到了来自Alice的1BTC ?
    end
    be-&gt;&gt;bs: 响应来自Alice&#39;SmartRaiden 的 SecretRequest 
    bs-&gt;&gt;as: 发送 Secret给Alice 开始正常的雷电交易
    ae-&gt;&gt;as:如果还没有收到Smarraiden交易，去链上注册密码</pre></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/nkbai/Blog/edit/master/docs/ethereum/CrossChainAtomicExchange.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>编辑本文 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>上次更新:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/ethereum/ethereum_erc20_wrapper" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>&quot; 将以太坊封装为 ERC20 TOKEN&quot;</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/ethereum/thedao" data-v-38ede35f><span class="text" data-v-38ede35f>&quot;TheDao 简化版解释&quot;</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"404.md\":\"318430d5\",\"about.md\":\"a1ed7e20\",\"index.md\":\"8449c430\",\"block_chain_core_ecc_signature_random.md\":\"520e322c\",\"block_chain_core_index.md\":\"b57a79a1\",\"block_chain_core_vrf.md\":\"871435bd\",\"btcd_[9476013]比特币指令集说明.md\":\"996ca3f8\",\"btcd_[9476189]一个比特币脚本示例.md\":\"9623ef5c\",\"btcd_[9485733]bitcoin script.md\":\"b32d953b\",\"btcd_[9491455]比特币的地址类型.md\":\"48749a22\",\"btcd_bloom.md\":\"310132d3\",\"btcd_btcjson.md\":\"9de0a21a\",\"btcd_database.md\":\"7fc208e2\",\"btcd_index.md\":\"a7712feb\",\"btcd_indexer模块.md\":\"37004992\",\"btcd_mempool.md\":\"533c6cd8\",\"btcd_mining.md\":\"47ab44e3\",\"btcd_mrumap.md\":\"1b333cd1\",\"btcd_peer.md\":\"c94a9993\",\"btcd_rpcclient.md\":\"4959d16a\",\"btcd_wire_common.md\":\"bf0f6675\",\"btcd_比特币解锁脚本中的scriptsignature都包含了什么东西.md\":\"31022b58\",\"btcd_隔离见证.md\":\"a6ceaa68\",\"btcwallet_btcwallet系列之一-grpc模块.md\":\"a2226015\",\"btcwallet_chain模块.md\":\"e9dd0443\",\"btcwallet_hdwallet-bip0032.md\":\"eb58f363\",\"btcwallet_index.md\":\"cb4aa401\",\"btcwallet_readme.md\":\"80e07834\",\"btcwallet_snacl.md\":\"99eff325\",\"btcwallet_waddrmgr模块.md\":\"e4649fc6\",\"btcwallet_walletdb.md\":\"d27645ff\",\"btcwallet_wallet中的数据库设计.md\":\"9416cc5b\",\"btcwallet_wallet模块.md\":\"1e801139\",\"btcwallet_wtxmgr模块.md\":\"c5e6a325\",\"btcwallet_拓扑排序在比特币tx管理中的使用.md\":\"1e329796\",\"ethereum_crosschainatomicexchange.md\":\"95a23b59\",\"ethereum_[9232585]合约注意事项.md\":\"2c351864\",\"ethereum_[9249722]solidity_mapping_implementation.md\":\"df678a74\",\"ethereum_[9420361]raiden_graph.md\":\"a8b79ad6\",\"ethereum_[9619946]如何为 smartraiden 贡献代码.md\":\"536b18ca\",\"ethereum_btc跨链设计.md\":\"2521e0f5\",\"ethereum_ethereum_erc20_wrapper.md\":\"aa2e3a6d\",\"ethereum_golang subprocess tests.md\":\"c4a62ff6\",\"ethereum_golang_plugin.md\":\"72b4e52c\",\"ethereum_how_to_create_channel.md\":\"de3685e9\",\"ethereum_how_to_use_channel.md\":\"f7175301\",\"ethereum_index.md\":\"74cfea79\",\"ethereum_meshbox配置 openwrt.md\":\"f3f7ac57\",\"ethereum_synapse代码阅读.md\":\"c59bc11b\",\"ethereum_thedao.md\":\"a71e37b7\",\"ethereum_从一次盗币事件再谈合约安全问题.md\":\"ba0ae39e\",\"ethereum_以太坊evm笔记.md\":\"883de53a\",\"ethereum_区块链计时器.md\":\"51e62b7d\",\"ethereum_区块链问题笔记.md\":\"c7d866b8\",\"ethereum_君士坦丁堡分叉引起的安全问题.md\":\"53c70d13\",\"ethereum_多链工作问题.md\":\"f7fd4d3a\",\"ethereum_如何使用 dlv 调试 smartraiden.md\":\"055873c8\",\"ethereum_如何使用 smartraiden 以及 lnd 进行跨链原子资产交换.md\":\"2724a4e5\",\"ethereum_安全总结.md\":\"c3b25e90\",\"ethereum_并发和并行的区别.md\":\"515029ae\",\"ethereum_异常退出各种情况.md\":\"f0ad026b\",\"ethereum_我对 smartplasma 的理解.md\":\"5f57b884\",\"ethereum_比特币的txhash为什么会发生改变.md\":\"eac71553\",\"ethereum_让photon支持go module.md\":\"642bc7c9\",\"ethereum_闪电网络.md\":\"f55ed180\",\"ethereum_闪电网络交易密钥.md\":\"37b46f2f\",\"libra_1.start_in_one_minute.md\":\"146c205a\",\"libra_2.protobuf_in_libria.md\":\"d4e7f6cb\",\"libra_3.libra_schema.md\":\"fbfd522f\",\"libra_4.client_command_and_libriadb.md\":\"7a2bc628\",\"libra_5.libra_ac.md\":\"6d4b4de7\",\"libra_6.libria_mempool_1.md\":\"3780eeb2\",\"libra_7.libra_mempool_2.md\":\"c3d6aa6e\",\"libra_8.libria_mempool_3.md\":\"34139742\",\"libra_9.libria_vrf.md\":\"562ddc0c\",\"libra_index.md\":\"139eb4b5\",\"static_analysis_index.md\":\"aa1a64af\",\"static_analysis_mariana-introduction.md\":\"df11974d\",\"other_apt安装指定版本软件.md\":\"1e4d0b4f\",\"other_brew安装指定版本boost.md\":\"6213bb7b\",\"other_capture_with_wireshark_for_android.md\":\"0ae22456\",\"other_clean_mac.md\":\"efb3c224\",\"other_crossover source insight 4.0使用.md\":\"ccbc81dd\",\"other_git以及github回退.md\":\"e59b425b\",\"other_grpcox.md\":\"ff571c13\",\"other_hugo博客写作.md\":\"ce5029cb\",\"other_index.md\":\"19192c3e\",\"other_learn_go.md\":\"8aa4fea3\",\"other_learningpythonv4.md\":\"bafb4693\",\"other_opc 统一架构学习笔记.md\":\"8c477ccc\",\"other_opcua-rust.md\":\"8ab580e8\",\"other_opcua_cross_compile_for_raspeberry.md\":\"49832886\",\"other_read_kerenel_use_clion.md\":\"d2707859\",\"other_vscode_cnblog_plugin.md\":\"f9e22485\",\"other_windows_hook_thiscall.md\":\"e2d09cd5\",\"other_不用外部插件启用u盘ntfs写功能.md\":\"aaa7ceaa\",\"other_五个goland进行go开发的小技巧.md\":\"74eba192\",\"other_使用clion调试开发比特币源码.md\":\"bcf24942\",\"other_使用ubuntu搭建时间机器备份服务.md\":\"26675a81\",\"other_工作中常用工具入门.md\":\"7730a231\",\"other_用 go 写 webassembly入门.md\":\"2dce42bd\",\"other_阈值签名.md\":\"31807611\",\"other_高性能go开发.md\":\"df4ef123\"}")</script>
    <script type="module" async src="/assets/app.7522cc54.js"></script>
  </body>
</html>